(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

require('./pollyfills/Array.find.js');require('./pollyfills/Element.matches.js');require('./pollyfills/NodeList.forEach.js');require('./pollyfills/Object.assign.js');

var VirtualDataGrid = require('./models/module/virtual-data-grid');

window.VirtualDataGrid = VirtualDataGrid;
},{"./models/module/virtual-data-grid":10,"./pollyfills/Array.find.js":20,"./pollyfills/Element.matches.js":21,"./pollyfills/NodeList.forEach.js":22,"./pollyfills/Object.assign.js":23}],2:[function(require,module,exports){
'use strict';

var Class = require('class-256.js');

module.exports = Class.extend(function() {
	var self = this;

	self.constructor = function(attributes, params) {
		if (typeof attributes == 'undefined') {
			return;
		}

		attributes.forEach(function(attr) {
			self[attr] = typeof params == 'undefined' || typeof params[attr] == 'undefined' ? null : params[attr];
		});
	};

	this.updateAttributes = function(attrs) {
		Object.keys(attrs).forEach(function(k) {
			if (typeof attrs[k] != 'undefined' && typeof self[k] != 'undefined') {
				self[k] = attrs[k];
			}
		});
	};
});
},{"class-256.js":29}],3:[function(require,module,exports){
'use strict';

var BaseClass = require('../base');

var ATTRIBUTES = [
	'cellElement',
	'cellData'
];

module.exports = BaseClass.extend(function(parent) {
	var self = this;

	self.constructor = function(params) {
		parent.constructor.call(self, ATTRIBUTES, params);
	};
});
},{"../base":2}],4:[function(require,module,exports){
'use strict';

var BaseClass = require('../base');

var ATTRIBUTES = [
	'savedRows'
];

module.exports = BaseClass.extend(function(parent) {
	var self = this;

	self.constructor = function(params) {
		parent.constructor.call(self, ATTRIBUTES, params);
	};
});
},{"../base":2}],5:[function(require,module,exports){
'use strict';

var BaseClass = require('../base');

var ATTRIBUTES = [
	'cellElement',
	'cellData',
	'cancelEvent'
];

module.exports = BaseClass.extend(function(parent) {
	var self = this;

	self.constructor = function(params) {
		parent.constructor.call(self, ATTRIBUTES, params);
	};
});
},{"../base":2}],6:[function(require,module,exports){
'use strict';

var BaseClass = require('../base');

var ATTRIBUTES = [
	'editedRows',
	'cancelEvent'
];

module.exports = BaseClass.extend(function(parent) {
	var self = this;

	self.constructor = function(params) {
		parent.constructor.call(self, ATTRIBUTES, params);
	};
});
},{"../base":2}],7:[function(require,module,exports){
arguments[4][6][0].apply(exports,arguments)
},{"../base":2,"dup":6}],8:[function(require,module,exports){
'use strict';

var BaseClass = require('../base');

var ATTRIBUTES = [
	'editedRow',
	'cancelEvent'
];

module.exports = BaseClass.extend(function(parent) {
	var self = this;

	self.constructor = function(params) {
		parent.constructor.call(self, ATTRIBUTES, params);
	};
});
},{"../base":2}],9:[function(require,module,exports){
arguments[4][5][0].apply(exports,arguments)
},{"../base":2,"dup":5}],10:[function(require,module,exports){
'use strict';

var generator = require('../../modules/generator');

var uniqueIdSequence = 1;

function VirtualDataGrid() {
	var self = this;

	self.configuration = {};
	self.uniqueId = uniqueIdSequence++;
	self.DEFAULT_OPTIONS = generator.getDefaultOptions();
	self.generateTable = function(options) {
		options.uniqueId = self.uniqueId;

		generator.generateTable(self.configuration, options);
	};
	self.destroyTable = function() {
		generator.destroyTable(self.configuration);
	};
	self.getId = function() {
		return self.uniqueId;
	};
}

module.exports = VirtualDataGrid;
},{"../../modules/generator":17}],11:[function(require,module,exports){
'use strict';

function CellObject(p) {
	var self = this;

	initAttr('key');
	initAttr('value');
	initAttr('dataType');
	initAttr('editedValue');
	initAttr('class');
	initAttr('rowNumber');
	initAttr('columnNumber');

	function initAttr(name) {
		self[name] = typeof p == 'undefined' || typeof p[name] == 'undefined' ? null : p[name];
	}

	this.updateAttributes = function(attrs) {
		Object.keys(attrs).forEach(function(k) {
			if (typeof attrs[k] != 'undefined' && typeof self[k] != 'undefined') {
				self[k] = attrs[k];
			}
		});
	};

	this.getValue = function() {
		return self.cellChanged ? self.editedValue : self.value;
	};

	this.updateValue = function(value) {
		if (self.dataType === 'number') {
			value = isNaN(parseFloat(value)) ? 0 : parseFloat(value);
		}

		if (self.value === value || self.value === null && typeof value == 'undefined') {
			self.editedValue = null;
			self.cellChanged = false;
		} else {
			self.editedValue = value;
			self.cellChanged = true;
		}
	};

	this.discardChangedValue = function() {
		self.editedValue = null;
	};

	this.isCellChanged = function() {
		return self.cellChanged;
	};
}

module.exports = CellObject;
},{}],12:[function(require,module,exports){
'use strict';

var configUtil = require('../utils/configuration'),
	dataUtil   = require('../utils/data');

var DEFAULTS = {
	selectors: {
		mainContainer: '.data-container',
		fixedContainer: 'fixed-container',
		fixedTable: 'fixed-table',
		virtualContainer: 'virtual-container',
		virtualTable: 'virtual-table',
		editingCell: 'editing-cell',
		editedCell: 'edited-cell',
		saveButton: null
	},
	dimensions: {
		cellWidth: 150,
		cellHeight: 50,
		cellPaddingVertical: 4,
		cellPaddingHorizontal: 8,
		cellBorderWidth: 1,
		containerHeight: configUtil.getDefaultContainerHeight
	},
	edit: {
		enabled: false,
		mode: 'batch'
	},
	filter: {
		enabled: false,
		customFilter: null
	},
	sort: {
		enabled: false,
		default: configUtil.getSortDefault,
		customSort: null
	},
	eventHandlers: {
		onBeforeEdit: configUtil.nil,
		onValidation: configUtil.nil,
		onAfterEdit: configUtil.nil,
		onBeforeSave: configUtil.nil,
		onSaveRow: configUtil.nil,
		onSaveBatch: configUtil.nil,
		onAfterSave: configUtil.nil
	},
	locale: {
		name: 'en'
	},
	dataSource: [ ],
	headers: [ [ ] ],
	fixedHeaders: [ [ ] ],
	uniqueRowKey: '__uniqueRowKey',
	autoResize: true,
	debug: false,
	uniqueId: 0,
	inner: {}
};

var HEADER_DEFAULTS = {
	dataType: 'text',
	filterType: 'equals',
	filterDisabled: false,
	sortDisabled: false
};

var STATIC_INNER_ATTRS = {
	selectors: {
		uniqueIdPrefix: 'virtual-data-grid-',
		bufferRowTop: 'buffer-row-top',
		bufferRowBottom: 'buffer-row-bottom',
		bufferColumnLeft: 'buffer-column-left',
		bufferColumnRight: 'buffer-column-right',
		headerRow: 'header-row',
		headerCell: 'header-cell',
		sortCell: 'sort-cell',
		sortIcon: 'sort-icon',
		sortDisabled: 'sort-disabled',
		filterRow: 'filter-row',
		filterCell: 'filter-cell',
		filterDisabled: 'filter-disabled',
		filterContainer: 'filter-container',
		filterSearchIcon: 'filter-search-icon',
		filterClearIcon: 'filter-clear-icon',
		dataRow: 'data-row',
		dataCell: 'data-cell'
	},
	dimensions: {},
	icons: {
		sort: {
			asc: 'fa fa-arrow-down',
			desc: 'fa fa-arrow-up'
		},
		filter: {
			search: 'fa fa-search',
			clear: 'fa fa-times'
		}
	},
	editedValues: {},
	sort: { },
	filters: { },
	minBufferWidth: 2,
	minBufferHeight: 18, // Azért van rá szükség, mert ha nincs megadva, akkor ugrik egyett a scroll ha a végére vagy az elejére értünk a táblázatban
	leftCellOffset: 0,
	topCellOffset: 0
};

function init(config, options, initContainers) {
	initConfigObject(config);

	updateValue(config, options, 'selectors.mainContainer');
	updateValue(config, options, 'selectors.fixedContainer');
	updateValue(config, options, 'selectors.fixedTable');
	updateValue(config, options, 'selectors.virtualContainer');
	updateValue(config, options, 'selectors.virtualTable');
	updateValue(config, options, 'selectors.editingCell');
	updateValue(config, options, 'selectors.editedCell');
	updateValue(config, options, 'selectors.saveButton');
	updateValue(config, options, 'dimensions.cellWidth');
	updateValue(config, options, 'dimensions.cellHeight');
	updateValue(config, options, 'dimensions.cellPaddingVertical');
	updateValue(config, options, 'dimensions.cellPaddingHorizontal');
	updateValue(config, options, 'dimensions.cellBorderWidth');
	updateValue(config, options, 'uniqueId');

	calculateUniqueIdSelector(config);
	calculateVirtualContainerHeight(config, options);

	initContainers(config);

	updateValue(config, options, 'locale.name');
	updateValue(config, options, 'dataSource');
	updateValue(config, options, 'headers');
	updateValue(config, options, 'fixedHeaders');
	updateValue(config, options, 'uniqueRowKey');
	updateValue(config, options, 'autoResize');
	updateValue(config, options, 'edit.enabled');
	updateValue(config, options, 'edit.mode');
	updateValue(config, options, 'filter.enabled');
	updateValue(config, options, 'filter.customFilter');
	updateValue(config, options, 'sort.enabled');
	updateValue(config, options, 'sort.default');
	updateValue(config, options, 'sort.customSort');
	updateValue(config, options, 'debug');
	updateValue(config, options, 'eventHandlers.onBeforeEdit');
	updateValue(config, options, 'eventHandlers.onValidation');
	updateValue(config, options, 'eventHandlers.onAfterEdit');
	updateValue(config, options, 'eventHandlers.onBeforeSave');
	updateValue(config, options, 'eventHandlers.onSaveRow');
	updateValue(config, options, 'eventHandlers.onSaveBatch');
	updateValue(config, options, 'eventHandlers.onAfterSave');

	initHeaderData(config);
	initDataSource(config, options.uniqueRowKey);
	initInnerCalculatedValues(config);
}

function initConfigObject(config) {
	config.selectors = {};
	config.eventHandlers = {};
	config.locale = {};
	config.inner = dataUtil.cloneObject(STATIC_INNER_ATTRS);
}

function calculateUniqueIdSelector(config) {
	config.inner.selectors.uniqueId = config.inner.selectors.uniqueIdPrefix + config.uniqueId;
}

function calculateVirtualContainerHeight(config, options) {
	var containerHeight = getInnerValue(options, 'dimensions.containerHeight');

	if (typeof containerHeight == 'undefined') {
		containerHeight = configUtil.getDefaultContainerHeight(config);
	}

	config.dimensions.containerHeight = configUtil.calculateVirtualContainerHeight(config, containerHeight);
}

function initInnerCalculatedValues(config) {
	// Annak a header sornak az indexe, ami a cella kulcsokat is meghatározza. Mivel ez mindig az utolsó lesz, ezért TODO: Kiszedni/átalakítani
	config.inner.indexOfCellKeyHeader = configUtil.getIndexOfCellKeyHeader(config);
	config.inner.colspanOffset = configUtil.getMaxColspan(config);
	config.inner.visibleRowNumber = configUtil.getVisibleRowNumber(config);
	config.inner.visibleColumnNumber = configUtil.getVisibleColumnNumber(config);
	config.inner.tableOffsetWidth = configUtil.getTableOffsetWidth(config);
	config.inner.tableOffsetHeight = configUtil.getTableOffsetHeight(config);
	config.inner.originalDataSource = [].concat(config.dataSource);
}

function initHeaderData(config) {
	var processedHeaders = [],
		processedFixedHeaders = [];

	config.headers.forEach(function(headerRow) {
		var hRow = [];

		headerRow.forEach(function(headerCell) {
			if (typeof headerCell.dataType == 'undefined') {
				headerCell.dataType = HEADER_DEFAULTS.dataType;
			}

			if (typeof headerCell.filterType == 'undefined') {
				headerCell.filterType = HEADER_DEFAULTS.filterType;
			}

			if (typeof headerCell.filterDisabled == 'undefined') {
				headerCell.filterDisabled = HEADER_DEFAULTS.filterDisabled;
			}

			if (typeof headerCell.sortDisabled == 'undefined') {
				headerCell.sortDisabled = HEADER_DEFAULTS.sortDisabled;
			}

			hRow.push(headerCell);

			if (typeof headerCell.colspan != 'undefined') {
				for (var i = 1; i < headerCell.colspan; i++) {
					hRow.push({});
				}
			}
		});

		processedHeaders.push(hRow);
	});

	config.fixedHeaders.forEach(function(headerRow) {
		var hRow = [];

		headerRow.forEach(function(headerCell) {
			if (typeof headerCell.dataType == 'undefined') {
				headerCell.dataType = HEADER_DEFAULTS.dataType;
			}

			if (typeof headerCell.filterType == 'undefined') {
				headerCell.filterType = HEADER_DEFAULTS.filterType;
			}

			if (typeof headerCell.filterDisabled == 'undefined') {
				headerCell.filterDisabled = HEADER_DEFAULTS.filterDisabled;
			}

			if (typeof headerCell.sortDisabled == 'undefined') {
				headerCell.sortDisabled = HEADER_DEFAULTS.sortDisabled;
			}

			hRow.push(headerCell);

			if (typeof headerCell.colspan != 'undefined') {
				for (var i = 1; i < headerCell.colspan; i++) {
					hRow.push({});
				}
			}
		});

		processedFixedHeaders.push(hRow);
	});

	config.headers = processedHeaders;
	config.fixedHeaders = processedFixedHeaders;
}

function initDataSource(config, uniqueRowKey) {
	if (typeof uniqueRowKey == 'undefined') {
		for (var i = 0; i < config.dataSource.length; i++) {
			config.dataSource[i][config.uniqueRowKey] = i;
		}
	}
}

function updateValue(config, options, key) {
	var target = getInnerObject(config, key), // eslint-disable-line no-unused-vars
		value = getInnerValue(options, key),
		keys = key.split('.'),
		lastKey = keys[keys.length - 1];

	if (typeof value == 'undefined') {
		target[lastKey] = typeof getInnerValue(DEFAULTS, key) == 'function' ? getInnerValue(DEFAULTS, key)(config) : getInnerValue(DEFAULTS, key);
	} else {
		target[lastKey] = value;
	}
}

function getInnerObject(object, key) {
	if (key.indexOf('.') === -1) {
		return object;
	}

	var subKey = key.split('.')[0],
		subObject = object[subKey];

	if (typeof subObject == 'undefined') {
		object[subKey] = {};
		subObject = object[subKey];
	}

	return getInnerObject(subObject, key.substring(key.indexOf('.') + 1));
}

function getInnerValue(object, key) {
	if (key.indexOf('.') === -1) {
		return object[key];
	}

	var subKey = key.split('.')[0],
		subObject = object[subKey];

	if (typeof subObject == 'undefined') {
		return subObject;
	}

	return getInnerValue(subObject, key.substring(key.indexOf('.') + 1));
}

module.exports = {
	init: init,
	DEFAULTS: DEFAULTS
};
},{"../utils/configuration":24,"../utils/data":25}],13:[function(require,module,exports){
'use strict';

var tableUtil  = require('../utils/table'),
	configUtil = require('../utils/configuration'),
	domUtil    = require('../utils/dom');

function updateCell(config, cellElement, cellData) {
	cellElement.innerHTML = cellData.getValue();
	cellElement.className = config.inner.selectors.dataCell + ' ' + (cellData.class || '');
}

function updateTable(config, forceUpdate) {
	var colspan = 1;

	if (config.inner.previousLeftCellOffset === config.inner.leftCellOffset &&
		config.inner.previousTopCellOffset === config.inner.topCellOffset &&
		forceUpdate === false) {

		return;
	}

	config.inner.previousLeftCellOffset = config.inner.leftCellOffset;
	config.inner.previousTopCellOffset = config.inner.topCellOffset;

	// Header cell update
	document.querySelectorAll('.' + config.selectors.virtualTable + ' tr.' + config.inner.selectors.headerRow).forEach(function(row, rowCount) {
		row.querySelectorAll('td.' + config.inner.selectors.headerCell).forEach(function(cell, cellCount) {
			var cellObj = config.headers[rowCount][config.inner.leftCellOffset + cellCount],
				isLastRow = config.inner.indexOfCellKeyHeader === rowCount;

			if (colspan > 1) {
				cell.style.display = 'none';
				colspan--;
			} else {
				cell.innerHTML = domUtil.getHeaderCellHtml(config, cell, cellObj, isLastRow);
				cell.style.display = 'table-cell';
			}

			if (typeof cellObj.colspan == 'undefined') {
				cell.removeAttribute('colspan');
			} else {
				var calculatedColspan = config.inner.visibleColumnNumber <= cellCount + cellObj.colspan ? config.inner.visibleColumnNumber - cellCount : cellObj.colspan;

				cell.setAttribute('colspan', calculatedColspan);
				colspan = calculatedColspan;
			}
		});
		colspan = 1;
	});

	// Fixed header cell update
	document.querySelectorAll('.' + config.selectors.fixedTable + ' tr.' + config.inner.selectors.headerRow).forEach(function(row, rowCount) {
		row.querySelectorAll('td.' + config.inner.selectors.headerCell).forEach(function(cell, cellCount) {
			var cellObj = config.fixedHeaders[rowCount][cellCount],
				isLastRow = config.inner.indexOfCellKeyHeader === rowCount;

			cell.innerHTML = domUtil.getHeaderCellHtml(config, cell, cellObj, isLastRow);
		});
	});

	// Filter row update
	if (config.filter.enabled) {
		document.querySelectorAll('.' + config.selectors.virtualTable + ' td.' + config.inner.selectors.filterCell).forEach(function(cell, cellCount) {
			var cellObj = configUtil.getKeyHeader(config)[config.inner.leftCellOffset + cellCount],
				filterObj = config.inner.filters[cellObj.key] || {},
				currentFilterAttr = cell.getAttribute('data-attribute');

			if (cellObj.key === currentFilterAttr) {
				return;
			}

			cell.setAttribute('data-attribute', cellObj.key);
			cell.classList.toggle(config.inner.selectors.filterDisabled, cellObj.filterDisabled);
			cell.innerHTML = domUtil.getFilterCellHtml(config, cell, cellObj, filterObj);
		});

		document.querySelectorAll('.' + config.selectors.fixedTable + ' td.' + config.inner.selectors.filterCell).forEach(function(cell, cellCount) {
			var cellObj = config.fixedHeaders[config.inner.indexOfCellKeyHeader][cellCount],
				filterObj = config.inner.filters[cellObj.key] || {},
				currentFilterAttr = cell.getAttribute('data-attribute');

			if (cellObj.key === currentFilterAttr) {
				return;
			}

			cell.setAttribute('data-attribute', cellObj.key);
			cell.classList.toggle(config.inner.selectors.filterDisabled, cellObj.filterDisabled);
			cell.innerHTML = domUtil.getFilterCellHtml(config, cell, cellObj, filterObj);
		});
	}

	// Cell data row update
	document.querySelectorAll('.' + config.selectors.virtualTable + ' tr.' + config.inner.selectors.dataRow).forEach(function(row, rowNumber) {
		row.querySelectorAll('td.' + config.inner.selectors.dataCell).forEach(function(cell, cellNumber) {
			var cellData = tableUtil.getCellData(config, config.inner.topCellOffset + rowNumber, config.inner.leftCellOffset + cellNumber);

			updateCell(config, cell, cellData);
		});
	});

	// Fixed cell data row update
	document.querySelectorAll('.' + config.selectors.fixedTable + ' tr.' + config.inner.selectors.dataRow).forEach(function(row, rowNumber) {
		row.querySelectorAll('td.' + config.inner.selectors.dataCell).forEach(function(cell, cellNumber) {
			var fixedCellData = tableUtil.getFixedCellData(config, config.inner.topCellOffset + rowNumber, cellNumber);

			updateCell(config, cell, fixedCellData);
		});
	});
}

function updateBuffers(config) {
	var virtualContainer = document.querySelector('.' + config.selectors.virtualContainer),
		cellFullWidth = configUtil.getCellFullWidth(config),
		left = virtualContainer.scrollLeft - virtualContainer.scrollLeft % cellFullWidth - config.inner.colspanOffset * cellFullWidth,
		right = config.inner.tableOffsetWidth - left,
		top = virtualContainer.scrollTop,
		bottom = config.inner.tableOffsetHeight - top;

	left = left > config.inner.tableOffsetWidth ? config.inner.tableOffsetWidth : left;
	left = left < config.inner.minBufferWidth ? config.inner.minBufferWidth : left;
	right = config.inner.tableOffsetWidth - left;
	top = top + config.inner.minBufferHeight > config.inner.tableOffsetHeight ? config.inner.tableOffsetHeight - config.inner.minBufferHeight : top + config.inner.minBufferHeight;
	bottom = config.inner.tableOffsetHeight > top ? config.inner.tableOffsetHeight - top : config.inner.minBufferHeight;

	config.inner.leftCellOffset = Math.floor(left / cellFullWidth);
	config.inner.topCellOffset = Math.floor((top - top % config.dimensions.cellHeight) / config.dimensions.cellHeight);

	config.inner.bufferLeft.forEach(function(el) {
		el.style.minWidth = left + 'px';
	});
	config.inner.bufferRight.forEach(function(el) {
		el.style.minWidth = right + 'px';
	});
	config.inner.bufferTop.forEach(function(el) {
		el.style.height = top + 'px';
	});
	config.inner.bufferBottom.forEach(function(el) {
		el.style.height = bottom + 'px';
	});
}

function recalculateDimensions(config) {
	var smallerTable = config.dataSource.length < config.inner.visibleRowNumber,
		virtualContainer = document.querySelector('.' + config.selectors.virtualContainer);

	virtualContainer.classList.toggle('no-vertical-scroll', smallerTable);

	if (smallerTable) {
		virtualContainer.scrollTop = 0;
	}

	config.inner.tableOffsetWidth = configUtil.getTableOffsetWidth(config);
	config.inner.tableOffsetHeight = configUtil.getTableOffsetHeight(config);
}

function resetEditingCell(config, eventHandlers) {
	document.querySelectorAll('.' + config.selectors.virtualTable + ' td.' + config.selectors.editingCell).forEach(function(editingCell) {
		var input = editingCell.querySelector('input');

		input.removeEventListener('blur', eventHandlers.onInputBlurEventHandler);
		input.removeEventListener('keyup', eventHandlers.onInputKeyUpEventHandler);

		editingCell.innerHTML = input.value;
		editingCell.classList.remove(config.selectors.editingCell);
	});
}

function resetEditedCells(config) {
	document.querySelectorAll('.' + config.selectors.virtualTable + ' td.' + config.selectors.editingCell).forEach(function(editedCell) {
		editedCell.classList.remove(config.selectors.editedCell);
	});

	updateTable(config);
}

function destroyTable(config) {
	document.querySelector(config.selectors.mainContainer).innerHTML = '';
}

module.exports = {
	updateCell: updateCell,
	updateTable: updateTable,
	updateBuffers: updateBuffers,
	recalculateDimensions: recalculateDimensions,
	resetEditingCell: resetEditingCell,
	resetEditedCells: resetEditedCells,
	destroyTable: destroyTable
};
},{"../utils/configuration":24,"../utils/dom":26,"../utils/table":28}],14:[function(require,module,exports){
'use strict';

var BeforeEditArgs = require('../models/event-arguments/before-edit'),
	BeforeSaveArgs = require('../models/event-arguments/before-save'),
	ValidationArgs = require('../models/event-arguments/validation'),
	SaveRowArgs    = require('../models/event-arguments/save-row'),
	SaveBatchArgs  = require('../models/event-arguments/save-batch'),
	AfterEditArgs  = require('../models/event-arguments/after-edit'),
	AfterSaveArgs  = require('../models/event-arguments/after-save'),
	tableUtil      = require('../utils/table'),
	domUtil        = require('../utils/dom'),
	domModule      = require('../modules/dom'),
	filterModule   = require('../modules/filter');

function startEditingCell(config, cellElement, instances, eventHandlers) {
	if (!config.edit.enabled) {
		return;
	}

	var rowNumber = domUtil.getRowNumber(config, cellElement),
		columnNumber = domUtil.getColumnNumber(config, cellElement);

	if (rowNumber >= config.dataSource.length) {
		return;
	}

	var cellData = tableUtil.getCellData(config, rowNumber, columnNumber),
		inputElement = document.createElement('input');

	inputElement.setAttribute('type', cellData.dataType);

	var beforeEditArgs = new BeforeEditArgs({
		cellElement: cellElement,
		cellData: cellData,
		cancelEvent: false
	});

	config.eventHandlers.onBeforeEdit(beforeEditArgs);

	if (!beforeEditArgs.cancelEvent) {
		cellElement.classList.add(config.selectors.editingCell);
		cellElement.classList.remove(config.selectors.editedCell);
		cellElement.innerHTML = '';
		cellElement.appendChild(inputElement);

		instances.onInputBlurEventHandler = function(ev) { eventHandlers.onInputBlurEventHandler(ev, config); };
		instances.onInputKeyUpEventHandler = function(ev) { eventHandlers.onInputKeyUpEventHandler(ev, config); };

		inputElement.focus();
		inputElement.value = cellData.getValue();
		inputElement.addEventListener('blur', instances.onInputBlurEventHandler);
		inputElement.addEventListener('keyup', instances.onInputKeyUpEventHandler);
	}
}

function finishEditingCell(config, inputElement, eventHandlers) {
	var cellElement = inputElement.parentNode,
		rowNumber = domUtil.getRowNumber(config, cellElement),
		columnNumber = domUtil.getColumnNumber(config, cellElement),
		cellData = tableUtil.getCellData(config, rowNumber, columnNumber),
		updatedValue = inputElement.value;

	cellData.updateAttributes({ class: config.selectors.editedCell });
	cellData.updateValue(updatedValue);

	if (!cellData.isCellChanged()) {
		domModule.resetEditingCell(config, eventHandlers);

		return;
	}

	var validationArgs = new ValidationArgs({
		cellElement: cellElement,
		cellData: cellData,
		cancelEvent: false
	});

	config.eventHandlers.onValidation(validationArgs);

	if (validationArgs.cancelEdit !== true) {
		tableUtil.storeUpdatedCellValue(config, cellData);
		domModule.updateCell(config, cellElement, cellData);

		var afterEditArgs = new AfterEditArgs({
			cellElement: cellElement,
			cellData: cellData
		});

		config.eventHandlers.onAfterEdit(afterEditArgs);

		filterModule.filter(config);
	}
}

function cancelEditingCell(config) {
	return '';
}

function saveCells(config) {
	if (!config.edit.enabled) {
		return;
	}

	var beforeSaveArgs = new BeforeSaveArgs({
		editedRows: config.inner.editedValues,
		cancelEvent: false
	});

	config.eventHandlers.onBeforeSave(beforeSaveArgs);

	if (beforeSaveArgs.cancelEvent) {
		return;
	}

	if (config.edit.mode === 'row') { // Row mode
		var saveRowArgs = new SaveRowArgs({ cancelEvent: false });

		config.dataSource.forEach(function(row) {
			saveRowArgs = new SaveRowArgs({
				editedRow: config.inner.editedValues,
				cancelEvent: false
			});

			if (!saveRowArgs.cancelEvent) {
				config.eventHandlers.onSavingRow(saveRowArgs);
			}

			if (!saveRowArgs.cancelEvent) {
				tableUtil.persistRowValues(config, row);
			}
		});

		if (!saveRowArgs.cancelEvent) {
			return;
		}
	} else if (config.edit.mode === 'batch') { // Batch mode
		var saveBatchArgs = new SaveBatchArgs({
			editedRows: config.inner.editedValues,
			cancelEvent: false
		});

		config.eventHandlers.onSavingBatch(saveBatchArgs);

		if (saveBatchArgs.cancelEvent) {
			return;
		}

		tableUtil.persistBatchValues(config);
	}

	var afterSaveArgs = new AfterSaveArgs({
		savedRows: config.inner.editedValues
	});

	domModule.resetEditedCells(config);

	config.eventHandlers.onAfterSave(afterSaveArgs);
}

module.exports = {
	startEditingCell: startEditingCell,
	finishEditingCell: finishEditingCell,
	cancelEditingCell: cancelEditingCell,
	saveCells: saveCells
};
},{"../models/event-arguments/after-edit":3,"../models/event-arguments/after-save":4,"../models/event-arguments/before-edit":5,"../models/event-arguments/before-save":6,"../models/event-arguments/save-batch":7,"../models/event-arguments/save-row":8,"../models/event-arguments/validation":9,"../modules/dom":13,"../modules/filter":16,"../utils/dom":26,"../utils/table":28}],15:[function(require,module,exports){
'use strict';

var domUtil      = require('../utils/dom'),
	keyboardUtil = require('../utils/keyboard'),
	sortModule   = require('../modules/sort'),
	editModule   = require('../modules/edit'),
	domModule    = require('../modules/dom'),
	filterModule = require('../modules/filter'),
	resizeModule = require('../modules/resize');

var container;

var instances = {
	onScrollEventHandler: function() {},
	onInputBlurEventHandler: function() {},
	onClickCellEventHandler: function() {},
	onClickSaveButtonEventHandler: function() {},
	onClickSortHeader: function() {},
	onClickFilterHeader: function() {},
	onWindowResize: function() {}
};

function onWheelEventHandler(event) {
	event.preventDefault();

	container.scrollTop += event.deltaY;
	container.scrollLeft += event.deltaX;
}

function onScrollEventHandler(event, config) {
	domModule.resetEditingCell(config, instances.onInputBlurEventHandler);
	domModule.updateBuffers(config);
	domModule.updateTable(config, false);
}

function onClickCellEventHandler(event, config) {
	if (event.target.matches('input')) {
		return;
	}

	editModule.startEditingCell(config, event.target, instances, {
		onInputBlurEventHandler: onInputBlurEventHandler,
		onInputKeyUpEventHandler: onInputKeyUpEventHandler
	});
}

function onInputBlurEventHandler(event, config) {
	editModule.finishEditingCell(config, event.target, {
		onInputBlurEventHandler: onInputBlurEventHandler,
		onInputKeyUpEventHandler: onInputKeyUpEventHandler
	});
}

function onInputKeyUpEventHandler(event, config) {
	var keyCode = keyboardUtil.getKeyCode(event);

	switch (keyCode) {
		case keyboardUtil.KEY_CODES.ENTER:
			event.target.removeEventListener('blur', instances.onInputBlurEventHandler);
			editModule.finishEditingCell(config, event.target, {
				onInputBlurEventHandler: onInputBlurEventHandler,
				onInputKeyUpEventHandler: onInputKeyUpEventHandler
			});
			break;
		case keyboardUtil.KEY_CODES.ESCAPE:
			editModule.cancelEditingCell(config, event.target, {
				onInputBlurEventHandler: onInputBlurEventHandler,
				onInputKeyUpEventHandler: onInputKeyUpEventHandler
			});
			break;
		default:
			break;
	}
}

function onClickSaveButtonEventHandler(event, config) {
	editModule.saveCells(config);
}

function onClickSortHeader(event, config) {
	var sortCellSelector = '.' + config.inner.selectors.sortCell,
		sortDisabledSelector = '.' + config.inner.selectors.sortDisabled,
		sortIconSelector = sortCellSelector + ' .' + config.inner.selectors.sortIcon;

	if (!event.target.matches(sortCellSelector) &&
		!event.target.matches(sortIconSelector) ||
		event.target.matches(sortDisabledSelector)) {
		return;
	}

	if (event.target.matches(sortIconSelector)) {
		sortModule.resetSort(config);
	}

	if (event.target.matches(sortCellSelector)) {
		sortModule.sortByColumn(config, event.target);
	}
}

function onClickFilterHeader(event, config) {
	var filterCellSelector = '.' + config.inner.selectors.filterCell,
		filterDisabledSelector = '.' + config.inner.selectors.filterDisabled,
		filterSearchIconSelector = filterCellSelector + ' .' + config.inner.selectors.filterSearchIcon,
		filterClearIconSelector = filterCellSelector + ' .' + config.inner.selectors.filterClearIcon;

	if (!event.target.matches(filterCellSelector) &&
		!event.target.matches(filterSearchIconSelector) &&
		!event.target.matches(filterClearIconSelector) ||
		event.target.matches(filterDisabledSelector)) {

		return;
	}

	var cell = event.target.matches(filterCellSelector) ? event.target : domUtil.findParentNode(event.target, filterCellSelector);

	if (event.target.matches(filterClearIconSelector)) {
		filterModule.clearFilter(config, cell);

		return;
	}

	filterModule.startEditingFilter(config, cell);
}

function onWindowResize(event, config) {
	if (document.querySelector('#' + config.inner.selectors.uniqueId) === null) {
		return;
	}

	resizeModule.resizeEventHandler(config);
}

function addEvents(config) {
	container = document.querySelector('.' + config.selectors.virtualContainer);

	instances.onScrollEventHandler = function(event) { onScrollEventHandler(event, config); };
	instances.onClickCellEventHandler = function(event) { onClickCellEventHandler(event, config); };
	instances.onClickSaveButtonEventHandler = function(event) { onClickSaveButtonEventHandler(event, config); };
	instances.onClickSortHeader = function(event) { onClickSortHeader(event, config); };
	instances.onClickFilterHeader = function(event) { onClickFilterHeader(event, config); };
	instances.onWindowResize = function(event) { onWindowResize(event, config); };

	if (container !== null) {
		container.addEventListener('wheel', onWheelEventHandler, { passive: false, capture: true });
		container.addEventListener('scroll', instances.onScrollEventHandler);
	}

	if (config.edit.enabled && config.selectors.saveButton !== null) {
		document.querySelector(config.selectors.saveButton).addEventListener('click', instances.onClickSaveButtonEventHandler);
	}

	if (config.edit.enabled) {
		document.querySelectorAll('.' + config.selectors.virtualTable + ' td.' + config.inner.selectors.dataCell).forEach(function(el) {
			el.addEventListener('click', instances.onClickCellEventHandler);
		});
	}

	if (config.sort.enabled) {
		document.querySelectorAll('#' + config.inner.selectors.uniqueId + ' td.' + config.inner.selectors.sortCell).forEach(function(el) {
			el.addEventListener('click', instances.onClickSortHeader);
		});
	}

	if (config.filter.enabled) {
		document.querySelectorAll('#' + config.inner.selectors.uniqueId + ' td.' + config.inner.selectors.filterCell).forEach(function(el) {
			el.addEventListener('click', instances.onClickFilterHeader);
		});
	}

	if (config.autoResize) {
		window.addEventListener('resize', instances.onWindowResize);
	}
}

function removeEvents(config) {
	container = document.querySelector('.' + config.selectors.virtualContainer);

	if (container !== null) {
		container.removeEventListener('wheel', onWheelEventHandler);
		container.removeEventListener('scroll', instances.onScrollEventHandler);
	}

	if (config.edit.enabled && config.selectors.saveButton !== null) {
		document.querySelector(config.selectors.saveButton).removeEventListener('click', instances.onClickSaveButtonEventHandler);
	}

	if (config.edit.enabled) {
		document.querySelectorAll('.' + config.selectors.virtualTable + ' td.' + config.inner.selectors.dataCell).forEach(function(el) {
			el.removeEventListener('click', instances.onClickCellEventHandler);
		});
	}

	if (config.sort.enabled) {
		document.querySelectorAll('#' + config.inner.selectors.uniqueId + ' td.' + config.inner.selectors.sortCell).forEach(function(el) {
			el.removeEventListener('click', instances.onClickSortHeader);
		});
	}

	if (config.filter.enabled) {
		document.querySelectorAll('#' + config.inner.selectors.uniqueId + ' td.' + config.inner.selectors.filterCell).forEach(function(el) {
			el.removeEventListener('click', instances.onClickFilterHeader);
		});
	}

	if (config.autoResize) {
		window.removeEventListener('resize', instances.onWindowResize);
	}
}

module.exports = {
	addEvents: addEvents,
	removeEvents: removeEvents
};
},{"../modules/dom":13,"../modules/edit":14,"../modules/filter":16,"../modules/resize":18,"../modules/sort":19,"../utils/dom":26,"../utils/keyboard":27}],16:[function(require,module,exports){
'use strict';

var domUtil    = require('../utils/dom'),
	domModule  = require('../modules/dom'),
	sortModule = require('../modules/sort'),
	dataUtil   = require('../utils/data'),
	configUtil = require('../utils/configuration');

function startEditingFilter(config, cell) {
	if (cell.querySelector('.' + config.inner.selectors.filterContainer) !== null) {
		return;
	}

	var attribute = cell.getAttribute('data-attribute'),
		filterObj = config.inner.filters[attribute] || {},
		headerObj = configUtil.getHeaderObject(config, attribute),
		clearIconClass = config.inner.icons.filter.clear,
		clearIconElementClass = config.inner.selectors.filterClearIcon + ' ' + clearIconClass;

	filterObj.attribute = attribute;
	filterObj.filterType = headerObj.filterType;
	filterObj.value = filterObj.value || '';

	config.inner.filters[attribute] = filterObj;

	var container = document.createElement('div');

	cell.innerHTML = '';
	cell.appendChild(container);

	container.classList.add(config.inner.selectors.filterContainer);
	container.innerHTML = '<input><i class="' + clearIconElementClass + '" aria-hidden="true"></i>';

	var input = container.querySelector('input');

	input.setAttribute('type', headerObj.dataType);
	input.value = filterObj.value;
	input.focus();
	input.addEventListener('keyup', function(event) {
		if ((event.keyCode || event.which) === 13) { // Enter key
			filterObj.value = dataUtil.getValueByType(input.value, headerObj.dataType);

			finishEditingFilter(config, cell, headerObj, filterObj);
		} else if ((event.keyCode || event.which) === 27) { // Escape key
			finishEditingFilter(config, cell, headerObj, filterObj);
		}
	});
}

function filter(config, sortTable) {
	sortTable = sortTable !== false;

	config.dataSource = config.inner.originalDataSource;

	Object.keys(config.inner.filters).forEach(function(key) {
		var filterObj = config.inner.filters[key];

		if (typeof filterObj.value == 'undefined' || filterObj.value === '') {
			return;
		}

		if (filterObj.filterType === 'custom') {
			if (config.filter.customFilter !== null) {
				config.dataSource = config.filter.customFilter({
					dataSource: config.dataSource,
					attribute: filterObj.attribute,
					value: filterObj.value,
					editedValues: config.inner.editedValues,
					uniqueRowKey: config.uniqueRowKey
				});
			}
		} else {
			config.dataSource = dataUtil.filterData({
				dataSource: config.dataSource,
				attribute: filterObj.attribute,
				filterType: filterObj.filterType,
				valueOne: filterObj.value,
				valueTwo: filterObj.valueTwo,
				editedValues: config.editedValues,
				uniqueRowKey: config.inner.uniqueRowKey
			});
		}
	});

	if (sortTable) {
		sortModule.sort(config, false);
	}

	domModule.recalculateDimensions(config);
	domModule.updateBuffers(config);
	domModule.updateTable(config);
}

function clearFilter(config, cell) {
	var attribute = cell.getAttribute('data-attribute'),
		cellObj = configUtil.getHeaderObject(config, attribute),
		filterObj = config.inner.filters[attribute];

	filterObj.value = '';

	var newFilters = {};

	Object.keys(config.inner.filters).forEach(function(key) {
		if (key !== attribute) {
			newFilters[key] = config.inner.filters[key];
		}
	});

	config.inner.filters = newFilters;

	finishEditingFilter(config, cell, cellObj, filterObj);
}

function finishEditingFilter(config, cell, cellObj, filterObj) {
	cell.innerHTML = domUtil.getFilterCellHtml(config, cell, cellObj, filterObj);

	filter(config);
}

module.exports = {
	startEditingFilter: startEditingFilter,
	filter: filter,
	clearFilter: clearFilter
};
},{"../modules/dom":13,"../modules/sort":19,"../utils/configuration":24,"../utils/data":25,"../utils/dom":26}],17:[function(require,module,exports){
'use strict';

var configuration      = require('./configuration'),
	configUtil         = require('../utils/configuration'),
	eventHandlerModule = require('../modules/event-handler'),
	domUtil            = require('../utils/dom'),
	dataUtil           = require('../utils/data'),
	domModule          = require('../modules/dom');

function generateTable(config, options) {
	configuration.init(config, options, initContainers);

	initTable(config);

	domModule.updateBuffers(config);
	domModule.updateTable(config);

	eventHandlerModule.addEvents(config);
}

function destroyTable(config) {
	eventHandlerModule.removeEvents(config);
	domModule.destroyTable(config);
}

function initContainers(config) {
	var container = document.querySelector(config.selectors.mainContainer),
		virtualContainer = document.createElement('div'),
		virtualTable = document.createElement('table'),
		fixedContainer = document.createElement('div'),
		fixedTable = document.createElement('table');

	container.setAttribute('id', config.inner.selectors.uniqueId);
	virtualContainer.classList.add(config.selectors.virtualContainer);
	virtualTable.classList.add(config.selectors.virtualTable);
	fixedContainer.classList.add(config.selectors.fixedContainer);
	fixedTable.classList.add(config.selectors.fixedTable);

	container.appendChild(fixedContainer);
	fixedContainer.appendChild(fixedTable);

	container.appendChild(virtualContainer);
	virtualContainer.appendChild(virtualTable);

	virtualContainer.style.maxHeight = config.dimensions.containerHeight + 'px';
	virtualContainer.style.height = config.dimensions.containerHeight + 'px';
	virtualContainer.style.overflow = 'scroll';

	fixedContainer.style.padding = config.inner.minBufferHeight + 'px 0';
	fixedContainer.style.float = 'left';
}

function initTable(config) {
	// Generate virtual table
	var virtualThead = document.createElement('thead'),
		virtualTbody = document.createElement('tbody'),
		trHeadBuffer = document.createElement('tr'),
		columnsNumber = configUtil.getKeyHeader(config).length,
		rowsNumber = config.dataSource.length,
		maxColumnNumber = config.inner.visibleColumnNumber >= columnsNumber ? columnsNumber : config.inner.visibleColumnNumber,
		maxRowNumber = config.inner.visibleRowNumber >= rowsNumber ? rowsNumber : config.inner.visibleRowNumber;

	trHeadBuffer.classList.add(config.inner.selectors.bufferRowTop);

	var i, j, trHead, trBody, bufferColumnLeft, bufferColumnRight, bufferRowBottom, tdElement, cellObj;

	// Generate virtual header
	bufferColumnLeft = document.createElement('td');
	bufferColumnLeft.classList.add(config.inner.selectors.bufferColumnLeft);

	trHeadBuffer.appendChild(bufferColumnLeft);

	for (i = 0; i < maxColumnNumber; i++) {
		tdElement = document.createElement('td');
		tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
		trHeadBuffer.appendChild(tdElement);
	}

	bufferColumnRight = document.createElement('td');
	bufferColumnRight.classList.add(config.inner.selectors.bufferColumnRight);

	trHeadBuffer.appendChild(bufferColumnRight);

	virtualThead.appendChild(trHeadBuffer);

	config.headers.forEach(function(headerRow, rowCount) {
		var isLastRow = config.inner.indexOfCellKeyHeader === rowCount;

		trHead = document.createElement('tr');
		trHead.classList.add(config.inner.selectors.headerRow);
		trHead.style.height = config.dimensions.cellHeight + 'px';

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnLeft);

		trHead.appendChild(tdElement);

		for (j = 0; j < maxColumnNumber; j++) {
			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.headerCell);
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
			tdElement.style.padding = config.dimensions.cellPaddingVertical + 'px ' + config.dimensions.cellPaddingHorizontal + 'px';
			tdElement.innerHTML = domUtil.getHeaderCellHtml(config, tdElement, headerRow[j], isLastRow);

			if (isLastRow) {
				tdElement.classList.add(config.inner.selectors.sortCell);

				if (!config.sort.enabled || headerRow[j].sortDisabled) {
					tdElement.classList.add(config.inner.selectors.sortDisabled);
				}
			}

			trHead.appendChild(tdElement);
		}

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnRight);

		trHead.appendChild(tdElement);

		virtualThead.appendChild(trHead);
	});

	// Generate virtual filter row
	if (config.filter.enabled) {
		trHead = document.createElement('tr');
		trHead.classList.add(config.inner.selectors.filterRow);
		trHead.style.height = config.dimensions.cellHeight + 'px';

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnLeft);

		trHead.appendChild(tdElement);

		for (j = 0; j < maxColumnNumber; j++) {
			cellObj = configUtil.getKeyHeader(config)[j];

			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.filterCell);
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
			tdElement.style.padding = config.dimensions.cellPaddingVertical + 'px ' + config.dimensions.cellPaddingHorizontal + 'px';
			tdElement.innerHTML = domUtil.getFilterCellHtml(config, tdElement, cellObj, {});

			if (cellObj.filterDisabled) {
				tdElement.classList.add(config.inner.selectors.filterDisabled);
			}

			trHead.appendChild(tdElement);
		}

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnRight);

		trHead.appendChild(tdElement);

		virtualThead.appendChild(trHead);
	}

	// Generate virtual body
	for (i = 0; i < maxRowNumber; i++) {
		trBody = document.createElement('tr');
		trBody.classList.add(config.inner.selectors.dataRow);
		trBody.style.height = config.dimensions.cellHeight + 'px';

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnLeft);

		trBody.appendChild(tdElement);

		for (j = 0; j < maxColumnNumber; j++) {
			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.dataCell);
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
			tdElement.style.padding = config.dimensions.cellPaddingVertical + 'px ' + config.dimensions.cellPaddingHorizontal + 'px';

			trBody.appendChild(tdElement);
		}

		tdElement = document.createElement('td');
		tdElement.classList.add(config.inner.selectors.bufferColumnRight);

		trBody.appendChild(tdElement);

		virtualTbody.appendChild(trBody);
	}

	bufferRowBottom = document.createElement('tr');
	bufferRowBottom.classList.add(config.inner.selectors.bufferRowBottom);

	virtualTbody.appendChild(bufferRowBottom);

	document.querySelector('.' + config.selectors.virtualTable).appendChild(virtualThead);
	document.querySelector('.' + config.selectors.virtualTable).appendChild(virtualTbody);

	config.inner.bufferLeft = document.querySelectorAll('.' + config.inner.selectors.bufferColumnLeft);
	config.inner.bufferRight = document.querySelectorAll('.' + config.inner.selectors.bufferColumnRight);
	config.inner.bufferTop = document.querySelectorAll('.' + config.inner.selectors.bufferRowTop);
	config.inner.bufferBottom = document.querySelectorAll('.' + config.inner.selectors.bufferRowBottom);

	// Generate fixed table

	if (config.fixedHeaders.length === 0 || config.fixedHeaders[0].length === 0) {
		document.querySelector('.' + config.selectors.fixedTable).remove();

		return;
	}

	var fixedThead = document.createElement('thead'),
		fixedTbody = document.createElement('tbody');

	// Generate fixed header

	for (i = 0; i < config.fixedHeaders.length; i++) {
		trHead = document.createElement('tr');
		trHead.classList.add(config.inner.selectors.headerRow);
		trHead.style.height = config.dimensions.cellHeight + 'px';

		for (j = 0; j < config.fixedHeaders[i].length; j++) {
			var isLastRow = j === config.fixedHeaders[i].length - 1;

			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.headerCell);
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
			tdElement.innerHTML = domUtil.getHeaderCellHtml(config, tdElement, config.fixedHeaders[i][j], isLastRow);

			if (isLastRow) {
				tdElement.classList.add(config.inner.selectors.sortCell);

				if (!config.sort.enabled || config.fixedHeaders[i][j].sortDisabled) {
					tdElement.classList.add(config.inner.selectors.sortDisabled);
				}
			}

			trHead.appendChild(tdElement);
		}

		fixedThead.appendChild(trHead);
	}

	// Generate fixed filter row

	if (config.filter.enabled &&
		config.fixedHeaders.length > 0 &&
		config.fixedHeaders[config.inner.indexOfCellKeyHeader].length > 0) {

		trHead = document.createElement('tr');
		trHead.classList.add(config.inner.selectors.filterRow);
		trHead.style.height = config.dimensions.cellHeight + 'px';

		for (j = 0; j < config.fixedHeaders[config.inner.indexOfCellKeyHeader].length; j++) {
			cellObj = configUtil.getFixedKeyHeader(config)[j];

			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.filterCell);
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';
			tdElement.style.maxWidth = config.dimensions.cellWidth + 'px';
			tdElement.style.padding = config.dimensions.cellPaddingVertical + 'px ' + config.dimensions.cellPaddingHorizontal + 'px';
			tdElement.innerHTML = domUtil.getFilterCellHtml(config, tdElement, cellObj, {});

			if (cellObj.filterDisabled) {
				tdElement.classList.add(config.inner.selectors.filterDisabled);
			}

			trHead.appendChild(tdElement);
		}

		fixedThead.appendChild(trHead);
	}

	// Generate fixed body

	for (i = 0; i < maxRowNumber; i++) {
		trBody = document.createElement('tr');
		trBody.classList.add(config.inner.selectors.dataRow);
		trBody.style.height = config.dimensions.cellHeight + 'px';

		for (j = 0; j < config.fixedHeaders[config.inner.indexOfCellKeyHeader].length; j++) {
			tdElement = document.createElement('td');
			tdElement.classList.add(config.inner.selectors.dataCell);
			tdElement.style.padding = config.dimensions.cellPaddingVertical + 'px ' + config.dimensions.cellPaddingHorizontal + 'px';
			tdElement.style.minWidth = config.dimensions.cellWidth + 'px';

			trBody.appendChild(tdElement);
		}

		fixedTbody.appendChild(trBody);
	}

	document.querySelector('.' + config.selectors.fixedTable).appendChild(fixedThead);
	document.querySelector('.' + config.selectors.fixedTable).appendChild(fixedTbody);
}

function getDefaultOptions() {
	return dataUtil.cloneObject(configuration.DEFAULTS);
}

module.exports = {
	generateTable: generateTable,
	destroyTable: destroyTable,
	getDefaultOptions: getDefaultOptions
};
},{"../modules/dom":13,"../modules/event-handler":15,"../utils/configuration":24,"../utils/data":25,"../utils/dom":26,"./configuration":12}],18:[function(require,module,exports){
'use strict';

var configUtil = require('../utils/configuration'),
	domModule  = require('../modules/dom');

var DELAY = 200;

var isEventDelayed = false;

function redrawTable(config) {
	var prevRowNumber = config.inner.visibleRowNumber,
		prevColumnNumber = config.inner.visibleColumnNumber;

	config.dimensions.containerHeight = configUtil.calculateVirtualContainerHeight(config, configUtil.getDefaultContainerHeight(config));
	config.inner.visibleRowNumber = configUtil.getVisibleRowNumber(config);
	config.inner.visibleColumnNumber = configUtil.getVisibleColumnNumber(config);
	config.inner.tableOffsetWidth = configUtil.getTableOffsetWidth(config);
	config.inner.tableOffsetHeight = configUtil.getTableOffsetHeight(config);

	var i, lastRow, lastColumns;

	if (prevRowNumber === config.inner.visibleRowNumber &&
		prevColumnNumber === config.inner.visibleColumnNumber) {

		return;
	}

	if (config.inner.visibleRowNumber < 1) {
		config.inner.visibleRowNumber = 1;

		return;
	}

	var virtualContainerSelector = '#' + config.inner.selectors.uniqueId + ' .' + config.selectors.virtualContainer,
		lastFixedRowSelector = '#' + config.inner.selectors.uniqueId + ' .' + config.selectors.fixedTable + ' .data-row:last-of-type',
		lastVirtualRowSelector = '#' + config.inner.selectors.uniqueId + ' .' + config.selectors.virtualTable + ' .data-row:nth-last-of-type(2)',
		lastVirtualColumn = '#' + config.inner.selectors.uniqueId + ' .' + config.selectors.virtualTable + ' td:nth-last-of-type(2)';

	var virtualContainer = document.querySelector(virtualContainerSelector);

	virtualContainer.style.maxHeight = config.dimensions.containerHeight + 'px';
	virtualContainer.style.height = config.dimensions.containerHeight + 'px';

	if (prevRowNumber < config.inner.visibleRowNumber) { // Ha több sor lett
		for (i = 0; i < config.inner.visibleRowNumber - prevRowNumber; i++) {
			lastRow = document.querySelector(lastFixedRowSelector);

			if (lastRow !== null) {
				lastRow.parentNode.insertBefore(lastRow.cloneNode(true), lastRow);
			}

			lastRow = document.querySelector(lastVirtualRowSelector);
			lastRow.parentNode.insertBefore(lastRow.cloneNode(true), lastRow);
		}
	} else if (prevRowNumber > config.inner.visibleRowNumber) { // Ha kevesebb sor lett
		for (i = 0; i < prevRowNumber - config.inner.visibleRowNumber; i++) {
			lastRow = document.querySelector(lastFixedRowSelector);

			if (lastRow !== null) {
				lastRow.remove();
			}

			lastRow = document.querySelector(lastVirtualRowSelector);
			lastRow.remove();
		}
	}

	if (prevColumnNumber < config.inner.visibleColumnNumber) { // Ha több oszlop lett
		for (i = 0; i < config.inner.visibleColumnNumber - prevColumnNumber; i++) {
			lastColumns = document.querySelectorAll(lastVirtualColumn);
			lastColumns.forEach(function(column) {
				column.parentNode.insertBefore(column.cloneNode(true), column);
			});
		}
	} else if (prevColumnNumber > config.inner.visibleColumnNumber) { // Ha kevesebb oszlop lett
		for (i = 0; i < prevColumnNumber - config.inner.visibleColumnNumber; i++) {
			lastColumns = document.querySelectorAll(lastVirtualColumn);
			lastColumns.forEach(function(column) {
				column.remove();
			});
		}
	}

	config.inner.bufferLeft = document.querySelectorAll('.' + config.inner.selectors.bufferColumnLeft);
	config.inner.bufferRight = document.querySelectorAll('.' + config.inner.selectors.bufferColumnRight);
	config.inner.bufferTop = document.querySelectorAll('.' + config.inner.selectors.bufferRowTop);
	config.inner.bufferBottom = document.querySelectorAll('.' + config.inner.selectors.bufferRowBottom);

	domModule.updateBuffers(config);
	domModule.updateTable(config);
}

function resizeEventHandler(config) {
	if (!isEventDelayed) {
		isEventDelayed = true;

		window.setTimeout(function() {
			isEventDelayed = false;

			redrawTable(config);
		}, DELAY);
	}
}

module.exports = {
	resizeEventHandler: resizeEventHandler
};
},{"../modules/dom":13,"../utils/configuration":24}],19:[function(require,module,exports){
'use strict';

var domModule  = require('../modules/dom'),
	configUtil = require('../utils/configuration'),
	dataUtil   = require('../utils/data');

function sortByColumn(config, column) {
	var attribute = column.getAttribute('data-attribute'),
		headerObj = configUtil.getHeaderObject(config, attribute),
		direction = 'up';

	if (config.inner.sort.attribute === attribute &&
		config.inner.sort.direction === 'up') {

		direction = 'down';
	}

	config.inner.sort.direction = direction;
	config.inner.sort.attribute = attribute;
	config.inner.sort.dataType = headerObj.dataType;

	sort(config);
}

function sort(config, updateTable) {
	updateTable = updateTable !== false;

	config.dataSource.sort(function(a, b) {
		if (config.sort.customSort !== null) {
			return config.sort.customSort(a, b, {
				attribute: config.inner.sort.attribute,
				direction: config.inner.sort.direction,
				dataType: config.inner.sort.dataType,
				editedValues: config.inner.editedValues,
				uniqueRowKey: config.uniqueRowKey
			});
		}

		var attribute = config.inner.sort.attribute || config.sort.default,
			direction = config.inner.sort.direction || 'down',
			dataType = config.inner.sort.dataType || getSortType(config, config.sort.default);

		return dataUtil.defaultComparator(a, b, {
			attribute: attribute,
			direction: direction,
			dataType: dataType,
			editedValues: config.inner.editedValues,
			uniqueRowKey: config.uniqueRowKey,
			name: config.locale.name
		});
	});

	if (updateTable) {
		domModule.updateTable(config);
	}
}

function resetSort(config) {
	config.inner.sort.attribute =
	config.inner.sort.direction =
	config.inner.sort.dataType = undefined; // eslint-disable-line no-undefined

	config.dataSource.sort(function(a, b) {
		if (config.sort.customSort !== null) {
			return config.sort.customSort(a, b, {
				attribute: config.sort.default,
				direction: 'down',
				dataType: getSortType(config, config.sort.default),
				editedValues: config.inner.editedValues,
				uniqueRowKey: config.uniqueRowKey
			});
		}

		return dataUtil.defaultComparator(a, b, {
			attribute: config.sort.default,
			direction: 'down',
			dataType: getSortType(config, config.sort.default),
			editedValues: config.inner.editedValues,
			uniqueRowKey: config.uniqueRowKey,
			name: config.locale.name
		});
	});

	domModule.updateTable(config);
}

function getSortType(config, attribute) {
	var headerObj = configUtil.getHeaderObject(config, attribute);

	return typeof headerObj == 'undefined' || typeof headerObj.dataType == 'undefined' ? 'string' : headerObj.dataType;
}

module.exports = {
	sortByColumn: sortByColumn,
	sort: sort,
	resetSort: resetSort
};
},{"../modules/dom":13,"../utils/configuration":24,"../utils/data":25}],20:[function(require,module,exports){
'use strict';

if (typeof Array.prototype.find == 'undefined') {
	Array.prototype.find = function(predicate) { // eslint-disable-line no-extend-native
		if (this === null) {
			throw new TypeError('Array.prototype.find called on null or undefined');
		}

		if (typeof predicate !== 'function') {
			throw new TypeError('predicate must be a function');
		}

		var list = Object(this);
		var length = list.length >>> 0;
		var thisArg = arguments[1];
		var value;

		for (var i = 0; i < length; i++) {
			value = list[i];
			if (predicate.call(thisArg, value, i, list)) {
				return value;
			}
		}

		return undefined; // eslint-disable-line no-undefined
	};
}
},{}],21:[function(require,module,exports){
'use strict';

if (!Element.prototype.matches) {
	Element.prototype.matches =
		Element.prototype.matchesSelector ||
		Element.prototype.mozMatchesSelector ||
		Element.prototype.msMatchesSelector ||
		Element.prototype.oMatchesSelector ||
		Element.prototype.webkitMatchesSelector ||
		function(s) {
			var matches = (this.document || this.ownerDocument).querySelectorAll(s),
				i = matches.length;

			while (--i >= 0 && matches.item(i) !== this) {} // eslint-disable-line
			return i > -1;
		};
}
},{}],22:[function(require,module,exports){
'use strict';

if (!NodeList.prototype.forEach) {
	NodeList.prototype.forEach = function(callback, argument) {
		argument = argument || window;

		for (var i = 0; i < this.length; i++) {
			callback.call(argument, this[i], i, this);
		}
	};
}
},{}],23:[function(require,module,exports){
'use strict';

if (typeof Object.assign != 'function') {
	// Must be writable: true, enumerable: false, configurable: true
	Object.defineProperty(Object, 'assign', {
		value: function assign(target) { // .length of function is 2
			if (target === null) { // TypeError if undefined or null
				throw new TypeError('Cannot convert undefined or null to object');
			}

			var to = Object(target);

			for (var index = 1; index < arguments.length; index++) {
				var nextSource = arguments[index];

				if (nextSource !== null) { // Skip over if undefined or null
					for (var nextKey in nextSource) {
						// Avoid bugs when hasOwnProperty is shadowed
						if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
							to[nextKey] = nextSource[nextKey];
						}
					}
				}
			}
			return to;
		},
		writable: true,
		configurable: true
	});
}
},{}],24:[function(require,module,exports){
'use strict';

function calculateVirtualContainerHeight(config, height) {
	if (typeof height == 'undefined') {
		return height;
	}

	return config.inner.minBufferHeight * 2 + Math.floor(height / config.dimensions.cellHeight) * config.dimensions.cellHeight;
}

function getDefaultContainerHeight(config) {
	return calculateVirtualContainerHeight(config, window.innerHeight - document.querySelector(config.selectors.mainContainer).getBoundingClientRect().top - 64);
}

function getIndexOfCellKeyHeader(config) {
	return config.headers.length - 1;
}

function getSortDefault(config) {
	return config.uniqueRowKey;
}

function getMaxColspan(config) {
	var maxVal = 1;

	config.headers.forEach(function(element) {
		element.forEach(function(subElement) {
			if (typeof subElement.colspan != 'undefined' && maxVal < subElement.colspan) {
				maxVal = subElement.colspan;
			}
		});
	});

	return maxVal;
}

function getVisibleRowNumber(config) {
	var hasFilter = config.filter.enabled,
		containerHeight = config.dimensions.containerHeight - config.inner.minBufferHeight * 2,
		dataCells = Math.floor(containerHeight / config.dimensions.cellHeight),
		headerCells = config.headers.length + (hasFilter ? 1 : 0);

	return dataCells - headerCells;
}

function getVisibleColumnNumber(config) {
	return Math.floor(document.querySelector('.' + config.selectors.virtualContainer).offsetWidth / getCellFullWidth(config) +
		(config.inner.colspanOffset > 2 ? config.inner.colspanOffset : 2) + config.inner.colspanOffset);
}

function getTableOffsetWidth(config) {
	var tabbleOffsetColumns = getKeyHeader(config).length < config.inner.visibleColumnNumber ? config.inner.minBufferWidth : getKeyHeader(config).length - config.inner.visibleColumnNumber;

	return tabbleOffsetColumns * getCellFullWidth(config);
}

function getTableOffsetHeight(config) {
	var tableOffsetRows = config.dataSource.length < config.inner.visibleRowNumber ? config.inner.minBufferHeight : config.dataSource.length - config.inner.visibleRowNumber + 1;

	return tableOffsetRows * config.dimensions.cellHeight;
}

function getCellFullWidth(config) {
	return config.dimensions.cellPaddingHorizontal * 2 + config.dimensions.cellWidth + config.dimensions.cellBorderWidth;
}

function getKeyHeader(config) {
	return config.headers[config.inner.indexOfCellKeyHeader];
}

function getFixedKeyHeader(config) {
	return config.fixedHeaders[config.inner.indexOfCellKeyHeader];
}

function getHeaderObject(config, attribute) {
	return getKeyHeader(config).find(function(column) {
		return column.key === attribute;
	}) || getFixedKeyHeader(config).find(function(column) {
		return column.key === attribute;
	});
}

function nil() {
	return function() {};
}

module.exports = {
	calculateVirtualContainerHeight: calculateVirtualContainerHeight,
	getDefaultContainerHeight: getDefaultContainerHeight,
	getIndexOfCellKeyHeader: getIndexOfCellKeyHeader,
	getSortDefault: getSortDefault,
	getMaxColspan: getMaxColspan,
	getVisibleRowNumber: getVisibleRowNumber,
	getVisibleColumnNumber: getVisibleColumnNumber,
	getTableOffsetWidth: getTableOffsetWidth,
	getTableOffsetHeight: getTableOffsetHeight,
	getCellFullWidth: getCellFullWidth,
	getKeyHeader: getKeyHeader,
	getFixedKeyHeader: getFixedKeyHeader,
	getHeaderObject: getHeaderObject,
	nil: nil
};
},{}],25:[function(require,module,exports){
'use strict';

var FILTER_TYPES = [ 'equals', 'equalsCaseInsensitive', 'like', 'likeCaseInsensitive', 'greaterThan', 'greaterOrEqual',
	'lessThan', 'lessOrEqual', 'between', 'betweenInclusive', 'contains' ];

function defaultComparator(a, b, options) {
	var attrA = getMergedValue(a, options.attribute, options.editedValues, options.uniqueRowKey),
		attrB = getMergedValue(b, options.attribute, options.editedValues, options.uniqueRowKey),
		isDown = options.direction === 'down';

	if (options.dataType === 'string') {
		var compareResult = 0;

		if (typeof attrA == 'undefined') {
			compareResult = -1;
		} else if (typeof attrB == 'undefined') {
			compareResult = 1;
		} else {
			attrA += '';
			attrB += '';

			compareResult = attrA.localeCompare(attrB, options.locale);
		}

		return isDown || compareResult === 0 ? compareResult : compareResult * -1;
	} else if (options.dataType === 'number') {
		attrA = parseFloat(attrA);
		attrB = parseFloat(attrB);

		if (isNaN(attrA)) {
			return isDown ? -1 : 1;
		}

		if (isNaN(attrB)) {
			return isDown ? 1 : -1;
		}
	}

	if (typeof attrA == 'undefined' && typeof attrB != 'undefined' || attrA < attrB) {
		return isDown ? -1 : 1;
	}

	if (typeof attrA != 'undefined' && typeof attrB == 'undefined' || attrA > attrB) {
		return isDown ? 1 : -1;
	}

	return 0;
}

function filterData(options) {
	if (FILTER_TYPES.indexOf(options.filterType) === -1) {
		window.console.error('Not a valid filter type! (' + options.filterType + ')');

		return options.dataSource;
	}

	switch (options.filterType) {
		case 'equals':
			return equalsFilter(options);
		case 'equalsCaseInsensitive':
			return equalsCaseInsensitiveFilter(options);
		case 'like':
			return likeFilter(options);
		case 'likeCaseInsensitive':
			return likeCaseInsensitiveFilter(options);
		case 'greaterThan':
			return greaterThanFilter(options);
		case 'greaterOrEqual':
			return greaterOrEqualFilter(options);
		case 'lessThan':
			return lessThanFilter(options);
		case 'lessOrEqual':
			return lessOrEqualFilter(options);
		case 'between':
			return betweenFilter(options);
		case 'betweenInclusive':
			return betweenInclusiveFilter(options);
		case 'contains':
			return containsFilter(options);
		default:
			return options.dataSource;
	}
}

function equalsFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) === options.valueOne;
	});
}

function equalsCaseInsensitiveFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey).toUpperCase() === options.valueOne.toUpperCase();
	});
}

function likeFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey).indexOf(options.valueOne) !== -1;
	});
}

function likeCaseInsensitiveFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey).toUpperCase().indexOf(options.valueOne.toUpperCase()) !== -1;
	});
}

function greaterThanFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) > options.valueOne;
	});
}

function greaterOrEqualFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) >= options.valueOne;
	});
}

function lessThanFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) < options.valueOne;
	});
}

function lessOrEqualFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) <= options.valueOne;
	});
}

function betweenFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) > options.valueOne && obj[options.attribute] < options.valueTwo;
	});
}

function betweenInclusiveFilter(options) {
	return options.dataSource.filter(function(obj) {
		return getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey) >= options.valueOne && obj[options.attribute] <= options.valueTwo;
	});
}

function containsFilter(options) {
	return options.dataSource.filter(function(obj) {
		return options.valueOne.indexOf(getMergedValue(obj, options.attribute, options.editedValues, options.uniqueRowKey)) !== -1;
	});
}

function getValueByType(value, dataType) {
	if (typeof value == 'undefined') {
		return value;
	}

	switch (dataType) {
		case 'string':
			return value.toString();
		case 'number':
			return parseFloat(value);
		default:
			return value;
	}
}

function getMergedValue(row, attribute, editedValues, uniqueRowKey) {
	var editedRow = editedValues[row[uniqueRowKey]];

	return typeof editedRow == 'undefined' || typeof editedRow[attribute] == 'undefined' ? row[attribute] : editedRow[attribute];
}

function cloneObject(obj) {
	return JSON.parse(JSON.stringify(obj));
}

module.exports = {
	defaultComparator: defaultComparator,
	filterData: filterData,
	getValueByType: getValueByType,
	cloneObject: cloneObject
};
},{}],26:[function(require,module,exports){
'use strict';

function indexOfElement(element) {
	var collection = element.parentNode.childNodes;

	for (var i = 0; i < collection.length; i++) {
		if (collection[i] === element) {
			return i;
		}
	}

	return -1;
}

function getHeaderCellHtml(config, cell, cellObj, isLastRow) {
	var innerHTML = '',
		columnText = cellObj.text || cellObj.key || '';

	if (config.sort.enabled && !cellObj.sortDisabled && isLastRow) {
		var attribute = cellObj.key,
			direction = typeof attribute != 'undefined' && config.inner.sort.attribute === attribute ? config.inner.sort.direction : 'none',
			isSorted = direction !== 'none',
			iconClass = direction === 'down' ? config.inner.icons.sort.asc : config.inner.icons.sort.desc,
			iconElementClass = config.inner.selectors.sortIcon + (isSorted ? ' ' + iconClass : 'hidden');

		innerHTML += '<i class="' + iconElementClass + '" aria-hidden="true"></i>';

		cell.setAttribute('data-attribute', attribute);
	}

	innerHTML += columnText;

	return innerHTML;
}

function getFilterCellHtml(config, cell, cellObj, filterObj) {
	var innerHTML = '',
		iconClass = config.inner.icons.filter.search,
		iconElementClass = config.inner.selectors.filterSearchIcon + ' ' + iconClass,
		clearIconClass = config.inner.icons.filter.clear,
		clearIconElementClass = config.inner.selectors.filterClearIcon + ' ' + clearIconClass;

	if (!cellObj.filterDisabled) {
		innerHTML += '<i class="' + iconElementClass + '" aria-hidden="true"></i>';
		innerHTML += filterObj.value || '';

		if (typeof filterObj.value != 'undefined' && filterObj.value !== '') {
			innerHTML += '<i class="' + clearIconElementClass + '" aria-hidden="true"></i>';
		}
	}

	return innerHTML;
}

function findParentNode(child, selector) {
	if (child.parentNode === null) {
		return null;
	} else if (child.parentNode.matches(selector)) {
		return child.parentNode;
	}

	return findParentNode(child.parentNode, selector);
}

function getRowNumber(config, cell) {
	return indexOfElement(cell.parentNode) + config.inner.topCellOffset;
}

function getColumnNumber(config, cell) {
	return indexOfElement(cell) - 1 + config.inner.leftCellOffset;
}

module.exports = {
	indexOfElement: indexOfElement,
	getHeaderCellHtml: getHeaderCellHtml,
	getFilterCellHtml: getFilterCellHtml,
	findParentNode: findParentNode,
	getRowNumber: getRowNumber,
	getColumnNumber: getColumnNumber
};
},{}],27:[function(require,module,exports){
'use strict';

var KEY_CODES = {
	ENTER: 13,
	ESCAPE: 27
};

function getKeyCode(event) {
	return event.keyCode || event.which;
}

module.exports = {
	getKeyCode: getKeyCode,
	KEY_CODES: KEY_CODES
};
},{}],28:[function(require,module,exports){
'use strict';

var Cell       = require('../models/table/cell'),
	configUtil = require('../utils/configuration');

function getCellData(config, rowNumber, columnNumber) {
	var cellData = null,
		headerObj = configUtil.getKeyHeader(config)[columnNumber],
		uniqueRowKey = null;

	// If the index is higher than the available rows number
	if (rowNumber >= config.dataSource.length) {
		cellData = new Cell({
			key: headerObj.key,
			value: '',
			dataType: headerObj.dataType
		});
	} else {
		uniqueRowKey = config.dataSource[rowNumber][config.uniqueRowKey];
		cellData = new Cell({
			key: headerObj.key,
			value: config.dataSource[rowNumber][headerObj.key],
			dataType: headerObj.dataType,
			rowNumber: rowNumber,
			columnNumber: columnNumber
		});

		if (typeof config.inner.editedValues[uniqueRowKey] != 'undefined' &&
			typeof config.inner.editedValues[uniqueRowKey][headerObj.key] != 'undefined') {

			cellData.class = config.selectors.editedCell;
			cellData.updateValue(config.inner.editedValues[uniqueRowKey][headerObj.key]);
		}
	}

	return cellData;
}

function getFixedCellData(config, rowNumber, columnNumber) {
	var cellData = null,
		headerObj = configUtil.getFixedKeyHeader(config)[columnNumber];

	// If the index is higher than the available rows number
	if (rowNumber >= config.dataSource.length) {
		cellData = new Cell({
			key: headerObj.key,
			value: '',
			dataType: headerObj.dataType
		});
	} else {
		cellData = new Cell({
			key: headerObj.key,
			value: config.dataSource[rowNumber][headerObj.key],
			dataType: headerObj.dataType,
			rowNumber: rowNumber,
			columnNumber: columnNumber
		});
	}

	return cellData;
}

function mergeEditedValuesInRow(config, row) {
	var mergedRowData = {},
		uniqueRowKey = row[config.uniqueRowKey];

	if (typeof config.inner.editedValues[uniqueRowKey] == 'undefined') {
		return row;
	}

	Object.keys(row).forEach(function(key) {
		mergedRowData[key] = config.inner.editedValues[uniqueRowKey][key] || row[key];
	});

	return mergedRowData;
}

function mergeEditedValuesInDataSource(config, ds) {
	var mergedDs = [];

	ds.forEach(function(row) {
		mergedDs.push(mergeEditedValuesInRow(config, row));
	});

	return mergedDs;
}

function separateValuesInDataSource(config, mergedDs) {
	var separatedDs = [];

	mergedDs.forEach(function(mergedRow) {
		var originalRow = config.inner.originalDataSource.find(function(row) {
			return row[config.uniqueRowKey] === mergedRow[config.uniqueRowKey];
		});

		if (typeof originalRow != 'undefined') {
			separatedDs.push(originalRow);
		}
	});

	return separatedDs;
}

function storeUpdatedCellValue(config, cellData) {
	var uniqueRowKey = config.dataSource[cellData.rowNumber][config.uniqueRowKey];

	if (typeof config.inner.editedValues[uniqueRowKey] == 'undefined') {
		config.inner.editedValues[uniqueRowKey] = {};
	}

	config.inner.editedValues[uniqueRowKey][cellData.key] = cellData.editedValue;
}

function persistRowValues(config, row) {
	var uniqueRowKey = row[config.uniqueRowKey];

	if (typeof config.inner.editedValues[uniqueRowKey] != 'undefined') {
		Object.keys(config.inner.editedValues[uniqueRowKey]).forEach(function(key) {
			row[key] = config.inner.editedValues[uniqueRowKey][key];
		});

		config.inner.editedValues[uniqueRowKey] = {};
	}
}

function persistBatchValues(config) {
	config.dataSource.forEach(function(row) {
		persistRowValues(config, row);
	});
}

module.exports = {
	getCellData: getCellData,
	getFixedCellData: getFixedCellData,
	mergeEditedValuesInRow: mergeEditedValuesInRow,
	mergeEditedValuesInDataSource: mergeEditedValuesInDataSource,
	separateValuesInDataSource: separateValuesInDataSource,
	storeUpdatedCellValue: storeUpdatedCellValue,
	persistRowValues: persistRowValues,
	persistBatchValues: persistBatchValues
};
},{"../models/table/cell":11,"../utils/configuration":24}],29:[function(require,module,exports){
!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Class=e()}(this,function(){"use strict";function t(){}var e="constructor",o="extend";return t[o]=function(t){function n(){i[e].apply(this,arguments)}var i=Object.create(this.prototype);return t.call(i,this.prototype),n.prototype=i,n[o]=this[o],n},t});
},{}]},{},[1]);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiIiwic291cmNlcyI6WyJ2aXJ0dWFsLWRhdGEtZ3JpZC5taW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG5yZXF1aXJlKCcuL3BvbGx5ZmlsbHMvQXJyYXkuZmluZC5qcycpO3JlcXVpcmUoJy4vcG9sbHlmaWxscy9FbGVtZW50Lm1hdGNoZXMuanMnKTtyZXF1aXJlKCcuL3BvbGx5ZmlsbHMvTm9kZUxpc3QuZm9yRWFjaC5qcycpO3JlcXVpcmUoJy4vcG9sbHlmaWxscy9PYmplY3QuYXNzaWduLmpzJyk7XG5cbnZhciBWaXJ0dWFsRGF0YUdyaWQgPSByZXF1aXJlKCcuL21vZGVscy9tb2R1bGUvdmlydHVhbC1kYXRhLWdyaWQnKTtcblxud2luZG93LlZpcnR1YWxEYXRhR3JpZCA9IFZpcnR1YWxEYXRhR3JpZDtcbn0se1wiLi9tb2RlbHMvbW9kdWxlL3ZpcnR1YWwtZGF0YS1ncmlkXCI6MTAsXCIuL3BvbGx5ZmlsbHMvQXJyYXkuZmluZC5qc1wiOjIwLFwiLi9wb2xseWZpbGxzL0VsZW1lbnQubWF0Y2hlcy5qc1wiOjIxLFwiLi9wb2xseWZpbGxzL05vZGVMaXN0LmZvckVhY2guanNcIjoyMixcIi4vcG9sbHlmaWxscy9PYmplY3QuYXNzaWduLmpzXCI6MjN9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIENsYXNzID0gcmVxdWlyZSgnY2xhc3MtMjU2LmpzJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gQ2xhc3MuZXh0ZW5kKGZ1bmN0aW9uKCkge1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0c2VsZi5jb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKGF0dHJpYnV0ZXMsIHBhcmFtcykge1xuXHRcdGlmICh0eXBlb2YgYXR0cmlidXRlcyA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGF0dHJpYnV0ZXMuZm9yRWFjaChmdW5jdGlvbihhdHRyKSB7XG5cdFx0XHRzZWxmW2F0dHJdID0gdHlwZW9mIHBhcmFtcyA9PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcGFyYW1zW2F0dHJdID09ICd1bmRlZmluZWQnID8gbnVsbCA6IHBhcmFtc1thdHRyXTtcblx0XHR9KTtcblx0fTtcblxuXHR0aGlzLnVwZGF0ZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihhdHRycykge1xuXHRcdE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmICh0eXBlb2YgYXR0cnNba10gIT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHNlbGZba10gIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0c2VsZltrXSA9IGF0dHJzW2tdO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xufSk7XG59LHtcImNsYXNzLTI1Ni5qc1wiOjI5fV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBCYXNlQ2xhc3MgPSByZXF1aXJlKCcuLi9iYXNlJyk7XG5cbnZhciBBVFRSSUJVVEVTID0gW1xuXHQnY2VsbEVsZW1lbnQnLFxuXHQnY2VsbERhdGEnXG5dO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDbGFzcy5leHRlbmQoZnVuY3Rpb24ocGFyZW50KSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRzZWxmLmNvbnN0cnVjdG9yID0gZnVuY3Rpb24ocGFyYW1zKSB7XG5cdFx0cGFyZW50LmNvbnN0cnVjdG9yLmNhbGwoc2VsZiwgQVRUUklCVVRFUywgcGFyYW1zKTtcblx0fTtcbn0pO1xufSx7XCIuLi9iYXNlXCI6Mn1dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgQmFzZUNsYXNzID0gcmVxdWlyZSgnLi4vYmFzZScpO1xuXG52YXIgQVRUUklCVVRFUyA9IFtcblx0J3NhdmVkUm93cydcbl07XG5cbm1vZHVsZS5leHBvcnRzID0gQmFzZUNsYXNzLmV4dGVuZChmdW5jdGlvbihwYXJlbnQpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdHNlbGYuY29uc3RydWN0b3IgPSBmdW5jdGlvbihwYXJhbXMpIHtcblx0XHRwYXJlbnQuY29uc3RydWN0b3IuY2FsbChzZWxmLCBBVFRSSUJVVEVTLCBwYXJhbXMpO1xuXHR9O1xufSk7XG59LHtcIi4uL2Jhc2VcIjoyfV0sNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBCYXNlQ2xhc3MgPSByZXF1aXJlKCcuLi9iYXNlJyk7XG5cbnZhciBBVFRSSUJVVEVTID0gW1xuXHQnY2VsbEVsZW1lbnQnLFxuXHQnY2VsbERhdGEnLFxuXHQnY2FuY2VsRXZlbnQnXG5dO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDbGFzcy5leHRlbmQoZnVuY3Rpb24ocGFyZW50KSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRzZWxmLmNvbnN0cnVjdG9yID0gZnVuY3Rpb24ocGFyYW1zKSB7XG5cdFx0cGFyZW50LmNvbnN0cnVjdG9yLmNhbGwoc2VsZiwgQVRUUklCVVRFUywgcGFyYW1zKTtcblx0fTtcbn0pO1xufSx7XCIuLi9iYXNlXCI6Mn1dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgQmFzZUNsYXNzID0gcmVxdWlyZSgnLi4vYmFzZScpO1xuXG52YXIgQVRUUklCVVRFUyA9IFtcblx0J2VkaXRlZFJvd3MnLFxuXHQnY2FuY2VsRXZlbnQnXG5dO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDbGFzcy5leHRlbmQoZnVuY3Rpb24ocGFyZW50KSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRzZWxmLmNvbnN0cnVjdG9yID0gZnVuY3Rpb24ocGFyYW1zKSB7XG5cdFx0cGFyZW50LmNvbnN0cnVjdG9yLmNhbGwoc2VsZiwgQVRUUklCVVRFUywgcGFyYW1zKTtcblx0fTtcbn0pO1xufSx7XCIuLi9iYXNlXCI6Mn1dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuYXJndW1lbnRzWzRdWzZdWzBdLmFwcGx5KGV4cG9ydHMsYXJndW1lbnRzKVxufSx7XCIuLi9iYXNlXCI6MixcImR1cFwiOjZ9XSw4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIEJhc2VDbGFzcyA9IHJlcXVpcmUoJy4uL2Jhc2UnKTtcblxudmFyIEFUVFJJQlVURVMgPSBbXG5cdCdlZGl0ZWRSb3cnLFxuXHQnY2FuY2VsRXZlbnQnXG5dO1xuXG5tb2R1bGUuZXhwb3J0cyA9IEJhc2VDbGFzcy5leHRlbmQoZnVuY3Rpb24ocGFyZW50KSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRzZWxmLmNvbnN0cnVjdG9yID0gZnVuY3Rpb24ocGFyYW1zKSB7XG5cdFx0cGFyZW50LmNvbnN0cnVjdG9yLmNhbGwoc2VsZiwgQVRUUklCVVRFUywgcGFyYW1zKTtcblx0fTtcbn0pO1xufSx7XCIuLi9iYXNlXCI6Mn1dLDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuYXJndW1lbnRzWzRdWzVdWzBdLmFwcGx5KGV4cG9ydHMsYXJndW1lbnRzKVxufSx7XCIuLi9iYXNlXCI6MixcImR1cFwiOjV9XSwxMDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBnZW5lcmF0b3IgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2dlbmVyYXRvcicpO1xuXG52YXIgdW5pcXVlSWRTZXF1ZW5jZSA9IDE7XG5cbmZ1bmN0aW9uIFZpcnR1YWxEYXRhR3JpZCgpIHtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdHNlbGYuY29uZmlndXJhdGlvbiA9IHt9O1xuXHRzZWxmLnVuaXF1ZUlkID0gdW5pcXVlSWRTZXF1ZW5jZSsrO1xuXHRzZWxmLkRFRkFVTFRfT1BUSU9OUyA9IGdlbmVyYXRvci5nZXREZWZhdWx0T3B0aW9ucygpO1xuXHRzZWxmLmdlbmVyYXRlVGFibGUgPSBmdW5jdGlvbihvcHRpb25zKSB7XG5cdFx0b3B0aW9ucy51bmlxdWVJZCA9IHNlbGYudW5pcXVlSWQ7XG5cblx0XHRnZW5lcmF0b3IuZ2VuZXJhdGVUYWJsZShzZWxmLmNvbmZpZ3VyYXRpb24sIG9wdGlvbnMpO1xuXHR9O1xuXHRzZWxmLmRlc3Ryb3lUYWJsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdGdlbmVyYXRvci5kZXN0cm95VGFibGUoc2VsZi5jb25maWd1cmF0aW9uKTtcblx0fTtcblx0c2VsZi5nZXRJZCA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBzZWxmLnVuaXF1ZUlkO1xuXHR9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFZpcnR1YWxEYXRhR3JpZDtcbn0se1wiLi4vLi4vbW9kdWxlcy9nZW5lcmF0b3JcIjoxN31dLDExOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gQ2VsbE9iamVjdChwKSB7XG5cdHZhciBzZWxmID0gdGhpcztcblxuXHRpbml0QXR0cigna2V5Jyk7XG5cdGluaXRBdHRyKCd2YWx1ZScpO1xuXHRpbml0QXR0cignZGF0YVR5cGUnKTtcblx0aW5pdEF0dHIoJ2VkaXRlZFZhbHVlJyk7XG5cdGluaXRBdHRyKCdjbGFzcycpO1xuXHRpbml0QXR0cigncm93TnVtYmVyJyk7XG5cdGluaXRBdHRyKCdjb2x1bW5OdW1iZXInKTtcblxuXHRmdW5jdGlvbiBpbml0QXR0cihuYW1lKSB7XG5cdFx0c2VsZltuYW1lXSA9IHR5cGVvZiBwID09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBwW25hbWVdID09ICd1bmRlZmluZWQnID8gbnVsbCA6IHBbbmFtZV07XG5cdH1cblxuXHR0aGlzLnVwZGF0ZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbihhdHRycykge1xuXHRcdE9iamVjdC5rZXlzKGF0dHJzKS5mb3JFYWNoKGZ1bmN0aW9uKGspIHtcblx0XHRcdGlmICh0eXBlb2YgYXR0cnNba10gIT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHNlbGZba10gIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0c2VsZltrXSA9IGF0dHJzW2tdO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9O1xuXG5cdHRoaXMuZ2V0VmFsdWUgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gc2VsZi5jZWxsQ2hhbmdlZCA/IHNlbGYuZWRpdGVkVmFsdWUgOiBzZWxmLnZhbHVlO1xuXHR9O1xuXG5cdHRoaXMudXBkYXRlVmFsdWUgPSBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdGlmIChzZWxmLmRhdGFUeXBlID09PSAnbnVtYmVyJykge1xuXHRcdFx0dmFsdWUgPSBpc05hTihwYXJzZUZsb2F0KHZhbHVlKSkgPyAwIDogcGFyc2VGbG9hdCh2YWx1ZSk7XG5cdFx0fVxuXG5cdFx0aWYgKHNlbGYudmFsdWUgPT09IHZhbHVlIHx8IHNlbGYudmFsdWUgPT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRzZWxmLmVkaXRlZFZhbHVlID0gbnVsbDtcblx0XHRcdHNlbGYuY2VsbENoYW5nZWQgPSBmYWxzZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0c2VsZi5lZGl0ZWRWYWx1ZSA9IHZhbHVlO1xuXHRcdFx0c2VsZi5jZWxsQ2hhbmdlZCA9IHRydWU7XG5cdFx0fVxuXHR9O1xuXG5cdHRoaXMuZGlzY2FyZENoYW5nZWRWYWx1ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHNlbGYuZWRpdGVkVmFsdWUgPSBudWxsO1xuXHR9O1xuXG5cdHRoaXMuaXNDZWxsQ2hhbmdlZCA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiBzZWxmLmNlbGxDaGFuZ2VkO1xuXHR9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IENlbGxPYmplY3Q7XG59LHt9XSwxMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBjb25maWdVdGlsID0gcmVxdWlyZSgnLi4vdXRpbHMvY29uZmlndXJhdGlvbicpLFxuXHRkYXRhVXRpbCAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZGF0YScpO1xuXG52YXIgREVGQVVMVFMgPSB7XG5cdHNlbGVjdG9yczoge1xuXHRcdG1haW5Db250YWluZXI6ICcuZGF0YS1jb250YWluZXInLFxuXHRcdGZpeGVkQ29udGFpbmVyOiAnZml4ZWQtY29udGFpbmVyJyxcblx0XHRmaXhlZFRhYmxlOiAnZml4ZWQtdGFibGUnLFxuXHRcdHZpcnR1YWxDb250YWluZXI6ICd2aXJ0dWFsLWNvbnRhaW5lcicsXG5cdFx0dmlydHVhbFRhYmxlOiAndmlydHVhbC10YWJsZScsXG5cdFx0ZWRpdGluZ0NlbGw6ICdlZGl0aW5nLWNlbGwnLFxuXHRcdGVkaXRlZENlbGw6ICdlZGl0ZWQtY2VsbCcsXG5cdFx0c2F2ZUJ1dHRvbjogbnVsbFxuXHR9LFxuXHRkaW1lbnNpb25zOiB7XG5cdFx0Y2VsbFdpZHRoOiAxNTAsXG5cdFx0Y2VsbEhlaWdodDogNTAsXG5cdFx0Y2VsbFBhZGRpbmdWZXJ0aWNhbDogNCxcblx0XHRjZWxsUGFkZGluZ0hvcml6b250YWw6IDgsXG5cdFx0Y2VsbEJvcmRlcldpZHRoOiAxLFxuXHRcdGNvbnRhaW5lckhlaWdodDogY29uZmlnVXRpbC5nZXREZWZhdWx0Q29udGFpbmVySGVpZ2h0XG5cdH0sXG5cdGVkaXQ6IHtcblx0XHRlbmFibGVkOiBmYWxzZSxcblx0XHRtb2RlOiAnYmF0Y2gnXG5cdH0sXG5cdGZpbHRlcjoge1xuXHRcdGVuYWJsZWQ6IGZhbHNlLFxuXHRcdGN1c3RvbUZpbHRlcjogbnVsbFxuXHR9LFxuXHRzb3J0OiB7XG5cdFx0ZW5hYmxlZDogZmFsc2UsXG5cdFx0ZGVmYXVsdDogY29uZmlnVXRpbC5nZXRTb3J0RGVmYXVsdCxcblx0XHRjdXN0b21Tb3J0OiBudWxsXG5cdH0sXG5cdGV2ZW50SGFuZGxlcnM6IHtcblx0XHRvbkJlZm9yZUVkaXQ6IGNvbmZpZ1V0aWwubmlsLFxuXHRcdG9uVmFsaWRhdGlvbjogY29uZmlnVXRpbC5uaWwsXG5cdFx0b25BZnRlckVkaXQ6IGNvbmZpZ1V0aWwubmlsLFxuXHRcdG9uQmVmb3JlU2F2ZTogY29uZmlnVXRpbC5uaWwsXG5cdFx0b25TYXZlUm93OiBjb25maWdVdGlsLm5pbCxcblx0XHRvblNhdmVCYXRjaDogY29uZmlnVXRpbC5uaWwsXG5cdFx0b25BZnRlclNhdmU6IGNvbmZpZ1V0aWwubmlsXG5cdH0sXG5cdGxvY2FsZToge1xuXHRcdG5hbWU6ICdlbidcblx0fSxcblx0ZGF0YVNvdXJjZTogWyBdLFxuXHRoZWFkZXJzOiBbIFsgXSBdLFxuXHRmaXhlZEhlYWRlcnM6IFsgWyBdIF0sXG5cdHVuaXF1ZVJvd0tleTogJ19fdW5pcXVlUm93S2V5Jyxcblx0YXV0b1Jlc2l6ZTogdHJ1ZSxcblx0ZGVidWc6IGZhbHNlLFxuXHR1bmlxdWVJZDogMCxcblx0aW5uZXI6IHt9XG59O1xuXG52YXIgSEVBREVSX0RFRkFVTFRTID0ge1xuXHRkYXRhVHlwZTogJ3RleHQnLFxuXHRmaWx0ZXJUeXBlOiAnZXF1YWxzJyxcblx0ZmlsdGVyRGlzYWJsZWQ6IGZhbHNlLFxuXHRzb3J0RGlzYWJsZWQ6IGZhbHNlXG59O1xuXG52YXIgU1RBVElDX0lOTkVSX0FUVFJTID0ge1xuXHRzZWxlY3RvcnM6IHtcblx0XHR1bmlxdWVJZFByZWZpeDogJ3ZpcnR1YWwtZGF0YS1ncmlkLScsXG5cdFx0YnVmZmVyUm93VG9wOiAnYnVmZmVyLXJvdy10b3AnLFxuXHRcdGJ1ZmZlclJvd0JvdHRvbTogJ2J1ZmZlci1yb3ctYm90dG9tJyxcblx0XHRidWZmZXJDb2x1bW5MZWZ0OiAnYnVmZmVyLWNvbHVtbi1sZWZ0Jyxcblx0XHRidWZmZXJDb2x1bW5SaWdodDogJ2J1ZmZlci1jb2x1bW4tcmlnaHQnLFxuXHRcdGhlYWRlclJvdzogJ2hlYWRlci1yb3cnLFxuXHRcdGhlYWRlckNlbGw6ICdoZWFkZXItY2VsbCcsXG5cdFx0c29ydENlbGw6ICdzb3J0LWNlbGwnLFxuXHRcdHNvcnRJY29uOiAnc29ydC1pY29uJyxcblx0XHRzb3J0RGlzYWJsZWQ6ICdzb3J0LWRpc2FibGVkJyxcblx0XHRmaWx0ZXJSb3c6ICdmaWx0ZXItcm93Jyxcblx0XHRmaWx0ZXJDZWxsOiAnZmlsdGVyLWNlbGwnLFxuXHRcdGZpbHRlckRpc2FibGVkOiAnZmlsdGVyLWRpc2FibGVkJyxcblx0XHRmaWx0ZXJDb250YWluZXI6ICdmaWx0ZXItY29udGFpbmVyJyxcblx0XHRmaWx0ZXJTZWFyY2hJY29uOiAnZmlsdGVyLXNlYXJjaC1pY29uJyxcblx0XHRmaWx0ZXJDbGVhckljb246ICdmaWx0ZXItY2xlYXItaWNvbicsXG5cdFx0ZGF0YVJvdzogJ2RhdGEtcm93Jyxcblx0XHRkYXRhQ2VsbDogJ2RhdGEtY2VsbCdcblx0fSxcblx0ZGltZW5zaW9uczoge30sXG5cdGljb25zOiB7XG5cdFx0c29ydDoge1xuXHRcdFx0YXNjOiAnZmEgZmEtYXJyb3ctZG93bicsXG5cdFx0XHRkZXNjOiAnZmEgZmEtYXJyb3ctdXAnXG5cdFx0fSxcblx0XHRmaWx0ZXI6IHtcblx0XHRcdHNlYXJjaDogJ2ZhIGZhLXNlYXJjaCcsXG5cdFx0XHRjbGVhcjogJ2ZhIGZhLXRpbWVzJ1xuXHRcdH1cblx0fSxcblx0ZWRpdGVkVmFsdWVzOiB7fSxcblx0c29ydDogeyB9LFxuXHRmaWx0ZXJzOiB7IH0sXG5cdG1pbkJ1ZmZlcldpZHRoOiAyLFxuXHRtaW5CdWZmZXJIZWlnaHQ6IDE4LCAvLyBBesOpcnQgdmFuIHLDoSBzesO8a3PDqWcsIG1lcnQgaGEgbmluY3MgbWVnYWR2YSwgYWtrb3IgdWdyaWsgZWd5ZXR0IGEgc2Nyb2xsIGhhIGEgdsOpZ8OpcmUgdmFneSBheiBlbGVqw6lyZSDDqXJ0w7xuayBhIHTDoWJsw6F6YXRiYW5cblx0bGVmdENlbGxPZmZzZXQ6IDAsXG5cdHRvcENlbGxPZmZzZXQ6IDBcbn07XG5cbmZ1bmN0aW9uIGluaXQoY29uZmlnLCBvcHRpb25zLCBpbml0Q29udGFpbmVycykge1xuXHRpbml0Q29uZmlnT2JqZWN0KGNvbmZpZyk7XG5cblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnc2VsZWN0b3JzLm1haW5Db250YWluZXInKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnc2VsZWN0b3JzLmZpeGVkQ29udGFpbmVyJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NlbGVjdG9ycy5maXhlZFRhYmxlJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NlbGVjdG9ycy52aXJ0dWFsQ29udGFpbmVyJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NlbGVjdG9ycy52aXJ0dWFsVGFibGUnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnc2VsZWN0b3JzLmVkaXRpbmdDZWxsJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NlbGVjdG9ycy5lZGl0ZWRDZWxsJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NlbGVjdG9ycy5zYXZlQnV0dG9uJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2RpbWVuc2lvbnMuY2VsbFdpZHRoJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2RpbWVuc2lvbnMuY2VsbEhlaWdodCcpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdkaW1lbnNpb25zLmNlbGxQYWRkaW5nVmVydGljYWwnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZGltZW5zaW9ucy5jZWxsUGFkZGluZ0hvcml6b250YWwnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZGltZW5zaW9ucy5jZWxsQm9yZGVyV2lkdGgnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAndW5pcXVlSWQnKTtcblxuXHRjYWxjdWxhdGVVbmlxdWVJZFNlbGVjdG9yKGNvbmZpZyk7XG5cdGNhbGN1bGF0ZVZpcnR1YWxDb250YWluZXJIZWlnaHQoY29uZmlnLCBvcHRpb25zKTtcblxuXHRpbml0Q29udGFpbmVycyhjb25maWcpO1xuXG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2xvY2FsZS5uYW1lJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2RhdGFTb3VyY2UnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnaGVhZGVycycpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdmaXhlZEhlYWRlcnMnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAndW5pcXVlUm93S2V5Jyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2F1dG9SZXNpemUnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZWRpdC5lbmFibGVkJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2VkaXQubW9kZScpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdmaWx0ZXIuZW5hYmxlZCcpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdmaWx0ZXIuY3VzdG9tRmlsdGVyJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ3NvcnQuZW5hYmxlZCcpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdzb3J0LmRlZmF1bHQnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnc29ydC5jdXN0b21Tb3J0Jyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2RlYnVnJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2V2ZW50SGFuZGxlcnMub25CZWZvcmVFZGl0Jyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2V2ZW50SGFuZGxlcnMub25WYWxpZGF0aW9uJyk7XG5cdHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywgJ2V2ZW50SGFuZGxlcnMub25BZnRlckVkaXQnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZXZlbnRIYW5kbGVycy5vbkJlZm9yZVNhdmUnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZXZlbnRIYW5kbGVycy5vblNhdmVSb3cnKTtcblx0dXBkYXRlVmFsdWUoY29uZmlnLCBvcHRpb25zLCAnZXZlbnRIYW5kbGVycy5vblNhdmVCYXRjaCcpO1xuXHR1cGRhdGVWYWx1ZShjb25maWcsIG9wdGlvbnMsICdldmVudEhhbmRsZXJzLm9uQWZ0ZXJTYXZlJyk7XG5cblx0aW5pdEhlYWRlckRhdGEoY29uZmlnKTtcblx0aW5pdERhdGFTb3VyY2UoY29uZmlnLCBvcHRpb25zLnVuaXF1ZVJvd0tleSk7XG5cdGluaXRJbm5lckNhbGN1bGF0ZWRWYWx1ZXMoY29uZmlnKTtcbn1cblxuZnVuY3Rpb24gaW5pdENvbmZpZ09iamVjdChjb25maWcpIHtcblx0Y29uZmlnLnNlbGVjdG9ycyA9IHt9O1xuXHRjb25maWcuZXZlbnRIYW5kbGVycyA9IHt9O1xuXHRjb25maWcubG9jYWxlID0ge307XG5cdGNvbmZpZy5pbm5lciA9IGRhdGFVdGlsLmNsb25lT2JqZWN0KFNUQVRJQ19JTk5FUl9BVFRSUyk7XG59XG5cbmZ1bmN0aW9uIGNhbGN1bGF0ZVVuaXF1ZUlkU2VsZWN0b3IoY29uZmlnKSB7XG5cdGNvbmZpZy5pbm5lci5zZWxlY3RvcnMudW5pcXVlSWQgPSBjb25maWcuaW5uZXIuc2VsZWN0b3JzLnVuaXF1ZUlkUHJlZml4ICsgY29uZmlnLnVuaXF1ZUlkO1xufVxuXG5mdW5jdGlvbiBjYWxjdWxhdGVWaXJ0dWFsQ29udGFpbmVySGVpZ2h0KGNvbmZpZywgb3B0aW9ucykge1xuXHR2YXIgY29udGFpbmVySGVpZ2h0ID0gZ2V0SW5uZXJWYWx1ZShvcHRpb25zLCAnZGltZW5zaW9ucy5jb250YWluZXJIZWlnaHQnKTtcblxuXHRpZiAodHlwZW9mIGNvbnRhaW5lckhlaWdodCA9PSAndW5kZWZpbmVkJykge1xuXHRcdGNvbnRhaW5lckhlaWdodCA9IGNvbmZpZ1V0aWwuZ2V0RGVmYXVsdENvbnRhaW5lckhlaWdodChjb25maWcpO1xuXHR9XG5cblx0Y29uZmlnLmRpbWVuc2lvbnMuY29udGFpbmVySGVpZ2h0ID0gY29uZmlnVXRpbC5jYWxjdWxhdGVWaXJ0dWFsQ29udGFpbmVySGVpZ2h0KGNvbmZpZywgY29udGFpbmVySGVpZ2h0KTtcbn1cblxuZnVuY3Rpb24gaW5pdElubmVyQ2FsY3VsYXRlZFZhbHVlcyhjb25maWcpIHtcblx0Ly8gQW5uYWsgYSBoZWFkZXIgc29ybmFrIGF6IGluZGV4ZSwgYW1pIGEgY2VsbGEga3VsY3Nva2F0IGlzIG1lZ2hhdMOhcm96emEuIE1pdmVsIGV6IG1pbmRpZyBheiB1dG9sc8OzIGxlc3osIGV6w6lydCBUT0RPOiBLaXN6ZWRuaS/DoXRhbGFrw610YW5pXG5cdGNvbmZpZy5pbm5lci5pbmRleE9mQ2VsbEtleUhlYWRlciA9IGNvbmZpZ1V0aWwuZ2V0SW5kZXhPZkNlbGxLZXlIZWFkZXIoY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLmNvbHNwYW5PZmZzZXQgPSBjb25maWdVdGlsLmdldE1heENvbHNwYW4oY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLnZpc2libGVSb3dOdW1iZXIgPSBjb25maWdVdGlsLmdldFZpc2libGVSb3dOdW1iZXIoY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgPSBjb25maWdVdGlsLmdldFZpc2libGVDb2x1bW5OdW1iZXIoY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLnRhYmxlT2Zmc2V0V2lkdGggPSBjb25maWdVdGlsLmdldFRhYmxlT2Zmc2V0V2lkdGgoY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLnRhYmxlT2Zmc2V0SGVpZ2h0ID0gY29uZmlnVXRpbC5nZXRUYWJsZU9mZnNldEhlaWdodChjb25maWcpO1xuXHRjb25maWcuaW5uZXIub3JpZ2luYWxEYXRhU291cmNlID0gW10uY29uY2F0KGNvbmZpZy5kYXRhU291cmNlKTtcbn1cblxuZnVuY3Rpb24gaW5pdEhlYWRlckRhdGEoY29uZmlnKSB7XG5cdHZhciBwcm9jZXNzZWRIZWFkZXJzID0gW10sXG5cdFx0cHJvY2Vzc2VkRml4ZWRIZWFkZXJzID0gW107XG5cblx0Y29uZmlnLmhlYWRlcnMuZm9yRWFjaChmdW5jdGlvbihoZWFkZXJSb3cpIHtcblx0XHR2YXIgaFJvdyA9IFtdO1xuXG5cdFx0aGVhZGVyUm93LmZvckVhY2goZnVuY3Rpb24oaGVhZGVyQ2VsbCkge1xuXHRcdFx0aWYgKHR5cGVvZiBoZWFkZXJDZWxsLmRhdGFUeXBlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGhlYWRlckNlbGwuZGF0YVR5cGUgPSBIRUFERVJfREVGQVVMVFMuZGF0YVR5cGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgaGVhZGVyQ2VsbC5maWx0ZXJUeXBlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGhlYWRlckNlbGwuZmlsdGVyVHlwZSA9IEhFQURFUl9ERUZBVUxUUy5maWx0ZXJUeXBlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNlbGwuZmlsdGVyRGlzYWJsZWQgPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0aGVhZGVyQ2VsbC5maWx0ZXJEaXNhYmxlZCA9IEhFQURFUl9ERUZBVUxUUy5maWx0ZXJEaXNhYmxlZDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBoZWFkZXJDZWxsLnNvcnREaXNhYmxlZCA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRoZWFkZXJDZWxsLnNvcnREaXNhYmxlZCA9IEhFQURFUl9ERUZBVUxUUy5zb3J0RGlzYWJsZWQ7XG5cdFx0XHR9XG5cblx0XHRcdGhSb3cucHVzaChoZWFkZXJDZWxsKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBoZWFkZXJDZWxsLmNvbHNwYW4gIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0Zm9yICh2YXIgaSA9IDE7IGkgPCBoZWFkZXJDZWxsLmNvbHNwYW47IGkrKykge1xuXHRcdFx0XHRcdGhSb3cucHVzaCh7fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdHByb2Nlc3NlZEhlYWRlcnMucHVzaChoUm93KTtcblx0fSk7XG5cblx0Y29uZmlnLmZpeGVkSGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKGhlYWRlclJvdykge1xuXHRcdHZhciBoUm93ID0gW107XG5cblx0XHRoZWFkZXJSb3cuZm9yRWFjaChmdW5jdGlvbihoZWFkZXJDZWxsKSB7XG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNlbGwuZGF0YVR5cGUgPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0aGVhZGVyQ2VsbC5kYXRhVHlwZSA9IEhFQURFUl9ERUZBVUxUUy5kYXRhVHlwZTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHR5cGVvZiBoZWFkZXJDZWxsLmZpbHRlclR5cGUgPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0aGVhZGVyQ2VsbC5maWx0ZXJUeXBlID0gSEVBREVSX0RFRkFVTFRTLmZpbHRlclR5cGU7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0eXBlb2YgaGVhZGVyQ2VsbC5maWx0ZXJEaXNhYmxlZCA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRoZWFkZXJDZWxsLmZpbHRlckRpc2FibGVkID0gSEVBREVSX0RFRkFVTFRTLmZpbHRlckRpc2FibGVkO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNlbGwuc29ydERpc2FibGVkID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdGhlYWRlckNlbGwuc29ydERpc2FibGVkID0gSEVBREVSX0RFRkFVTFRTLnNvcnREaXNhYmxlZDtcblx0XHRcdH1cblxuXHRcdFx0aFJvdy5wdXNoKGhlYWRlckNlbGwpO1xuXG5cdFx0XHRpZiAodHlwZW9mIGhlYWRlckNlbGwuY29sc3BhbiAhPSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMTsgaSA8IGhlYWRlckNlbGwuY29sc3BhbjsgaSsrKSB7XG5cdFx0XHRcdFx0aFJvdy5wdXNoKHt9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0cHJvY2Vzc2VkRml4ZWRIZWFkZXJzLnB1c2goaFJvdyk7XG5cdH0pO1xuXG5cdGNvbmZpZy5oZWFkZXJzID0gcHJvY2Vzc2VkSGVhZGVycztcblx0Y29uZmlnLmZpeGVkSGVhZGVycyA9IHByb2Nlc3NlZEZpeGVkSGVhZGVycztcbn1cblxuZnVuY3Rpb24gaW5pdERhdGFTb3VyY2UoY29uZmlnLCB1bmlxdWVSb3dLZXkpIHtcblx0aWYgKHR5cGVvZiB1bmlxdWVSb3dLZXkgPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGNvbmZpZy5kYXRhU291cmNlLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRjb25maWcuZGF0YVNvdXJjZVtpXVtjb25maWcudW5pcXVlUm93S2V5XSA9IGk7XG5cdFx0fVxuXHR9XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVZhbHVlKGNvbmZpZywgb3B0aW9ucywga2V5KSB7XG5cdHZhciB0YXJnZXQgPSBnZXRJbm5lck9iamVjdChjb25maWcsIGtleSksIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tdW51c2VkLXZhcnNcblx0XHR2YWx1ZSA9IGdldElubmVyVmFsdWUob3B0aW9ucywga2V5KSxcblx0XHRrZXlzID0ga2V5LnNwbGl0KCcuJyksXG5cdFx0bGFzdEtleSA9IGtleXNba2V5cy5sZW5ndGggLSAxXTtcblxuXHRpZiAodHlwZW9mIHZhbHVlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0dGFyZ2V0W2xhc3RLZXldID0gdHlwZW9mIGdldElubmVyVmFsdWUoREVGQVVMVFMsIGtleSkgPT0gJ2Z1bmN0aW9uJyA/IGdldElubmVyVmFsdWUoREVGQVVMVFMsIGtleSkoY29uZmlnKSA6IGdldElubmVyVmFsdWUoREVGQVVMVFMsIGtleSk7XG5cdH0gZWxzZSB7XG5cdFx0dGFyZ2V0W2xhc3RLZXldID0gdmFsdWU7XG5cdH1cbn1cblxuZnVuY3Rpb24gZ2V0SW5uZXJPYmplY3Qob2JqZWN0LCBrZXkpIHtcblx0aWYgKGtleS5pbmRleE9mKCcuJykgPT09IC0xKSB7XG5cdFx0cmV0dXJuIG9iamVjdDtcblx0fVxuXG5cdHZhciBzdWJLZXkgPSBrZXkuc3BsaXQoJy4nKVswXSxcblx0XHRzdWJPYmplY3QgPSBvYmplY3Rbc3ViS2V5XTtcblxuXHRpZiAodHlwZW9mIHN1Yk9iamVjdCA9PSAndW5kZWZpbmVkJykge1xuXHRcdG9iamVjdFtzdWJLZXldID0ge307XG5cdFx0c3ViT2JqZWN0ID0gb2JqZWN0W3N1YktleV07XG5cdH1cblxuXHRyZXR1cm4gZ2V0SW5uZXJPYmplY3Qoc3ViT2JqZWN0LCBrZXkuc3Vic3RyaW5nKGtleS5pbmRleE9mKCcuJykgKyAxKSk7XG59XG5cbmZ1bmN0aW9uIGdldElubmVyVmFsdWUob2JqZWN0LCBrZXkpIHtcblx0aWYgKGtleS5pbmRleE9mKCcuJykgPT09IC0xKSB7XG5cdFx0cmV0dXJuIG9iamVjdFtrZXldO1xuXHR9XG5cblx0dmFyIHN1YktleSA9IGtleS5zcGxpdCgnLicpWzBdLFxuXHRcdHN1Yk9iamVjdCA9IG9iamVjdFtzdWJLZXldO1xuXG5cdGlmICh0eXBlb2Ygc3ViT2JqZWN0ID09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0dXJuIHN1Yk9iamVjdDtcblx0fVxuXG5cdHJldHVybiBnZXRJbm5lclZhbHVlKHN1Yk9iamVjdCwga2V5LnN1YnN0cmluZyhrZXkuaW5kZXhPZignLicpICsgMSkpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0aW5pdDogaW5pdCxcblx0REVGQVVMVFM6IERFRkFVTFRTXG59O1xufSx7XCIuLi91dGlscy9jb25maWd1cmF0aW9uXCI6MjQsXCIuLi91dGlscy9kYXRhXCI6MjV9XSwxMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciB0YWJsZVV0aWwgID0gcmVxdWlyZSgnLi4vdXRpbHMvdGFibGUnKSxcblx0Y29uZmlnVXRpbCA9IHJlcXVpcmUoJy4uL3V0aWxzL2NvbmZpZ3VyYXRpb24nKSxcblx0ZG9tVXRpbCAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2RvbScpO1xuXG5mdW5jdGlvbiB1cGRhdGVDZWxsKGNvbmZpZywgY2VsbEVsZW1lbnQsIGNlbGxEYXRhKSB7XG5cdGNlbGxFbGVtZW50LmlubmVySFRNTCA9IGNlbGxEYXRhLmdldFZhbHVlKCk7XG5cdGNlbGxFbGVtZW50LmNsYXNzTmFtZSA9IGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZGF0YUNlbGwgKyAnICcgKyAoY2VsbERhdGEuY2xhc3MgfHwgJycpO1xufVxuXG5mdW5jdGlvbiB1cGRhdGVUYWJsZShjb25maWcsIGZvcmNlVXBkYXRlKSB7XG5cdHZhciBjb2xzcGFuID0gMTtcblxuXHRpZiAoY29uZmlnLmlubmVyLnByZXZpb3VzTGVmdENlbGxPZmZzZXQgPT09IGNvbmZpZy5pbm5lci5sZWZ0Q2VsbE9mZnNldCAmJlxuXHRcdGNvbmZpZy5pbm5lci5wcmV2aW91c1RvcENlbGxPZmZzZXQgPT09IGNvbmZpZy5pbm5lci50b3BDZWxsT2Zmc2V0ICYmXG5cdFx0Zm9yY2VVcGRhdGUgPT09IGZhbHNlKSB7XG5cblx0XHRyZXR1cm47XG5cdH1cblxuXHRjb25maWcuaW5uZXIucHJldmlvdXNMZWZ0Q2VsbE9mZnNldCA9IGNvbmZpZy5pbm5lci5sZWZ0Q2VsbE9mZnNldDtcblx0Y29uZmlnLmlubmVyLnByZXZpb3VzVG9wQ2VsbE9mZnNldCA9IGNvbmZpZy5pbm5lci50b3BDZWxsT2Zmc2V0O1xuXG5cdC8vIEhlYWRlciBjZWxsIHVwZGF0ZVxuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlICsgJyB0ci4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJSb3cpLmZvckVhY2goZnVuY3Rpb24ocm93LCByb3dDb3VudCkge1xuXHRcdHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZC4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJDZWxsKS5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwsIGNlbGxDb3VudCkge1xuXHRcdFx0dmFyIGNlbGxPYmogPSBjb25maWcuaGVhZGVyc1tyb3dDb3VudF1bY29uZmlnLmlubmVyLmxlZnRDZWxsT2Zmc2V0ICsgY2VsbENvdW50XSxcblx0XHRcdFx0aXNMYXN0Um93ID0gY29uZmlnLmlubmVyLmluZGV4T2ZDZWxsS2V5SGVhZGVyID09PSByb3dDb3VudDtcblxuXHRcdFx0aWYgKGNvbHNwYW4gPiAxKSB7XG5cdFx0XHRcdGNlbGwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcblx0XHRcdFx0Y29sc3Bhbi0tO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y2VsbC5pbm5lckhUTUwgPSBkb21VdGlsLmdldEhlYWRlckNlbGxIdG1sKGNvbmZpZywgY2VsbCwgY2VsbE9iaiwgaXNMYXN0Um93KTtcblx0XHRcdFx0Y2VsbC5zdHlsZS5kaXNwbGF5ID0gJ3RhYmxlLWNlbGwnO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodHlwZW9mIGNlbGxPYmouY29sc3BhbiA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHRjZWxsLnJlbW92ZUF0dHJpYnV0ZSgnY29sc3BhbicpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFyIGNhbGN1bGF0ZWRDb2xzcGFuID0gY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgPD0gY2VsbENvdW50ICsgY2VsbE9iai5jb2xzcGFuID8gY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgLSBjZWxsQ291bnQgOiBjZWxsT2JqLmNvbHNwYW47XG5cblx0XHRcdFx0Y2VsbC5zZXRBdHRyaWJ1dGUoJ2NvbHNwYW4nLCBjYWxjdWxhdGVkQ29sc3Bhbik7XG5cdFx0XHRcdGNvbHNwYW4gPSBjYWxjdWxhdGVkQ29sc3Bhbjtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRjb2xzcGFuID0gMTtcblx0fSk7XG5cblx0Ly8gRml4ZWQgaGVhZGVyIGNlbGwgdXBkYXRlXG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29uZmlnLnNlbGVjdG9ycy5maXhlZFRhYmxlICsgJyB0ci4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJSb3cpLmZvckVhY2goZnVuY3Rpb24ocm93LCByb3dDb3VudCkge1xuXHRcdHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZC4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJDZWxsKS5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwsIGNlbGxDb3VudCkge1xuXHRcdFx0dmFyIGNlbGxPYmogPSBjb25maWcuZml4ZWRIZWFkZXJzW3Jvd0NvdW50XVtjZWxsQ291bnRdLFxuXHRcdFx0XHRpc0xhc3RSb3cgPSBjb25maWcuaW5uZXIuaW5kZXhPZkNlbGxLZXlIZWFkZXIgPT09IHJvd0NvdW50O1xuXG5cdFx0XHRjZWxsLmlubmVySFRNTCA9IGRvbVV0aWwuZ2V0SGVhZGVyQ2VsbEh0bWwoY29uZmlnLCBjZWxsLCBjZWxsT2JqLCBpc0xhc3RSb3cpO1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBGaWx0ZXIgcm93IHVwZGF0ZVxuXHRpZiAoY29uZmlnLmZpbHRlci5lbmFibGVkKSB7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxUYWJsZSArICcgdGQuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyQ2VsbCkuZm9yRWFjaChmdW5jdGlvbihjZWxsLCBjZWxsQ291bnQpIHtcblx0XHRcdHZhciBjZWxsT2JqID0gY29uZmlnVXRpbC5nZXRLZXlIZWFkZXIoY29uZmlnKVtjb25maWcuaW5uZXIubGVmdENlbGxPZmZzZXQgKyBjZWxsQ291bnRdLFxuXHRcdFx0XHRmaWx0ZXJPYmogPSBjb25maWcuaW5uZXIuZmlsdGVyc1tjZWxsT2JqLmtleV0gfHwge30sXG5cdFx0XHRcdGN1cnJlbnRGaWx0ZXJBdHRyID0gY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXR0cmlidXRlJyk7XG5cblx0XHRcdGlmIChjZWxsT2JqLmtleSA9PT0gY3VycmVudEZpbHRlckF0dHIpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1hdHRyaWJ1dGUnLCBjZWxsT2JqLmtleSk7XG5cdFx0XHRjZWxsLmNsYXNzTGlzdC50b2dnbGUoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJEaXNhYmxlZCwgY2VsbE9iai5maWx0ZXJEaXNhYmxlZCk7XG5cdFx0XHRjZWxsLmlubmVySFRNTCA9IGRvbVV0aWwuZ2V0RmlsdGVyQ2VsbEh0bWwoY29uZmlnLCBjZWxsLCBjZWxsT2JqLCBmaWx0ZXJPYmopO1xuXHRcdH0pO1xuXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuc2VsZWN0b3JzLmZpeGVkVGFibGUgKyAnIHRkLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckNlbGwpLmZvckVhY2goZnVuY3Rpb24oY2VsbCwgY2VsbENvdW50KSB7XG5cdFx0XHR2YXIgY2VsbE9iaiA9IGNvbmZpZy5maXhlZEhlYWRlcnNbY29uZmlnLmlubmVyLmluZGV4T2ZDZWxsS2V5SGVhZGVyXVtjZWxsQ291bnRdLFxuXHRcdFx0XHRmaWx0ZXJPYmogPSBjb25maWcuaW5uZXIuZmlsdGVyc1tjZWxsT2JqLmtleV0gfHwge30sXG5cdFx0XHRcdGN1cnJlbnRGaWx0ZXJBdHRyID0gY2VsbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXR0cmlidXRlJyk7XG5cblx0XHRcdGlmIChjZWxsT2JqLmtleSA9PT0gY3VycmVudEZpbHRlckF0dHIpIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRjZWxsLnNldEF0dHJpYnV0ZSgnZGF0YS1hdHRyaWJ1dGUnLCBjZWxsT2JqLmtleSk7XG5cdFx0XHRjZWxsLmNsYXNzTGlzdC50b2dnbGUoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJEaXNhYmxlZCwgY2VsbE9iai5maWx0ZXJEaXNhYmxlZCk7XG5cdFx0XHRjZWxsLmlubmVySFRNTCA9IGRvbVV0aWwuZ2V0RmlsdGVyQ2VsbEh0bWwoY29uZmlnLCBjZWxsLCBjZWxsT2JqLCBmaWx0ZXJPYmopO1xuXHRcdH0pO1xuXHR9XG5cblx0Ly8gQ2VsbCBkYXRhIHJvdyB1cGRhdGVcblx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxUYWJsZSArICcgdHIuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZGF0YVJvdykuZm9yRWFjaChmdW5jdGlvbihyb3csIHJvd051bWJlcikge1xuXHRcdHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZC4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5kYXRhQ2VsbCkuZm9yRWFjaChmdW5jdGlvbihjZWxsLCBjZWxsTnVtYmVyKSB7XG5cdFx0XHR2YXIgY2VsbERhdGEgPSB0YWJsZVV0aWwuZ2V0Q2VsbERhdGEoY29uZmlnLCBjb25maWcuaW5uZXIudG9wQ2VsbE9mZnNldCArIHJvd051bWJlciwgY29uZmlnLmlubmVyLmxlZnRDZWxsT2Zmc2V0ICsgY2VsbE51bWJlcik7XG5cblx0XHRcdHVwZGF0ZUNlbGwoY29uZmlnLCBjZWxsLCBjZWxsRGF0YSk7XG5cdFx0fSk7XG5cdH0pO1xuXG5cdC8vIEZpeGVkIGNlbGwgZGF0YSByb3cgdXBkYXRlXG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29uZmlnLnNlbGVjdG9ycy5maXhlZFRhYmxlICsgJyB0ci4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5kYXRhUm93KS5mb3JFYWNoKGZ1bmN0aW9uKHJvdywgcm93TnVtYmVyKSB7XG5cdFx0cm93LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RkLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmRhdGFDZWxsKS5mb3JFYWNoKGZ1bmN0aW9uKGNlbGwsIGNlbGxOdW1iZXIpIHtcblx0XHRcdHZhciBmaXhlZENlbGxEYXRhID0gdGFibGVVdGlsLmdldEZpeGVkQ2VsbERhdGEoY29uZmlnLCBjb25maWcuaW5uZXIudG9wQ2VsbE9mZnNldCArIHJvd051bWJlciwgY2VsbE51bWJlcik7XG5cblx0XHRcdHVwZGF0ZUNlbGwoY29uZmlnLCBjZWxsLCBmaXhlZENlbGxEYXRhKTtcblx0XHR9KTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlcnMoY29uZmlnKSB7XG5cdHZhciB2aXJ0dWFsQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxDb250YWluZXIpLFxuXHRcdGNlbGxGdWxsV2lkdGggPSBjb25maWdVdGlsLmdldENlbGxGdWxsV2lkdGgoY29uZmlnKSxcblx0XHRsZWZ0ID0gdmlydHVhbENvbnRhaW5lci5zY3JvbGxMZWZ0IC0gdmlydHVhbENvbnRhaW5lci5zY3JvbGxMZWZ0ICUgY2VsbEZ1bGxXaWR0aCAtIGNvbmZpZy5pbm5lci5jb2xzcGFuT2Zmc2V0ICogY2VsbEZ1bGxXaWR0aCxcblx0XHRyaWdodCA9IGNvbmZpZy5pbm5lci50YWJsZU9mZnNldFdpZHRoIC0gbGVmdCxcblx0XHR0b3AgPSB2aXJ0dWFsQ29udGFpbmVyLnNjcm9sbFRvcCxcblx0XHRib3R0b20gPSBjb25maWcuaW5uZXIudGFibGVPZmZzZXRIZWlnaHQgLSB0b3A7XG5cblx0bGVmdCA9IGxlZnQgPiBjb25maWcuaW5uZXIudGFibGVPZmZzZXRXaWR0aCA/IGNvbmZpZy5pbm5lci50YWJsZU9mZnNldFdpZHRoIDogbGVmdDtcblx0bGVmdCA9IGxlZnQgPCBjb25maWcuaW5uZXIubWluQnVmZmVyV2lkdGggPyBjb25maWcuaW5uZXIubWluQnVmZmVyV2lkdGggOiBsZWZ0O1xuXHRyaWdodCA9IGNvbmZpZy5pbm5lci50YWJsZU9mZnNldFdpZHRoIC0gbGVmdDtcblx0dG9wID0gdG9wICsgY29uZmlnLmlubmVyLm1pbkJ1ZmZlckhlaWdodCA+IGNvbmZpZy5pbm5lci50YWJsZU9mZnNldEhlaWdodCA/IGNvbmZpZy5pbm5lci50YWJsZU9mZnNldEhlaWdodCAtIGNvbmZpZy5pbm5lci5taW5CdWZmZXJIZWlnaHQgOiB0b3AgKyBjb25maWcuaW5uZXIubWluQnVmZmVySGVpZ2h0O1xuXHRib3R0b20gPSBjb25maWcuaW5uZXIudGFibGVPZmZzZXRIZWlnaHQgPiB0b3AgPyBjb25maWcuaW5uZXIudGFibGVPZmZzZXRIZWlnaHQgLSB0b3AgOiBjb25maWcuaW5uZXIubWluQnVmZmVySGVpZ2h0O1xuXG5cdGNvbmZpZy5pbm5lci5sZWZ0Q2VsbE9mZnNldCA9IE1hdGguZmxvb3IobGVmdCAvIGNlbGxGdWxsV2lkdGgpO1xuXHRjb25maWcuaW5uZXIudG9wQ2VsbE9mZnNldCA9IE1hdGguZmxvb3IoKHRvcCAtIHRvcCAlIGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQpIC8gY29uZmlnLmRpbWVuc2lvbnMuY2VsbEhlaWdodCk7XG5cblx0Y29uZmlnLmlubmVyLmJ1ZmZlckxlZnQuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdGVsLnN0eWxlLm1pbldpZHRoID0gbGVmdCArICdweCc7XG5cdH0pO1xuXHRjb25maWcuaW5uZXIuYnVmZmVyUmlnaHQuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdGVsLnN0eWxlLm1pbldpZHRoID0gcmlnaHQgKyAncHgnO1xuXHR9KTtcblx0Y29uZmlnLmlubmVyLmJ1ZmZlclRvcC5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7XG5cdFx0ZWwuc3R5bGUuaGVpZ2h0ID0gdG9wICsgJ3B4Jztcblx0fSk7XG5cdGNvbmZpZy5pbm5lci5idWZmZXJCb3R0b20uZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdGVsLnN0eWxlLmhlaWdodCA9IGJvdHRvbSArICdweCc7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiByZWNhbGN1bGF0ZURpbWVuc2lvbnMoY29uZmlnKSB7XG5cdHZhciBzbWFsbGVyVGFibGUgPSBjb25maWcuZGF0YVNvdXJjZS5sZW5ndGggPCBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlcixcblx0XHR2aXJ0dWFsQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxDb250YWluZXIpO1xuXG5cdHZpcnR1YWxDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnbm8tdmVydGljYWwtc2Nyb2xsJywgc21hbGxlclRhYmxlKTtcblxuXHRpZiAoc21hbGxlclRhYmxlKSB7XG5cdFx0dmlydHVhbENvbnRhaW5lci5zY3JvbGxUb3AgPSAwO1xuXHR9XG5cblx0Y29uZmlnLmlubmVyLnRhYmxlT2Zmc2V0V2lkdGggPSBjb25maWdVdGlsLmdldFRhYmxlT2Zmc2V0V2lkdGgoY29uZmlnKTtcblx0Y29uZmlnLmlubmVyLnRhYmxlT2Zmc2V0SGVpZ2h0ID0gY29uZmlnVXRpbC5nZXRUYWJsZU9mZnNldEhlaWdodChjb25maWcpO1xufVxuXG5mdW5jdGlvbiByZXNldEVkaXRpbmdDZWxsKGNvbmZpZywgZXZlbnRIYW5kbGVycykge1xuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlICsgJyB0ZC4nICsgY29uZmlnLnNlbGVjdG9ycy5lZGl0aW5nQ2VsbCkuZm9yRWFjaChmdW5jdGlvbihlZGl0aW5nQ2VsbCkge1xuXHRcdHZhciBpbnB1dCA9IGVkaXRpbmdDZWxsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG5cblx0XHRpbnB1dC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgZXZlbnRIYW5kbGVycy5vbklucHV0Qmx1ckV2ZW50SGFuZGxlcik7XG5cdFx0aW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBldmVudEhhbmRsZXJzLm9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlcik7XG5cblx0XHRlZGl0aW5nQ2VsbC5pbm5lckhUTUwgPSBpbnB1dC52YWx1ZTtcblx0XHRlZGl0aW5nQ2VsbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5zZWxlY3RvcnMuZWRpdGluZ0NlbGwpO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gcmVzZXRFZGl0ZWRDZWxscyhjb25maWcpIHtcblx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxUYWJsZSArICcgdGQuJyArIGNvbmZpZy5zZWxlY3RvcnMuZWRpdGluZ0NlbGwpLmZvckVhY2goZnVuY3Rpb24oZWRpdGVkQ2VsbCkge1xuXHRcdGVkaXRlZENlbGwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuc2VsZWN0b3JzLmVkaXRlZENlbGwpO1xuXHR9KTtcblxuXHR1cGRhdGVUYWJsZShjb25maWcpO1xufVxuXG5mdW5jdGlvbiBkZXN0cm95VGFibGUoY29uZmlnKSB7XG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnNlbGVjdG9ycy5tYWluQ29udGFpbmVyKS5pbm5lckhUTUwgPSAnJztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdHVwZGF0ZUNlbGw6IHVwZGF0ZUNlbGwsXG5cdHVwZGF0ZVRhYmxlOiB1cGRhdGVUYWJsZSxcblx0dXBkYXRlQnVmZmVyczogdXBkYXRlQnVmZmVycyxcblx0cmVjYWxjdWxhdGVEaW1lbnNpb25zOiByZWNhbGN1bGF0ZURpbWVuc2lvbnMsXG5cdHJlc2V0RWRpdGluZ0NlbGw6IHJlc2V0RWRpdGluZ0NlbGwsXG5cdHJlc2V0RWRpdGVkQ2VsbHM6IHJlc2V0RWRpdGVkQ2VsbHMsXG5cdGRlc3Ryb3lUYWJsZTogZGVzdHJveVRhYmxlXG59O1xufSx7XCIuLi91dGlscy9jb25maWd1cmF0aW9uXCI6MjQsXCIuLi91dGlscy9kb21cIjoyNixcIi4uL3V0aWxzL3RhYmxlXCI6Mjh9XSwxNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBCZWZvcmVFZGl0QXJncyA9IHJlcXVpcmUoJy4uL21vZGVscy9ldmVudC1hcmd1bWVudHMvYmVmb3JlLWVkaXQnKSxcblx0QmVmb3JlU2F2ZUFyZ3MgPSByZXF1aXJlKCcuLi9tb2RlbHMvZXZlbnQtYXJndW1lbnRzL2JlZm9yZS1zYXZlJyksXG5cdFZhbGlkYXRpb25BcmdzID0gcmVxdWlyZSgnLi4vbW9kZWxzL2V2ZW50LWFyZ3VtZW50cy92YWxpZGF0aW9uJyksXG5cdFNhdmVSb3dBcmdzICAgID0gcmVxdWlyZSgnLi4vbW9kZWxzL2V2ZW50LWFyZ3VtZW50cy9zYXZlLXJvdycpLFxuXHRTYXZlQmF0Y2hBcmdzICA9IHJlcXVpcmUoJy4uL21vZGVscy9ldmVudC1hcmd1bWVudHMvc2F2ZS1iYXRjaCcpLFxuXHRBZnRlckVkaXRBcmdzICA9IHJlcXVpcmUoJy4uL21vZGVscy9ldmVudC1hcmd1bWVudHMvYWZ0ZXItZWRpdCcpLFxuXHRBZnRlclNhdmVBcmdzICA9IHJlcXVpcmUoJy4uL21vZGVscy9ldmVudC1hcmd1bWVudHMvYWZ0ZXItc2F2ZScpLFxuXHR0YWJsZVV0aWwgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL3RhYmxlJyksXG5cdGRvbVV0aWwgICAgICAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZG9tJyksXG5cdGRvbU1vZHVsZSAgICAgID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9kb20nKSxcblx0ZmlsdGVyTW9kdWxlICAgPSByZXF1aXJlKCcuLi9tb2R1bGVzL2ZpbHRlcicpO1xuXG5mdW5jdGlvbiBzdGFydEVkaXRpbmdDZWxsKGNvbmZpZywgY2VsbEVsZW1lbnQsIGluc3RhbmNlcywgZXZlbnRIYW5kbGVycykge1xuXHRpZiAoIWNvbmZpZy5lZGl0LmVuYWJsZWQpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHR2YXIgcm93TnVtYmVyID0gZG9tVXRpbC5nZXRSb3dOdW1iZXIoY29uZmlnLCBjZWxsRWxlbWVudCksXG5cdFx0Y29sdW1uTnVtYmVyID0gZG9tVXRpbC5nZXRDb2x1bW5OdW1iZXIoY29uZmlnLCBjZWxsRWxlbWVudCk7XG5cblx0aWYgKHJvd051bWJlciA+PSBjb25maWcuZGF0YVNvdXJjZS5sZW5ndGgpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHR2YXIgY2VsbERhdGEgPSB0YWJsZVV0aWwuZ2V0Q2VsbERhdGEoY29uZmlnLCByb3dOdW1iZXIsIGNvbHVtbk51bWJlciksXG5cdFx0aW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcblxuXHRpbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKCd0eXBlJywgY2VsbERhdGEuZGF0YVR5cGUpO1xuXG5cdHZhciBiZWZvcmVFZGl0QXJncyA9IG5ldyBCZWZvcmVFZGl0QXJncyh7XG5cdFx0Y2VsbEVsZW1lbnQ6IGNlbGxFbGVtZW50LFxuXHRcdGNlbGxEYXRhOiBjZWxsRGF0YSxcblx0XHRjYW5jZWxFdmVudDogZmFsc2Vcblx0fSk7XG5cblx0Y29uZmlnLmV2ZW50SGFuZGxlcnMub25CZWZvcmVFZGl0KGJlZm9yZUVkaXRBcmdzKTtcblxuXHRpZiAoIWJlZm9yZUVkaXRBcmdzLmNhbmNlbEV2ZW50KSB7XG5cdFx0Y2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuc2VsZWN0b3JzLmVkaXRpbmdDZWxsKTtcblx0XHRjZWxsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5zZWxlY3RvcnMuZWRpdGVkQ2VsbCk7XG5cdFx0Y2VsbEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG5cdFx0Y2VsbEVsZW1lbnQuYXBwZW5kQ2hpbGQoaW5wdXRFbGVtZW50KTtcblxuXHRcdGluc3RhbmNlcy5vbklucHV0Qmx1ckV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uKGV2KSB7IGV2ZW50SGFuZGxlcnMub25JbnB1dEJsdXJFdmVudEhhbmRsZXIoZXYsIGNvbmZpZyk7IH07XG5cdFx0aW5zdGFuY2VzLm9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uKGV2KSB7IGV2ZW50SGFuZGxlcnMub25JbnB1dEtleVVwRXZlbnRIYW5kbGVyKGV2LCBjb25maWcpOyB9O1xuXG5cdFx0aW5wdXRFbGVtZW50LmZvY3VzKCk7XG5cdFx0aW5wdXRFbGVtZW50LnZhbHVlID0gY2VsbERhdGEuZ2V0VmFsdWUoKTtcblx0XHRpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGluc3RhbmNlcy5vbklucHV0Qmx1ckV2ZW50SGFuZGxlcik7XG5cdFx0aW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgaW5zdGFuY2VzLm9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlcik7XG5cdH1cbn1cblxuZnVuY3Rpb24gZmluaXNoRWRpdGluZ0NlbGwoY29uZmlnLCBpbnB1dEVsZW1lbnQsIGV2ZW50SGFuZGxlcnMpIHtcblx0dmFyIGNlbGxFbGVtZW50ID0gaW5wdXRFbGVtZW50LnBhcmVudE5vZGUsXG5cdFx0cm93TnVtYmVyID0gZG9tVXRpbC5nZXRSb3dOdW1iZXIoY29uZmlnLCBjZWxsRWxlbWVudCksXG5cdFx0Y29sdW1uTnVtYmVyID0gZG9tVXRpbC5nZXRDb2x1bW5OdW1iZXIoY29uZmlnLCBjZWxsRWxlbWVudCksXG5cdFx0Y2VsbERhdGEgPSB0YWJsZVV0aWwuZ2V0Q2VsbERhdGEoY29uZmlnLCByb3dOdW1iZXIsIGNvbHVtbk51bWJlciksXG5cdFx0dXBkYXRlZFZhbHVlID0gaW5wdXRFbGVtZW50LnZhbHVlO1xuXG5cdGNlbGxEYXRhLnVwZGF0ZUF0dHJpYnV0ZXMoeyBjbGFzczogY29uZmlnLnNlbGVjdG9ycy5lZGl0ZWRDZWxsIH0pO1xuXHRjZWxsRGF0YS51cGRhdGVWYWx1ZSh1cGRhdGVkVmFsdWUpO1xuXG5cdGlmICghY2VsbERhdGEuaXNDZWxsQ2hhbmdlZCgpKSB7XG5cdFx0ZG9tTW9kdWxlLnJlc2V0RWRpdGluZ0NlbGwoY29uZmlnLCBldmVudEhhbmRsZXJzKTtcblxuXHRcdHJldHVybjtcblx0fVxuXG5cdHZhciB2YWxpZGF0aW9uQXJncyA9IG5ldyBWYWxpZGF0aW9uQXJncyh7XG5cdFx0Y2VsbEVsZW1lbnQ6IGNlbGxFbGVtZW50LFxuXHRcdGNlbGxEYXRhOiBjZWxsRGF0YSxcblx0XHRjYW5jZWxFdmVudDogZmFsc2Vcblx0fSk7XG5cblx0Y29uZmlnLmV2ZW50SGFuZGxlcnMub25WYWxpZGF0aW9uKHZhbGlkYXRpb25BcmdzKTtcblxuXHRpZiAodmFsaWRhdGlvbkFyZ3MuY2FuY2VsRWRpdCAhPT0gdHJ1ZSkge1xuXHRcdHRhYmxlVXRpbC5zdG9yZVVwZGF0ZWRDZWxsVmFsdWUoY29uZmlnLCBjZWxsRGF0YSk7XG5cdFx0ZG9tTW9kdWxlLnVwZGF0ZUNlbGwoY29uZmlnLCBjZWxsRWxlbWVudCwgY2VsbERhdGEpO1xuXG5cdFx0dmFyIGFmdGVyRWRpdEFyZ3MgPSBuZXcgQWZ0ZXJFZGl0QXJncyh7XG5cdFx0XHRjZWxsRWxlbWVudDogY2VsbEVsZW1lbnQsXG5cdFx0XHRjZWxsRGF0YTogY2VsbERhdGFcblx0XHR9KTtcblxuXHRcdGNvbmZpZy5ldmVudEhhbmRsZXJzLm9uQWZ0ZXJFZGl0KGFmdGVyRWRpdEFyZ3MpO1xuXG5cdFx0ZmlsdGVyTW9kdWxlLmZpbHRlcihjb25maWcpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGNhbmNlbEVkaXRpbmdDZWxsKGNvbmZpZykge1xuXHRyZXR1cm4gJyc7XG59XG5cbmZ1bmN0aW9uIHNhdmVDZWxscyhjb25maWcpIHtcblx0aWYgKCFjb25maWcuZWRpdC5lbmFibGVkKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0dmFyIGJlZm9yZVNhdmVBcmdzID0gbmV3IEJlZm9yZVNhdmVBcmdzKHtcblx0XHRlZGl0ZWRSb3dzOiBjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzLFxuXHRcdGNhbmNlbEV2ZW50OiBmYWxzZVxuXHR9KTtcblxuXHRjb25maWcuZXZlbnRIYW5kbGVycy5vbkJlZm9yZVNhdmUoYmVmb3JlU2F2ZUFyZ3MpO1xuXG5cdGlmIChiZWZvcmVTYXZlQXJncy5jYW5jZWxFdmVudCkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmIChjb25maWcuZWRpdC5tb2RlID09PSAncm93JykgeyAvLyBSb3cgbW9kZVxuXHRcdHZhciBzYXZlUm93QXJncyA9IG5ldyBTYXZlUm93QXJncyh7IGNhbmNlbEV2ZW50OiBmYWxzZSB9KTtcblxuXHRcdGNvbmZpZy5kYXRhU291cmNlLmZvckVhY2goZnVuY3Rpb24ocm93KSB7XG5cdFx0XHRzYXZlUm93QXJncyA9IG5ldyBTYXZlUm93QXJncyh7XG5cdFx0XHRcdGVkaXRlZFJvdzogY29uZmlnLmlubmVyLmVkaXRlZFZhbHVlcyxcblx0XHRcdFx0Y2FuY2VsRXZlbnQ6IGZhbHNlXG5cdFx0XHR9KTtcblxuXHRcdFx0aWYgKCFzYXZlUm93QXJncy5jYW5jZWxFdmVudCkge1xuXHRcdFx0XHRjb25maWcuZXZlbnRIYW5kbGVycy5vblNhdmluZ1JvdyhzYXZlUm93QXJncyk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICghc2F2ZVJvd0FyZ3MuY2FuY2VsRXZlbnQpIHtcblx0XHRcdFx0dGFibGVVdGlsLnBlcnNpc3RSb3dWYWx1ZXMoY29uZmlnLCByb3cpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKCFzYXZlUm93QXJncy5jYW5jZWxFdmVudCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0fSBlbHNlIGlmIChjb25maWcuZWRpdC5tb2RlID09PSAnYmF0Y2gnKSB7IC8vIEJhdGNoIG1vZGVcblx0XHR2YXIgc2F2ZUJhdGNoQXJncyA9IG5ldyBTYXZlQmF0Y2hBcmdzKHtcblx0XHRcdGVkaXRlZFJvd3M6IGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXMsXG5cdFx0XHRjYW5jZWxFdmVudDogZmFsc2Vcblx0XHR9KTtcblxuXHRcdGNvbmZpZy5ldmVudEhhbmRsZXJzLm9uU2F2aW5nQmF0Y2goc2F2ZUJhdGNoQXJncyk7XG5cblx0XHRpZiAoc2F2ZUJhdGNoQXJncy5jYW5jZWxFdmVudCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdHRhYmxlVXRpbC5wZXJzaXN0QmF0Y2hWYWx1ZXMoY29uZmlnKTtcblx0fVxuXG5cdHZhciBhZnRlclNhdmVBcmdzID0gbmV3IEFmdGVyU2F2ZUFyZ3Moe1xuXHRcdHNhdmVkUm93czogY29uZmlnLmlubmVyLmVkaXRlZFZhbHVlc1xuXHR9KTtcblxuXHRkb21Nb2R1bGUucmVzZXRFZGl0ZWRDZWxscyhjb25maWcpO1xuXG5cdGNvbmZpZy5ldmVudEhhbmRsZXJzLm9uQWZ0ZXJTYXZlKGFmdGVyU2F2ZUFyZ3MpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0c3RhcnRFZGl0aW5nQ2VsbDogc3RhcnRFZGl0aW5nQ2VsbCxcblx0ZmluaXNoRWRpdGluZ0NlbGw6IGZpbmlzaEVkaXRpbmdDZWxsLFxuXHRjYW5jZWxFZGl0aW5nQ2VsbDogY2FuY2VsRWRpdGluZ0NlbGwsXG5cdHNhdmVDZWxsczogc2F2ZUNlbGxzXG59O1xufSx7XCIuLi9tb2RlbHMvZXZlbnQtYXJndW1lbnRzL2FmdGVyLWVkaXRcIjozLFwiLi4vbW9kZWxzL2V2ZW50LWFyZ3VtZW50cy9hZnRlci1zYXZlXCI6NCxcIi4uL21vZGVscy9ldmVudC1hcmd1bWVudHMvYmVmb3JlLWVkaXRcIjo1LFwiLi4vbW9kZWxzL2V2ZW50LWFyZ3VtZW50cy9iZWZvcmUtc2F2ZVwiOjYsXCIuLi9tb2RlbHMvZXZlbnQtYXJndW1lbnRzL3NhdmUtYmF0Y2hcIjo3LFwiLi4vbW9kZWxzL2V2ZW50LWFyZ3VtZW50cy9zYXZlLXJvd1wiOjgsXCIuLi9tb2RlbHMvZXZlbnQtYXJndW1lbnRzL3ZhbGlkYXRpb25cIjo5LFwiLi4vbW9kdWxlcy9kb21cIjoxMyxcIi4uL21vZHVsZXMvZmlsdGVyXCI6MTYsXCIuLi91dGlscy9kb21cIjoyNixcIi4uL3V0aWxzL3RhYmxlXCI6Mjh9XSwxNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBkb21VdGlsICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9kb20nKSxcblx0a2V5Ym9hcmRVdGlsID0gcmVxdWlyZSgnLi4vdXRpbHMva2V5Ym9hcmQnKSxcblx0c29ydE1vZHVsZSAgID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9zb3J0JyksXG5cdGVkaXRNb2R1bGUgICA9IHJlcXVpcmUoJy4uL21vZHVsZXMvZWRpdCcpLFxuXHRkb21Nb2R1bGUgICAgPSByZXF1aXJlKCcuLi9tb2R1bGVzL2RvbScpLFxuXHRmaWx0ZXJNb2R1bGUgPSByZXF1aXJlKCcuLi9tb2R1bGVzL2ZpbHRlcicpLFxuXHRyZXNpemVNb2R1bGUgPSByZXF1aXJlKCcuLi9tb2R1bGVzL3Jlc2l6ZScpO1xuXG52YXIgY29udGFpbmVyO1xuXG52YXIgaW5zdGFuY2VzID0ge1xuXHRvblNjcm9sbEV2ZW50SGFuZGxlcjogZnVuY3Rpb24oKSB7fSxcblx0b25JbnB1dEJsdXJFdmVudEhhbmRsZXI6IGZ1bmN0aW9uKCkge30sXG5cdG9uQ2xpY2tDZWxsRXZlbnRIYW5kbGVyOiBmdW5jdGlvbigpIHt9LFxuXHRvbkNsaWNrU2F2ZUJ1dHRvbkV2ZW50SGFuZGxlcjogZnVuY3Rpb24oKSB7fSxcblx0b25DbGlja1NvcnRIZWFkZXI6IGZ1bmN0aW9uKCkge30sXG5cdG9uQ2xpY2tGaWx0ZXJIZWFkZXI6IGZ1bmN0aW9uKCkge30sXG5cdG9uV2luZG93UmVzaXplOiBmdW5jdGlvbigpIHt9XG59O1xuXG5mdW5jdGlvbiBvbldoZWVsRXZlbnRIYW5kbGVyKGV2ZW50KSB7XG5cdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cblx0Y29udGFpbmVyLnNjcm9sbFRvcCArPSBldmVudC5kZWx0YVk7XG5cdGNvbnRhaW5lci5zY3JvbGxMZWZ0ICs9IGV2ZW50LmRlbHRhWDtcbn1cblxuZnVuY3Rpb24gb25TY3JvbGxFdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZykge1xuXHRkb21Nb2R1bGUucmVzZXRFZGl0aW5nQ2VsbChjb25maWcsIGluc3RhbmNlcy5vbklucHV0Qmx1ckV2ZW50SGFuZGxlcik7XG5cdGRvbU1vZHVsZS51cGRhdGVCdWZmZXJzKGNvbmZpZyk7XG5cdGRvbU1vZHVsZS51cGRhdGVUYWJsZShjb25maWcsIGZhbHNlKTtcbn1cblxuZnVuY3Rpb24gb25DbGlja0NlbGxFdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZykge1xuXHRpZiAoZXZlbnQudGFyZ2V0Lm1hdGNoZXMoJ2lucHV0JykpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRlZGl0TW9kdWxlLnN0YXJ0RWRpdGluZ0NlbGwoY29uZmlnLCBldmVudC50YXJnZXQsIGluc3RhbmNlcywge1xuXHRcdG9uSW5wdXRCbHVyRXZlbnRIYW5kbGVyOiBvbklucHV0Qmx1ckV2ZW50SGFuZGxlcixcblx0XHRvbklucHV0S2V5VXBFdmVudEhhbmRsZXI6IG9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlclxuXHR9KTtcbn1cblxuZnVuY3Rpb24gb25JbnB1dEJsdXJFdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZykge1xuXHRlZGl0TW9kdWxlLmZpbmlzaEVkaXRpbmdDZWxsKGNvbmZpZywgZXZlbnQudGFyZ2V0LCB7XG5cdFx0b25JbnB1dEJsdXJFdmVudEhhbmRsZXI6IG9uSW5wdXRCbHVyRXZlbnRIYW5kbGVyLFxuXHRcdG9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlcjogb25JbnB1dEtleVVwRXZlbnRIYW5kbGVyXG5cdH0pO1xufVxuXG5mdW5jdGlvbiBvbklucHV0S2V5VXBFdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZykge1xuXHR2YXIga2V5Q29kZSA9IGtleWJvYXJkVXRpbC5nZXRLZXlDb2RlKGV2ZW50KTtcblxuXHRzd2l0Y2ggKGtleUNvZGUpIHtcblx0XHRjYXNlIGtleWJvYXJkVXRpbC5LRVlfQ09ERVMuRU5URVI6XG5cdFx0XHRldmVudC50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmx1cicsIGluc3RhbmNlcy5vbklucHV0Qmx1ckV2ZW50SGFuZGxlcik7XG5cdFx0XHRlZGl0TW9kdWxlLmZpbmlzaEVkaXRpbmdDZWxsKGNvbmZpZywgZXZlbnQudGFyZ2V0LCB7XG5cdFx0XHRcdG9uSW5wdXRCbHVyRXZlbnRIYW5kbGVyOiBvbklucHV0Qmx1ckV2ZW50SGFuZGxlcixcblx0XHRcdFx0b25JbnB1dEtleVVwRXZlbnRIYW5kbGVyOiBvbklucHV0S2V5VXBFdmVudEhhbmRsZXJcblx0XHRcdH0pO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSBrZXlib2FyZFV0aWwuS0VZX0NPREVTLkVTQ0FQRTpcblx0XHRcdGVkaXRNb2R1bGUuY2FuY2VsRWRpdGluZ0NlbGwoY29uZmlnLCBldmVudC50YXJnZXQsIHtcblx0XHRcdFx0b25JbnB1dEJsdXJFdmVudEhhbmRsZXI6IG9uSW5wdXRCbHVyRXZlbnRIYW5kbGVyLFxuXHRcdFx0XHRvbklucHV0S2V5VXBFdmVudEhhbmRsZXI6IG9uSW5wdXRLZXlVcEV2ZW50SGFuZGxlclxuXHRcdFx0fSk7XG5cdFx0XHRicmVhaztcblx0XHRkZWZhdWx0OlxuXHRcdFx0YnJlYWs7XG5cdH1cbn1cblxuZnVuY3Rpb24gb25DbGlja1NhdmVCdXR0b25FdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZykge1xuXHRlZGl0TW9kdWxlLnNhdmVDZWxscyhjb25maWcpO1xufVxuXG5mdW5jdGlvbiBvbkNsaWNrU29ydEhlYWRlcihldmVudCwgY29uZmlnKSB7XG5cdHZhciBzb3J0Q2VsbFNlbGVjdG9yID0gJy4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5zb3J0Q2VsbCxcblx0XHRzb3J0RGlzYWJsZWRTZWxlY3RvciA9ICcuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuc29ydERpc2FibGVkLFxuXHRcdHNvcnRJY29uU2VsZWN0b3IgPSBzb3J0Q2VsbFNlbGVjdG9yICsgJyAuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuc29ydEljb247XG5cblx0aWYgKCFldmVudC50YXJnZXQubWF0Y2hlcyhzb3J0Q2VsbFNlbGVjdG9yKSAmJlxuXHRcdCFldmVudC50YXJnZXQubWF0Y2hlcyhzb3J0SWNvblNlbGVjdG9yKSB8fFxuXHRcdGV2ZW50LnRhcmdldC5tYXRjaGVzKHNvcnREaXNhYmxlZFNlbGVjdG9yKSkge1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGlmIChldmVudC50YXJnZXQubWF0Y2hlcyhzb3J0SWNvblNlbGVjdG9yKSkge1xuXHRcdHNvcnRNb2R1bGUucmVzZXRTb3J0KGNvbmZpZyk7XG5cdH1cblxuXHRpZiAoZXZlbnQudGFyZ2V0Lm1hdGNoZXMoc29ydENlbGxTZWxlY3RvcikpIHtcblx0XHRzb3J0TW9kdWxlLnNvcnRCeUNvbHVtbihjb25maWcsIGV2ZW50LnRhcmdldCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gb25DbGlja0ZpbHRlckhlYWRlcihldmVudCwgY29uZmlnKSB7XG5cdHZhciBmaWx0ZXJDZWxsU2VsZWN0b3IgPSAnLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckNlbGwsXG5cdFx0ZmlsdGVyRGlzYWJsZWRTZWxlY3RvciA9ICcuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyRGlzYWJsZWQsXG5cdFx0ZmlsdGVyU2VhcmNoSWNvblNlbGVjdG9yID0gZmlsdGVyQ2VsbFNlbGVjdG9yICsgJyAuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyU2VhcmNoSWNvbixcblx0XHRmaWx0ZXJDbGVhckljb25TZWxlY3RvciA9IGZpbHRlckNlbGxTZWxlY3RvciArICcgLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckNsZWFySWNvbjtcblxuXHRpZiAoIWV2ZW50LnRhcmdldC5tYXRjaGVzKGZpbHRlckNlbGxTZWxlY3RvcikgJiZcblx0XHQhZXZlbnQudGFyZ2V0Lm1hdGNoZXMoZmlsdGVyU2VhcmNoSWNvblNlbGVjdG9yKSAmJlxuXHRcdCFldmVudC50YXJnZXQubWF0Y2hlcyhmaWx0ZXJDbGVhckljb25TZWxlY3RvcikgfHxcblx0XHRldmVudC50YXJnZXQubWF0Y2hlcyhmaWx0ZXJEaXNhYmxlZFNlbGVjdG9yKSkge1xuXG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0dmFyIGNlbGwgPSBldmVudC50YXJnZXQubWF0Y2hlcyhmaWx0ZXJDZWxsU2VsZWN0b3IpID8gZXZlbnQudGFyZ2V0IDogZG9tVXRpbC5maW5kUGFyZW50Tm9kZShldmVudC50YXJnZXQsIGZpbHRlckNlbGxTZWxlY3Rvcik7XG5cblx0aWYgKGV2ZW50LnRhcmdldC5tYXRjaGVzKGZpbHRlckNsZWFySWNvblNlbGVjdG9yKSkge1xuXHRcdGZpbHRlck1vZHVsZS5jbGVhckZpbHRlcihjb25maWcsIGNlbGwpO1xuXG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0ZmlsdGVyTW9kdWxlLnN0YXJ0RWRpdGluZ0ZpbHRlcihjb25maWcsIGNlbGwpO1xufVxuXG5mdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZShldmVudCwgY29uZmlnKSB7XG5cdGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMudW5pcXVlSWQpID09PSBudWxsKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0cmVzaXplTW9kdWxlLnJlc2l6ZUV2ZW50SGFuZGxlcihjb25maWcpO1xufVxuXG5mdW5jdGlvbiBhZGRFdmVudHMoY29uZmlnKSB7XG5cdGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY29uZmlnLnNlbGVjdG9ycy52aXJ0dWFsQ29udGFpbmVyKTtcblxuXHRpbnN0YW5jZXMub25TY3JvbGxFdmVudEhhbmRsZXIgPSBmdW5jdGlvbihldmVudCkgeyBvblNjcm9sbEV2ZW50SGFuZGxlcihldmVudCwgY29uZmlnKTsgfTtcblx0aW5zdGFuY2VzLm9uQ2xpY2tDZWxsRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24oZXZlbnQpIHsgb25DbGlja0NlbGxFdmVudEhhbmRsZXIoZXZlbnQsIGNvbmZpZyk7IH07XG5cdGluc3RhbmNlcy5vbkNsaWNrU2F2ZUJ1dHRvbkV2ZW50SGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7IG9uQ2xpY2tTYXZlQnV0dG9uRXZlbnRIYW5kbGVyKGV2ZW50LCBjb25maWcpOyB9O1xuXHRpbnN0YW5jZXMub25DbGlja1NvcnRIZWFkZXIgPSBmdW5jdGlvbihldmVudCkgeyBvbkNsaWNrU29ydEhlYWRlcihldmVudCwgY29uZmlnKTsgfTtcblx0aW5zdGFuY2VzLm9uQ2xpY2tGaWx0ZXJIZWFkZXIgPSBmdW5jdGlvbihldmVudCkgeyBvbkNsaWNrRmlsdGVySGVhZGVyKGV2ZW50LCBjb25maWcpOyB9O1xuXHRpbnN0YW5jZXMub25XaW5kb3dSZXNpemUgPSBmdW5jdGlvbihldmVudCkgeyBvbldpbmRvd1Jlc2l6ZShldmVudCwgY29uZmlnKTsgfTtcblxuXHRpZiAoY29udGFpbmVyICE9PSBudWxsKSB7XG5cdFx0Y29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgb25XaGVlbEV2ZW50SGFuZGxlciwgeyBwYXNzaXZlOiBmYWxzZSwgY2FwdHVyZTogdHJ1ZSB9KTtcblx0XHRjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgaW5zdGFuY2VzLm9uU2Nyb2xsRXZlbnRIYW5kbGVyKTtcblx0fVxuXG5cdGlmIChjb25maWcuZWRpdC5lbmFibGVkICYmIGNvbmZpZy5zZWxlY3RvcnMuc2F2ZUJ1dHRvbiAhPT0gbnVsbCkge1xuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnNlbGVjdG9ycy5zYXZlQnV0dG9uKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGluc3RhbmNlcy5vbkNsaWNrU2F2ZUJ1dHRvbkV2ZW50SGFuZGxlcik7XG5cdH1cblxuXHRpZiAoY29uZmlnLmVkaXQuZW5hYmxlZCkge1xuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29uZmlnLnNlbGVjdG9ycy52aXJ0dWFsVGFibGUgKyAnIHRkLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmRhdGFDZWxsKS5mb3JFYWNoKGZ1bmN0aW9uKGVsKSB7XG5cdFx0XHRlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGluc3RhbmNlcy5vbkNsaWNrQ2VsbEV2ZW50SGFuZGxlcik7XG5cdFx0fSk7XG5cdH1cblxuXHRpZiAoY29uZmlnLnNvcnQuZW5hYmxlZCkge1xuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyMnICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy51bmlxdWVJZCArICcgdGQuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuc29ydENlbGwpLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcblx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zdGFuY2VzLm9uQ2xpY2tTb3J0SGVhZGVyKTtcblx0XHR9KTtcblx0fVxuXG5cdGlmIChjb25maWcuZmlsdGVyLmVuYWJsZWQpIHtcblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMudW5pcXVlSWQgKyAnIHRkLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckNlbGwpLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcblx0XHRcdGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zdGFuY2VzLm9uQ2xpY2tGaWx0ZXJIZWFkZXIpO1xuXHRcdH0pO1xuXHR9XG5cblx0aWYgKGNvbmZpZy5hdXRvUmVzaXplKSB7XG5cdFx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGluc3RhbmNlcy5vbldpbmRvd1Jlc2l6ZSk7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlRXZlbnRzKGNvbmZpZykge1xuXHRjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbENvbnRhaW5lcik7XG5cblx0aWYgKGNvbnRhaW5lciAhPT0gbnVsbCkge1xuXHRcdGNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIG9uV2hlZWxFdmVudEhhbmRsZXIpO1xuXHRcdGNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBpbnN0YW5jZXMub25TY3JvbGxFdmVudEhhbmRsZXIpO1xuXHR9XG5cblx0aWYgKGNvbmZpZy5lZGl0LmVuYWJsZWQgJiYgY29uZmlnLnNlbGVjdG9ycy5zYXZlQnV0dG9uICE9PSBudWxsKSB7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc2VsZWN0b3JzLnNhdmVCdXR0b24pLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zdGFuY2VzLm9uQ2xpY2tTYXZlQnV0dG9uRXZlbnRIYW5kbGVyKTtcblx0fVxuXG5cdGlmIChjb25maWcuZWRpdC5lbmFibGVkKSB7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuc2VsZWN0b3JzLnZpcnR1YWxUYWJsZSArICcgdGQuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZGF0YUNlbGwpLmZvckVhY2goZnVuY3Rpb24oZWwpIHtcblx0XHRcdGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zdGFuY2VzLm9uQ2xpY2tDZWxsRXZlbnRIYW5kbGVyKTtcblx0XHR9KTtcblx0fVxuXG5cdGlmIChjb25maWcuc29ydC5lbmFibGVkKSB7XG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnIycgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLnVuaXF1ZUlkICsgJyB0ZC4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5zb3J0Q2VsbCkuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdFx0ZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBpbnN0YW5jZXMub25DbGlja1NvcnRIZWFkZXIpO1xuXHRcdH0pO1xuXHR9XG5cblx0aWYgKGNvbmZpZy5maWx0ZXIuZW5hYmxlZCkge1xuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyMnICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy51bmlxdWVJZCArICcgdGQuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyQ2VsbCkuZm9yRWFjaChmdW5jdGlvbihlbCkge1xuXHRcdFx0ZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBpbnN0YW5jZXMub25DbGlja0ZpbHRlckhlYWRlcik7XG5cdFx0fSk7XG5cdH1cblxuXHRpZiAoY29uZmlnLmF1dG9SZXNpemUpIHtcblx0XHR3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgaW5zdGFuY2VzLm9uV2luZG93UmVzaXplKTtcblx0fVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0YWRkRXZlbnRzOiBhZGRFdmVudHMsXG5cdHJlbW92ZUV2ZW50czogcmVtb3ZlRXZlbnRzXG59O1xufSx7XCIuLi9tb2R1bGVzL2RvbVwiOjEzLFwiLi4vbW9kdWxlcy9lZGl0XCI6MTQsXCIuLi9tb2R1bGVzL2ZpbHRlclwiOjE2LFwiLi4vbW9kdWxlcy9yZXNpemVcIjoxOCxcIi4uL21vZHVsZXMvc29ydFwiOjE5LFwiLi4vdXRpbHMvZG9tXCI6MjYsXCIuLi91dGlscy9rZXlib2FyZFwiOjI3fV0sMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgZG9tVXRpbCAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2RvbScpLFxuXHRkb21Nb2R1bGUgID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9kb20nKSxcblx0c29ydE1vZHVsZSA9IHJlcXVpcmUoJy4uL21vZHVsZXMvc29ydCcpLFxuXHRkYXRhVXRpbCAgID0gcmVxdWlyZSgnLi4vdXRpbHMvZGF0YScpLFxuXHRjb25maWdVdGlsID0gcmVxdWlyZSgnLi4vdXRpbHMvY29uZmlndXJhdGlvbicpO1xuXG5mdW5jdGlvbiBzdGFydEVkaXRpbmdGaWx0ZXIoY29uZmlnLCBjZWxsKSB7XG5cdGlmIChjZWxsLnF1ZXJ5U2VsZWN0b3IoJy4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJDb250YWluZXIpICE9PSBudWxsKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0dmFyIGF0dHJpYnV0ZSA9IGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLWF0dHJpYnV0ZScpLFxuXHRcdGZpbHRlck9iaiA9IGNvbmZpZy5pbm5lci5maWx0ZXJzW2F0dHJpYnV0ZV0gfHwge30sXG5cdFx0aGVhZGVyT2JqID0gY29uZmlnVXRpbC5nZXRIZWFkZXJPYmplY3QoY29uZmlnLCBhdHRyaWJ1dGUpLFxuXHRcdGNsZWFySWNvbkNsYXNzID0gY29uZmlnLmlubmVyLmljb25zLmZpbHRlci5jbGVhcixcblx0XHRjbGVhckljb25FbGVtZW50Q2xhc3MgPSBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckNsZWFySWNvbiArICcgJyArIGNsZWFySWNvbkNsYXNzO1xuXG5cdGZpbHRlck9iai5hdHRyaWJ1dGUgPSBhdHRyaWJ1dGU7XG5cdGZpbHRlck9iai5maWx0ZXJUeXBlID0gaGVhZGVyT2JqLmZpbHRlclR5cGU7XG5cdGZpbHRlck9iai52YWx1ZSA9IGZpbHRlck9iai52YWx1ZSB8fCAnJztcblxuXHRjb25maWcuaW5uZXIuZmlsdGVyc1thdHRyaWJ1dGVdID0gZmlsdGVyT2JqO1xuXG5cdHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuXHRjZWxsLmlubmVySFRNTCA9ICcnO1xuXHRjZWxsLmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG5cblx0Y29udGFpbmVyLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJDb250YWluZXIpO1xuXHRjb250YWluZXIuaW5uZXJIVE1MID0gJzxpbnB1dD48aSBjbGFzcz1cIicgKyBjbGVhckljb25FbGVtZW50Q2xhc3MgKyAnXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPic7XG5cblx0dmFyIGlucHV0ID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG5cblx0aW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgaGVhZGVyT2JqLmRhdGFUeXBlKTtcblx0aW5wdXQudmFsdWUgPSBmaWx0ZXJPYmoudmFsdWU7XG5cdGlucHV0LmZvY3VzKCk7XG5cdGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHtcblx0XHRpZiAoKGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2gpID09PSAxMykgeyAvLyBFbnRlciBrZXlcblx0XHRcdGZpbHRlck9iai52YWx1ZSA9IGRhdGFVdGlsLmdldFZhbHVlQnlUeXBlKGlucHV0LnZhbHVlLCBoZWFkZXJPYmouZGF0YVR5cGUpO1xuXG5cdFx0XHRmaW5pc2hFZGl0aW5nRmlsdGVyKGNvbmZpZywgY2VsbCwgaGVhZGVyT2JqLCBmaWx0ZXJPYmopO1xuXHRcdH0gZWxzZSBpZiAoKGV2ZW50LmtleUNvZGUgfHwgZXZlbnQud2hpY2gpID09PSAyNykgeyAvLyBFc2NhcGUga2V5XG5cdFx0XHRmaW5pc2hFZGl0aW5nRmlsdGVyKGNvbmZpZywgY2VsbCwgaGVhZGVyT2JqLCBmaWx0ZXJPYmopO1xuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIGZpbHRlcihjb25maWcsIHNvcnRUYWJsZSkge1xuXHRzb3J0VGFibGUgPSBzb3J0VGFibGUgIT09IGZhbHNlO1xuXG5cdGNvbmZpZy5kYXRhU291cmNlID0gY29uZmlnLmlubmVyLm9yaWdpbmFsRGF0YVNvdXJjZTtcblxuXHRPYmplY3Qua2V5cyhjb25maWcuaW5uZXIuZmlsdGVycykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHR2YXIgZmlsdGVyT2JqID0gY29uZmlnLmlubmVyLmZpbHRlcnNba2V5XTtcblxuXHRcdGlmICh0eXBlb2YgZmlsdGVyT2JqLnZhbHVlID09ICd1bmRlZmluZWQnIHx8IGZpbHRlck9iai52YWx1ZSA9PT0gJycpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoZmlsdGVyT2JqLmZpbHRlclR5cGUgPT09ICdjdXN0b20nKSB7XG5cdFx0XHRpZiAoY29uZmlnLmZpbHRlci5jdXN0b21GaWx0ZXIgIT09IG51bGwpIHtcblx0XHRcdFx0Y29uZmlnLmRhdGFTb3VyY2UgPSBjb25maWcuZmlsdGVyLmN1c3RvbUZpbHRlcih7XG5cdFx0XHRcdFx0ZGF0YVNvdXJjZTogY29uZmlnLmRhdGFTb3VyY2UsXG5cdFx0XHRcdFx0YXR0cmlidXRlOiBmaWx0ZXJPYmouYXR0cmlidXRlLFxuXHRcdFx0XHRcdHZhbHVlOiBmaWx0ZXJPYmoudmFsdWUsXG5cdFx0XHRcdFx0ZWRpdGVkVmFsdWVzOiBjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzLFxuXHRcdFx0XHRcdHVuaXF1ZVJvd0tleTogY29uZmlnLnVuaXF1ZVJvd0tleVxuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Y29uZmlnLmRhdGFTb3VyY2UgPSBkYXRhVXRpbC5maWx0ZXJEYXRhKHtcblx0XHRcdFx0ZGF0YVNvdXJjZTogY29uZmlnLmRhdGFTb3VyY2UsXG5cdFx0XHRcdGF0dHJpYnV0ZTogZmlsdGVyT2JqLmF0dHJpYnV0ZSxcblx0XHRcdFx0ZmlsdGVyVHlwZTogZmlsdGVyT2JqLmZpbHRlclR5cGUsXG5cdFx0XHRcdHZhbHVlT25lOiBmaWx0ZXJPYmoudmFsdWUsXG5cdFx0XHRcdHZhbHVlVHdvOiBmaWx0ZXJPYmoudmFsdWVUd28sXG5cdFx0XHRcdGVkaXRlZFZhbHVlczogY29uZmlnLmVkaXRlZFZhbHVlcyxcblx0XHRcdFx0dW5pcXVlUm93S2V5OiBjb25maWcuaW5uZXIudW5pcXVlUm93S2V5XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xuXG5cdGlmIChzb3J0VGFibGUpIHtcblx0XHRzb3J0TW9kdWxlLnNvcnQoY29uZmlnLCBmYWxzZSk7XG5cdH1cblxuXHRkb21Nb2R1bGUucmVjYWxjdWxhdGVEaW1lbnNpb25zKGNvbmZpZyk7XG5cdGRvbU1vZHVsZS51cGRhdGVCdWZmZXJzKGNvbmZpZyk7XG5cdGRvbU1vZHVsZS51cGRhdGVUYWJsZShjb25maWcpO1xufVxuXG5mdW5jdGlvbiBjbGVhckZpbHRlcihjb25maWcsIGNlbGwpIHtcblx0dmFyIGF0dHJpYnV0ZSA9IGNlbGwuZ2V0QXR0cmlidXRlKCdkYXRhLWF0dHJpYnV0ZScpLFxuXHRcdGNlbGxPYmogPSBjb25maWdVdGlsLmdldEhlYWRlck9iamVjdChjb25maWcsIGF0dHJpYnV0ZSksXG5cdFx0ZmlsdGVyT2JqID0gY29uZmlnLmlubmVyLmZpbHRlcnNbYXR0cmlidXRlXTtcblxuXHRmaWx0ZXJPYmoudmFsdWUgPSAnJztcblxuXHR2YXIgbmV3RmlsdGVycyA9IHt9O1xuXG5cdE9iamVjdC5rZXlzKGNvbmZpZy5pbm5lci5maWx0ZXJzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkge1xuXHRcdGlmIChrZXkgIT09IGF0dHJpYnV0ZSkge1xuXHRcdFx0bmV3RmlsdGVyc1trZXldID0gY29uZmlnLmlubmVyLmZpbHRlcnNba2V5XTtcblx0XHR9XG5cdH0pO1xuXG5cdGNvbmZpZy5pbm5lci5maWx0ZXJzID0gbmV3RmlsdGVycztcblxuXHRmaW5pc2hFZGl0aW5nRmlsdGVyKGNvbmZpZywgY2VsbCwgY2VsbE9iaiwgZmlsdGVyT2JqKTtcbn1cblxuZnVuY3Rpb24gZmluaXNoRWRpdGluZ0ZpbHRlcihjb25maWcsIGNlbGwsIGNlbGxPYmosIGZpbHRlck9iaikge1xuXHRjZWxsLmlubmVySFRNTCA9IGRvbVV0aWwuZ2V0RmlsdGVyQ2VsbEh0bWwoY29uZmlnLCBjZWxsLCBjZWxsT2JqLCBmaWx0ZXJPYmopO1xuXG5cdGZpbHRlcihjb25maWcpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0c3RhcnRFZGl0aW5nRmlsdGVyOiBzdGFydEVkaXRpbmdGaWx0ZXIsXG5cdGZpbHRlcjogZmlsdGVyLFxuXHRjbGVhckZpbHRlcjogY2xlYXJGaWx0ZXJcbn07XG59LHtcIi4uL21vZHVsZXMvZG9tXCI6MTMsXCIuLi9tb2R1bGVzL3NvcnRcIjoxOSxcIi4uL3V0aWxzL2NvbmZpZ3VyYXRpb25cIjoyNCxcIi4uL3V0aWxzL2RhdGFcIjoyNSxcIi4uL3V0aWxzL2RvbVwiOjI2fV0sMTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgY29uZmlndXJhdGlvbiAgICAgID0gcmVxdWlyZSgnLi9jb25maWd1cmF0aW9uJyksXG5cdGNvbmZpZ1V0aWwgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2NvbmZpZ3VyYXRpb24nKSxcblx0ZXZlbnRIYW5kbGVyTW9kdWxlID0gcmVxdWlyZSgnLi4vbW9kdWxlcy9ldmVudC1oYW5kbGVyJyksXG5cdGRvbVV0aWwgICAgICAgICAgICA9IHJlcXVpcmUoJy4uL3V0aWxzL2RvbScpLFxuXHRkYXRhVXRpbCAgICAgICAgICAgPSByZXF1aXJlKCcuLi91dGlscy9kYXRhJyksXG5cdGRvbU1vZHVsZSAgICAgICAgICA9IHJlcXVpcmUoJy4uL21vZHVsZXMvZG9tJyk7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVGFibGUoY29uZmlnLCBvcHRpb25zKSB7XG5cdGNvbmZpZ3VyYXRpb24uaW5pdChjb25maWcsIG9wdGlvbnMsIGluaXRDb250YWluZXJzKTtcblxuXHRpbml0VGFibGUoY29uZmlnKTtcblxuXHRkb21Nb2R1bGUudXBkYXRlQnVmZmVycyhjb25maWcpO1xuXHRkb21Nb2R1bGUudXBkYXRlVGFibGUoY29uZmlnKTtcblxuXHRldmVudEhhbmRsZXJNb2R1bGUuYWRkRXZlbnRzKGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIGRlc3Ryb3lUYWJsZShjb25maWcpIHtcblx0ZXZlbnRIYW5kbGVyTW9kdWxlLnJlbW92ZUV2ZW50cyhjb25maWcpO1xuXHRkb21Nb2R1bGUuZGVzdHJveVRhYmxlKGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIGluaXRDb250YWluZXJzKGNvbmZpZykge1xuXHR2YXIgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc2VsZWN0b3JzLm1haW5Db250YWluZXIpLFxuXHRcdHZpcnR1YWxDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcblx0XHR2aXJ0dWFsVGFibGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0YWJsZScpLFxuXHRcdGZpeGVkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG5cdFx0Zml4ZWRUYWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG5cblx0Y29udGFpbmVyLnNldEF0dHJpYnV0ZSgnaWQnLCBjb25maWcuaW5uZXIuc2VsZWN0b3JzLnVuaXF1ZUlkKTtcblx0dmlydHVhbENvbnRhaW5lci5jbGFzc0xpc3QuYWRkKGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbENvbnRhaW5lcik7XG5cdHZpcnR1YWxUYWJsZS5jbGFzc0xpc3QuYWRkKGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlKTtcblx0Zml4ZWRDb250YWluZXIuY2xhc3NMaXN0LmFkZChjb25maWcuc2VsZWN0b3JzLmZpeGVkQ29udGFpbmVyKTtcblx0Zml4ZWRUYWJsZS5jbGFzc0xpc3QuYWRkKGNvbmZpZy5zZWxlY3RvcnMuZml4ZWRUYWJsZSk7XG5cblx0Y29udGFpbmVyLmFwcGVuZENoaWxkKGZpeGVkQ29udGFpbmVyKTtcblx0Zml4ZWRDb250YWluZXIuYXBwZW5kQ2hpbGQoZml4ZWRUYWJsZSk7XG5cblx0Y29udGFpbmVyLmFwcGVuZENoaWxkKHZpcnR1YWxDb250YWluZXIpO1xuXHR2aXJ0dWFsQ29udGFpbmVyLmFwcGVuZENoaWxkKHZpcnR1YWxUYWJsZSk7XG5cblx0dmlydHVhbENvbnRhaW5lci5zdHlsZS5tYXhIZWlnaHQgPSBjb25maWcuZGltZW5zaW9ucy5jb250YWluZXJIZWlnaHQgKyAncHgnO1xuXHR2aXJ0dWFsQ29udGFpbmVyLnN0eWxlLmhlaWdodCA9IGNvbmZpZy5kaW1lbnNpb25zLmNvbnRhaW5lckhlaWdodCArICdweCc7XG5cdHZpcnR1YWxDb250YWluZXIuc3R5bGUub3ZlcmZsb3cgPSAnc2Nyb2xsJztcblxuXHRmaXhlZENvbnRhaW5lci5zdHlsZS5wYWRkaW5nID0gY29uZmlnLmlubmVyLm1pbkJ1ZmZlckhlaWdodCArICdweCAwJztcblx0Zml4ZWRDb250YWluZXIuc3R5bGUuZmxvYXQgPSAnbGVmdCc7XG59XG5cbmZ1bmN0aW9uIGluaXRUYWJsZShjb25maWcpIHtcblx0Ly8gR2VuZXJhdGUgdmlydHVhbCB0YWJsZVxuXHR2YXIgdmlydHVhbFRoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKSxcblx0XHR2aXJ0dWFsVGJvZHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0Ym9keScpLFxuXHRcdHRySGVhZEJ1ZmZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyksXG5cdFx0Y29sdW1uc051bWJlciA9IGNvbmZpZ1V0aWwuZ2V0S2V5SGVhZGVyKGNvbmZpZykubGVuZ3RoLFxuXHRcdHJvd3NOdW1iZXIgPSBjb25maWcuZGF0YVNvdXJjZS5sZW5ndGgsXG5cdFx0bWF4Q29sdW1uTnVtYmVyID0gY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgPj0gY29sdW1uc051bWJlciA/IGNvbHVtbnNOdW1iZXIgOiBjb25maWcuaW5uZXIudmlzaWJsZUNvbHVtbk51bWJlcixcblx0XHRtYXhSb3dOdW1iZXIgPSBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlciA+PSByb3dzTnVtYmVyID8gcm93c051bWJlciA6IGNvbmZpZy5pbm5lci52aXNpYmxlUm93TnVtYmVyO1xuXG5cdHRySGVhZEJ1ZmZlci5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyUm93VG9wKTtcblxuXHR2YXIgaSwgaiwgdHJIZWFkLCB0ckJvZHksIGJ1ZmZlckNvbHVtbkxlZnQsIGJ1ZmZlckNvbHVtblJpZ2h0LCBidWZmZXJSb3dCb3R0b20sIHRkRWxlbWVudCwgY2VsbE9iajtcblxuXHQvLyBHZW5lcmF0ZSB2aXJ0dWFsIGhlYWRlclxuXHRidWZmZXJDb2x1bW5MZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0YnVmZmVyQ29sdW1uTGVmdC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyQ29sdW1uTGVmdCk7XG5cblx0dHJIZWFkQnVmZmVyLmFwcGVuZENoaWxkKGJ1ZmZlckNvbHVtbkxlZnQpO1xuXG5cdGZvciAoaSA9IDA7IGkgPCBtYXhDb2x1bW5OdW1iZXI7IGkrKykge1xuXHRcdHRkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0dGRFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFdpZHRoICsgJ3B4Jztcblx0XHR0ckhlYWRCdWZmZXIuYXBwZW5kQ2hpbGQodGRFbGVtZW50KTtcblx0fVxuXG5cdGJ1ZmZlckNvbHVtblJpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0YnVmZmVyQ29sdW1uUmlnaHQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtblJpZ2h0KTtcblxuXHR0ckhlYWRCdWZmZXIuYXBwZW5kQ2hpbGQoYnVmZmVyQ29sdW1uUmlnaHQpO1xuXG5cdHZpcnR1YWxUaGVhZC5hcHBlbmRDaGlsZCh0ckhlYWRCdWZmZXIpO1xuXG5cdGNvbmZpZy5oZWFkZXJzLmZvckVhY2goZnVuY3Rpb24oaGVhZGVyUm93LCByb3dDb3VudCkge1xuXHRcdHZhciBpc0xhc3RSb3cgPSBjb25maWcuaW5uZXIuaW5kZXhPZkNlbGxLZXlIZWFkZXIgPT09IHJvd0NvdW50O1xuXG5cdFx0dHJIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHR0ckhlYWQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmhlYWRlclJvdyk7XG5cdFx0dHJIZWFkLnN0eWxlLmhlaWdodCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQgKyAncHgnO1xuXG5cdFx0dGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtbkxlZnQpO1xuXG5cdFx0dHJIZWFkLmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cblx0XHRmb3IgKGogPSAwOyBqIDwgbWF4Q29sdW1uTnVtYmVyOyBqKyspIHtcblx0XHRcdHRkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmhlYWRlckNlbGwpO1xuXHRcdFx0dGRFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFdpZHRoICsgJ3B4Jztcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdWZXJ0aWNhbCArICdweCAnICsgY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdIb3Jpem9udGFsICsgJ3B4Jztcblx0XHRcdHRkRWxlbWVudC5pbm5lckhUTUwgPSBkb21VdGlsLmdldEhlYWRlckNlbGxIdG1sKGNvbmZpZywgdGRFbGVtZW50LCBoZWFkZXJSb3dbal0sIGlzTGFzdFJvdyk7XG5cblx0XHRcdGlmIChpc0xhc3RSb3cpIHtcblx0XHRcdFx0dGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5zb3J0Q2VsbCk7XG5cblx0XHRcdFx0aWYgKCFjb25maWcuc29ydC5lbmFibGVkIHx8IGhlYWRlclJvd1tqXS5zb3J0RGlzYWJsZWQpIHtcblx0XHRcdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLnNvcnREaXNhYmxlZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dHJIZWFkLmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0dGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtblJpZ2h0KTtcblxuXHRcdHRySGVhZC5hcHBlbmRDaGlsZCh0ZEVsZW1lbnQpO1xuXG5cdFx0dmlydHVhbFRoZWFkLmFwcGVuZENoaWxkKHRySGVhZCk7XG5cdH0pO1xuXG5cdC8vIEdlbmVyYXRlIHZpcnR1YWwgZmlsdGVyIHJvd1xuXHRpZiAoY29uZmlnLmZpbHRlci5lbmFibGVkKSB7XG5cdFx0dHJIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHR0ckhlYWQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlclJvdyk7XG5cdFx0dHJIZWFkLnN0eWxlLmhlaWdodCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQgKyAncHgnO1xuXG5cdFx0dGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtbkxlZnQpO1xuXG5cdFx0dHJIZWFkLmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cblx0XHRmb3IgKGogPSAwOyBqIDwgbWF4Q29sdW1uTnVtYmVyOyBqKyspIHtcblx0XHRcdGNlbGxPYmogPSBjb25maWdVdGlsLmdldEtleUhlYWRlcihjb25maWcpW2pdO1xuXG5cdFx0XHR0ZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdFx0dGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJDZWxsKTtcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxXaWR0aCArICdweCc7XG5cdFx0XHR0ZEVsZW1lbnQuc3R5bGUucGFkZGluZyA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxQYWRkaW5nVmVydGljYWwgKyAncHggJyArIGNvbmZpZy5kaW1lbnNpb25zLmNlbGxQYWRkaW5nSG9yaXpvbnRhbCArICdweCc7XG5cdFx0XHR0ZEVsZW1lbnQuaW5uZXJIVE1MID0gZG9tVXRpbC5nZXRGaWx0ZXJDZWxsSHRtbChjb25maWcsIHRkRWxlbWVudCwgY2VsbE9iaiwge30pO1xuXG5cdFx0XHRpZiAoY2VsbE9iai5maWx0ZXJEaXNhYmxlZCkge1xuXHRcdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlckRpc2FibGVkKTtcblx0XHRcdH1cblxuXHRcdFx0dHJIZWFkLmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0dGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtblJpZ2h0KTtcblxuXHRcdHRySGVhZC5hcHBlbmRDaGlsZCh0ZEVsZW1lbnQpO1xuXG5cdFx0dmlydHVhbFRoZWFkLmFwcGVuZENoaWxkKHRySGVhZCk7XG5cdH1cblxuXHQvLyBHZW5lcmF0ZSB2aXJ0dWFsIGJvZHlcblx0Zm9yIChpID0gMDsgaSA8IG1heFJvd051bWJlcjsgaSsrKSB7XG5cdFx0dHJCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHR0ckJvZHkuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmRhdGFSb3cpO1xuXHRcdHRyQm9keS5zdHlsZS5oZWlnaHQgPSBjb25maWcuZGltZW5zaW9ucy5jZWxsSGVpZ2h0ICsgJ3B4JztcblxuXHRcdHRkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0dGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5idWZmZXJDb2x1bW5MZWZ0KTtcblxuXHRcdHRyQm9keS5hcHBlbmRDaGlsZCh0ZEVsZW1lbnQpO1xuXG5cdFx0Zm9yIChqID0gMDsgaiA8IG1heENvbHVtbk51bWJlcjsgaisrKSB7XG5cdFx0XHR0ZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdFx0dGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5kYXRhQ2VsbCk7XG5cdFx0XHR0ZEVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBjb25maWcuZGltZW5zaW9ucy5jZWxsV2lkdGggKyAncHgnO1xuXHRcdFx0dGRFbGVtZW50LnN0eWxlLnBhZGRpbmcgPSBjb25maWcuZGltZW5zaW9ucy5jZWxsUGFkZGluZ1ZlcnRpY2FsICsgJ3B4ICcgKyBjb25maWcuZGltZW5zaW9ucy5jZWxsUGFkZGluZ0hvcml6b250YWwgKyAncHgnO1xuXG5cdFx0XHR0ckJvZHkuYXBwZW5kQ2hpbGQodGRFbGVtZW50KTtcblx0XHR9XG5cblx0XHR0ZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdHRkRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyQ29sdW1uUmlnaHQpO1xuXG5cdFx0dHJCb2R5LmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cblx0XHR2aXJ0dWFsVGJvZHkuYXBwZW5kQ2hpbGQodHJCb2R5KTtcblx0fVxuXG5cdGJ1ZmZlclJvd0JvdHRvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cdGJ1ZmZlclJvd0JvdHRvbS5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyUm93Qm90dG9tKTtcblxuXHR2aXJ0dWFsVGJvZHkuYXBwZW5kQ2hpbGQoYnVmZmVyUm93Qm90dG9tKTtcblxuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlKS5hcHBlbmRDaGlsZCh2aXJ0dWFsVGhlYWQpO1xuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlKS5hcHBlbmRDaGlsZCh2aXJ0dWFsVGJvZHkpO1xuXG5cdGNvbmZpZy5pbm5lci5idWZmZXJMZWZ0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtbkxlZnQpO1xuXHRjb25maWcuaW5uZXIuYnVmZmVyUmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyQ29sdW1uUmlnaHQpO1xuXHRjb25maWcuaW5uZXIuYnVmZmVyVG9wID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlclJvd1RvcCk7XG5cdGNvbmZpZy5pbm5lci5idWZmZXJCb3R0b20gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuYnVmZmVyUm93Qm90dG9tKTtcblxuXHQvLyBHZW5lcmF0ZSBmaXhlZCB0YWJsZVxuXG5cdGlmIChjb25maWcuZml4ZWRIZWFkZXJzLmxlbmd0aCA9PT0gMCB8fCBjb25maWcuZml4ZWRIZWFkZXJzWzBdLmxlbmd0aCA9PT0gMCkge1xuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY29uZmlnLnNlbGVjdG9ycy5maXhlZFRhYmxlKS5yZW1vdmUoKTtcblxuXHRcdHJldHVybjtcblx0fVxuXG5cdHZhciBmaXhlZFRoZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGhlYWQnKSxcblx0XHRmaXhlZFRib2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGJvZHknKTtcblxuXHQvLyBHZW5lcmF0ZSBmaXhlZCBoZWFkZXJcblxuXHRmb3IgKGkgPSAwOyBpIDwgY29uZmlnLmZpeGVkSGVhZGVycy5sZW5ndGg7IGkrKykge1xuXHRcdHRySGVhZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cdFx0dHJIZWFkLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJSb3cpO1xuXHRcdHRySGVhZC5zdHlsZS5oZWlnaHQgPSBjb25maWcuZGltZW5zaW9ucy5jZWxsSGVpZ2h0ICsgJ3B4JztcblxuXHRcdGZvciAoaiA9IDA7IGogPCBjb25maWcuZml4ZWRIZWFkZXJzW2ldLmxlbmd0aDsgaisrKSB7XG5cdFx0XHR2YXIgaXNMYXN0Um93ID0gaiA9PT0gY29uZmlnLmZpeGVkSGVhZGVyc1tpXS5sZW5ndGggLSAxO1xuXG5cdFx0XHR0ZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXHRcdFx0dGRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlubmVyLnNlbGVjdG9ycy5oZWFkZXJDZWxsKTtcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxXaWR0aCArICdweCc7XG5cdFx0XHR0ZEVsZW1lbnQuaW5uZXJIVE1MID0gZG9tVXRpbC5nZXRIZWFkZXJDZWxsSHRtbChjb25maWcsIHRkRWxlbWVudCwgY29uZmlnLmZpeGVkSGVhZGVyc1tpXVtqXSwgaXNMYXN0Um93KTtcblxuXHRcdFx0aWYgKGlzTGFzdFJvdykge1xuXHRcdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLnNvcnRDZWxsKTtcblxuXHRcdFx0XHRpZiAoIWNvbmZpZy5zb3J0LmVuYWJsZWQgfHwgY29uZmlnLmZpeGVkSGVhZGVyc1tpXVtqXS5zb3J0RGlzYWJsZWQpIHtcblx0XHRcdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLnNvcnREaXNhYmxlZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dHJIZWFkLmFwcGVuZENoaWxkKHRkRWxlbWVudCk7XG5cdFx0fVxuXG5cdFx0Zml4ZWRUaGVhZC5hcHBlbmRDaGlsZCh0ckhlYWQpO1xuXHR9XG5cblx0Ly8gR2VuZXJhdGUgZml4ZWQgZmlsdGVyIHJvd1xuXG5cdGlmIChjb25maWcuZmlsdGVyLmVuYWJsZWQgJiZcblx0XHRjb25maWcuZml4ZWRIZWFkZXJzLmxlbmd0aCA+IDAgJiZcblx0XHRjb25maWcuZml4ZWRIZWFkZXJzW2NvbmZpZy5pbm5lci5pbmRleE9mQ2VsbEtleUhlYWRlcl0ubGVuZ3RoID4gMCkge1xuXG5cdFx0dHJIZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHR0ckhlYWQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmZpbHRlclJvdyk7XG5cdFx0dHJIZWFkLnN0eWxlLmhlaWdodCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQgKyAncHgnO1xuXG5cdFx0Zm9yIChqID0gMDsgaiA8IGNvbmZpZy5maXhlZEhlYWRlcnNbY29uZmlnLmlubmVyLmluZGV4T2ZDZWxsS2V5SGVhZGVyXS5sZW5ndGg7IGorKykge1xuXHRcdFx0Y2VsbE9iaiA9IGNvbmZpZ1V0aWwuZ2V0Rml4ZWRLZXlIZWFkZXIoY29uZmlnKVtqXTtcblxuXHRcdFx0dGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcblx0XHRcdHRkRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyQ2VsbCk7XG5cdFx0XHR0ZEVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBjb25maWcuZGltZW5zaW9ucy5jZWxsV2lkdGggKyAncHgnO1xuXHRcdFx0dGRFbGVtZW50LnN0eWxlLm1heFdpZHRoID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFdpZHRoICsgJ3B4Jztcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdWZXJ0aWNhbCArICdweCAnICsgY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdIb3Jpem9udGFsICsgJ3B4Jztcblx0XHRcdHRkRWxlbWVudC5pbm5lckhUTUwgPSBkb21VdGlsLmdldEZpbHRlckNlbGxIdG1sKGNvbmZpZywgdGRFbGVtZW50LCBjZWxsT2JqLCB7fSk7XG5cblx0XHRcdGlmIChjZWxsT2JqLmZpbHRlckRpc2FibGVkKSB7XG5cdFx0XHRcdHRkRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyRGlzYWJsZWQpO1xuXHRcdFx0fVxuXG5cdFx0XHR0ckhlYWQuYXBwZW5kQ2hpbGQodGRFbGVtZW50KTtcblx0XHR9XG5cblx0XHRmaXhlZFRoZWFkLmFwcGVuZENoaWxkKHRySGVhZCk7XG5cdH1cblxuXHQvLyBHZW5lcmF0ZSBmaXhlZCBib2R5XG5cblx0Zm9yIChpID0gMDsgaSA8IG1heFJvd051bWJlcjsgaSsrKSB7XG5cdFx0dHJCb2R5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcblx0XHR0ckJvZHkuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmRhdGFSb3cpO1xuXHRcdHRyQm9keS5zdHlsZS5oZWlnaHQgPSBjb25maWcuZGltZW5zaW9ucy5jZWxsSGVpZ2h0ICsgJ3B4JztcblxuXHRcdGZvciAoaiA9IDA7IGogPCBjb25maWcuZml4ZWRIZWFkZXJzW2NvbmZpZy5pbm5lci5pbmRleE9mQ2VsbEtleUhlYWRlcl0ubGVuZ3RoOyBqKyspIHtcblx0XHRcdHRkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0XHR0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5uZXIuc2VsZWN0b3JzLmRhdGFDZWxsKTtcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdWZXJ0aWNhbCArICdweCAnICsgY29uZmlnLmRpbWVuc2lvbnMuY2VsbFBhZGRpbmdIb3Jpem9udGFsICsgJ3B4Jztcblx0XHRcdHRkRWxlbWVudC5zdHlsZS5taW5XaWR0aCA9IGNvbmZpZy5kaW1lbnNpb25zLmNlbGxXaWR0aCArICdweCc7XG5cblx0XHRcdHRyQm9keS5hcHBlbmRDaGlsZCh0ZEVsZW1lbnQpO1xuXHRcdH1cblxuXHRcdGZpeGVkVGJvZHkuYXBwZW5kQ2hpbGQodHJCb2R5KTtcblx0fVxuXG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY29uZmlnLnNlbGVjdG9ycy5maXhlZFRhYmxlKS5hcHBlbmRDaGlsZChmaXhlZFRoZWFkKTtcblx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLicgKyBjb25maWcuc2VsZWN0b3JzLmZpeGVkVGFibGUpLmFwcGVuZENoaWxkKGZpeGVkVGJvZHkpO1xufVxuXG5mdW5jdGlvbiBnZXREZWZhdWx0T3B0aW9ucygpIHtcblx0cmV0dXJuIGRhdGFVdGlsLmNsb25lT2JqZWN0KGNvbmZpZ3VyYXRpb24uREVGQVVMVFMpO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0Z2VuZXJhdGVUYWJsZTogZ2VuZXJhdGVUYWJsZSxcblx0ZGVzdHJveVRhYmxlOiBkZXN0cm95VGFibGUsXG5cdGdldERlZmF1bHRPcHRpb25zOiBnZXREZWZhdWx0T3B0aW9uc1xufTtcbn0se1wiLi4vbW9kdWxlcy9kb21cIjoxMyxcIi4uL21vZHVsZXMvZXZlbnQtaGFuZGxlclwiOjE1LFwiLi4vdXRpbHMvY29uZmlndXJhdGlvblwiOjI0LFwiLi4vdXRpbHMvZGF0YVwiOjI1LFwiLi4vdXRpbHMvZG9tXCI6MjYsXCIuL2NvbmZpZ3VyYXRpb25cIjoxMn1dLDE4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIGNvbmZpZ1V0aWwgPSByZXF1aXJlKCcuLi91dGlscy9jb25maWd1cmF0aW9uJyksXG5cdGRvbU1vZHVsZSAgPSByZXF1aXJlKCcuLi9tb2R1bGVzL2RvbScpO1xuXG52YXIgREVMQVkgPSAyMDA7XG5cbnZhciBpc0V2ZW50RGVsYXllZCA9IGZhbHNlO1xuXG5mdW5jdGlvbiByZWRyYXdUYWJsZShjb25maWcpIHtcblx0dmFyIHByZXZSb3dOdW1iZXIgPSBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlcixcblx0XHRwcmV2Q29sdW1uTnVtYmVyID0gY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXI7XG5cblx0Y29uZmlnLmRpbWVuc2lvbnMuY29udGFpbmVySGVpZ2h0ID0gY29uZmlnVXRpbC5jYWxjdWxhdGVWaXJ0dWFsQ29udGFpbmVySGVpZ2h0KGNvbmZpZywgY29uZmlnVXRpbC5nZXREZWZhdWx0Q29udGFpbmVySGVpZ2h0KGNvbmZpZykpO1xuXHRjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlciA9IGNvbmZpZ1V0aWwuZ2V0VmlzaWJsZVJvd051bWJlcihjb25maWcpO1xuXHRjb25maWcuaW5uZXIudmlzaWJsZUNvbHVtbk51bWJlciA9IGNvbmZpZ1V0aWwuZ2V0VmlzaWJsZUNvbHVtbk51bWJlcihjb25maWcpO1xuXHRjb25maWcuaW5uZXIudGFibGVPZmZzZXRXaWR0aCA9IGNvbmZpZ1V0aWwuZ2V0VGFibGVPZmZzZXRXaWR0aChjb25maWcpO1xuXHRjb25maWcuaW5uZXIudGFibGVPZmZzZXRIZWlnaHQgPSBjb25maWdVdGlsLmdldFRhYmxlT2Zmc2V0SGVpZ2h0KGNvbmZpZyk7XG5cblx0dmFyIGksIGxhc3RSb3csIGxhc3RDb2x1bW5zO1xuXG5cdGlmIChwcmV2Um93TnVtYmVyID09PSBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlciAmJlxuXHRcdHByZXZDb2x1bW5OdW1iZXIgPT09IGNvbmZpZy5pbm5lci52aXNpYmxlQ29sdW1uTnVtYmVyKSB7XG5cblx0XHRyZXR1cm47XG5cdH1cblxuXHRpZiAoY29uZmlnLmlubmVyLnZpc2libGVSb3dOdW1iZXIgPCAxKSB7XG5cdFx0Y29uZmlnLmlubmVyLnZpc2libGVSb3dOdW1iZXIgPSAxO1xuXG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0dmFyIHZpcnR1YWxDb250YWluZXJTZWxlY3RvciA9ICcjJyArIGNvbmZpZy5pbm5lci5zZWxlY3RvcnMudW5pcXVlSWQgKyAnIC4nICsgY29uZmlnLnNlbGVjdG9ycy52aXJ0dWFsQ29udGFpbmVyLFxuXHRcdGxhc3RGaXhlZFJvd1NlbGVjdG9yID0gJyMnICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy51bmlxdWVJZCArICcgLicgKyBjb25maWcuc2VsZWN0b3JzLmZpeGVkVGFibGUgKyAnIC5kYXRhLXJvdzpsYXN0LW9mLXR5cGUnLFxuXHRcdGxhc3RWaXJ0dWFsUm93U2VsZWN0b3IgPSAnIycgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLnVuaXF1ZUlkICsgJyAuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlICsgJyAuZGF0YS1yb3c6bnRoLWxhc3Qtb2YtdHlwZSgyKScsXG5cdFx0bGFzdFZpcnR1YWxDb2x1bW4gPSAnIycgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLnVuaXF1ZUlkICsgJyAuJyArIGNvbmZpZy5zZWxlY3RvcnMudmlydHVhbFRhYmxlICsgJyB0ZDpudGgtbGFzdC1vZi10eXBlKDIpJztcblxuXHR2YXIgdmlydHVhbENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodmlydHVhbENvbnRhaW5lclNlbGVjdG9yKTtcblxuXHR2aXJ0dWFsQ29udGFpbmVyLnN0eWxlLm1heEhlaWdodCA9IGNvbmZpZy5kaW1lbnNpb25zLmNvbnRhaW5lckhlaWdodCArICdweCc7XG5cdHZpcnR1YWxDb250YWluZXIuc3R5bGUuaGVpZ2h0ID0gY29uZmlnLmRpbWVuc2lvbnMuY29udGFpbmVySGVpZ2h0ICsgJ3B4JztcblxuXHRpZiAocHJldlJvd051bWJlciA8IGNvbmZpZy5pbm5lci52aXNpYmxlUm93TnVtYmVyKSB7IC8vIEhhIHTDtmJiIHNvciBsZXR0XG5cdFx0Zm9yIChpID0gMDsgaSA8IGNvbmZpZy5pbm5lci52aXNpYmxlUm93TnVtYmVyIC0gcHJldlJvd051bWJlcjsgaSsrKSB7XG5cdFx0XHRsYXN0Um93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihsYXN0Rml4ZWRSb3dTZWxlY3Rvcik7XG5cblx0XHRcdGlmIChsYXN0Um93ICE9PSBudWxsKSB7XG5cdFx0XHRcdGxhc3RSb3cucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobGFzdFJvdy5jbG9uZU5vZGUodHJ1ZSksIGxhc3RSb3cpO1xuXHRcdFx0fVxuXG5cdFx0XHRsYXN0Um93ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihsYXN0VmlydHVhbFJvd1NlbGVjdG9yKTtcblx0XHRcdGxhc3RSb3cucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobGFzdFJvdy5jbG9uZU5vZGUodHJ1ZSksIGxhc3RSb3cpO1xuXHRcdH1cblx0fSBlbHNlIGlmIChwcmV2Um93TnVtYmVyID4gY29uZmlnLmlubmVyLnZpc2libGVSb3dOdW1iZXIpIHsgLy8gSGEga2V2ZXNlYmIgc29yIGxldHRcblx0XHRmb3IgKGkgPSAwOyBpIDwgcHJldlJvd051bWJlciAtIGNvbmZpZy5pbm5lci52aXNpYmxlUm93TnVtYmVyOyBpKyspIHtcblx0XHRcdGxhc3RSb3cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGxhc3RGaXhlZFJvd1NlbGVjdG9yKTtcblxuXHRcdFx0aWYgKGxhc3RSb3cgIT09IG51bGwpIHtcblx0XHRcdFx0bGFzdFJvdy5yZW1vdmUoKTtcblx0XHRcdH1cblxuXHRcdFx0bGFzdFJvdyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobGFzdFZpcnR1YWxSb3dTZWxlY3Rvcik7XG5cdFx0XHRsYXN0Um93LnJlbW92ZSgpO1xuXHRcdH1cblx0fVxuXG5cdGlmIChwcmV2Q29sdW1uTnVtYmVyIDwgY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIpIHsgLy8gSGEgdMO2YmIgb3N6bG9wIGxldHRcblx0XHRmb3IgKGkgPSAwOyBpIDwgY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgLSBwcmV2Q29sdW1uTnVtYmVyOyBpKyspIHtcblx0XHRcdGxhc3RDb2x1bW5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChsYXN0VmlydHVhbENvbHVtbik7XG5cdFx0XHRsYXN0Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbikge1xuXHRcdFx0XHRjb2x1bW4ucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoY29sdW1uLmNsb25lTm9kZSh0cnVlKSwgY29sdW1uKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSBlbHNlIGlmIChwcmV2Q29sdW1uTnVtYmVyID4gY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIpIHsgLy8gSGEga2V2ZXNlYmIgb3N6bG9wIGxldHRcblx0XHRmb3IgKGkgPSAwOyBpIDwgcHJldkNvbHVtbk51bWJlciAtIGNvbmZpZy5pbm5lci52aXNpYmxlQ29sdW1uTnVtYmVyOyBpKyspIHtcblx0XHRcdGxhc3RDb2x1bW5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChsYXN0VmlydHVhbENvbHVtbik7XG5cdFx0XHRsYXN0Q29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbikge1xuXHRcdFx0XHRjb2x1bW4ucmVtb3ZlKCk7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRjb25maWcuaW5uZXIuYnVmZmVyTGVmdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5idWZmZXJDb2x1bW5MZWZ0KTtcblx0Y29uZmlnLmlubmVyLmJ1ZmZlclJpZ2h0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlckNvbHVtblJpZ2h0KTtcblx0Y29uZmlnLmlubmVyLmJ1ZmZlclRvcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy4nICsgY29uZmlnLmlubmVyLnNlbGVjdG9ycy5idWZmZXJSb3dUb3ApO1xuXHRjb25maWcuaW5uZXIuYnVmZmVyQm90dG9tID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLicgKyBjb25maWcuaW5uZXIuc2VsZWN0b3JzLmJ1ZmZlclJvd0JvdHRvbSk7XG5cblx0ZG9tTW9kdWxlLnVwZGF0ZUJ1ZmZlcnMoY29uZmlnKTtcblx0ZG9tTW9kdWxlLnVwZGF0ZVRhYmxlKGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIHJlc2l6ZUV2ZW50SGFuZGxlcihjb25maWcpIHtcblx0aWYgKCFpc0V2ZW50RGVsYXllZCkge1xuXHRcdGlzRXZlbnREZWxheWVkID0gdHJ1ZTtcblxuXHRcdHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0aXNFdmVudERlbGF5ZWQgPSBmYWxzZTtcblxuXHRcdFx0cmVkcmF3VGFibGUoY29uZmlnKTtcblx0XHR9LCBERUxBWSk7XG5cdH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdHJlc2l6ZUV2ZW50SGFuZGxlcjogcmVzaXplRXZlbnRIYW5kbGVyXG59O1xufSx7XCIuLi9tb2R1bGVzL2RvbVwiOjEzLFwiLi4vdXRpbHMvY29uZmlndXJhdGlvblwiOjI0fV0sMTk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgZG9tTW9kdWxlICA9IHJlcXVpcmUoJy4uL21vZHVsZXMvZG9tJyksXG5cdGNvbmZpZ1V0aWwgPSByZXF1aXJlKCcuLi91dGlscy9jb25maWd1cmF0aW9uJyksXG5cdGRhdGFVdGlsICAgPSByZXF1aXJlKCcuLi91dGlscy9kYXRhJyk7XG5cbmZ1bmN0aW9uIHNvcnRCeUNvbHVtbihjb25maWcsIGNvbHVtbikge1xuXHR2YXIgYXR0cmlidXRlID0gY29sdW1uLmdldEF0dHJpYnV0ZSgnZGF0YS1hdHRyaWJ1dGUnKSxcblx0XHRoZWFkZXJPYmogPSBjb25maWdVdGlsLmdldEhlYWRlck9iamVjdChjb25maWcsIGF0dHJpYnV0ZSksXG5cdFx0ZGlyZWN0aW9uID0gJ3VwJztcblxuXHRpZiAoY29uZmlnLmlubmVyLnNvcnQuYXR0cmlidXRlID09PSBhdHRyaWJ1dGUgJiZcblx0XHRjb25maWcuaW5uZXIuc29ydC5kaXJlY3Rpb24gPT09ICd1cCcpIHtcblxuXHRcdGRpcmVjdGlvbiA9ICdkb3duJztcblx0fVxuXG5cdGNvbmZpZy5pbm5lci5zb3J0LmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcblx0Y29uZmlnLmlubmVyLnNvcnQuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuXHRjb25maWcuaW5uZXIuc29ydC5kYXRhVHlwZSA9IGhlYWRlck9iai5kYXRhVHlwZTtcblxuXHRzb3J0KGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIHNvcnQoY29uZmlnLCB1cGRhdGVUYWJsZSkge1xuXHR1cGRhdGVUYWJsZSA9IHVwZGF0ZVRhYmxlICE9PSBmYWxzZTtcblxuXHRjb25maWcuZGF0YVNvdXJjZS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcblx0XHRpZiAoY29uZmlnLnNvcnQuY3VzdG9tU29ydCAhPT0gbnVsbCkge1xuXHRcdFx0cmV0dXJuIGNvbmZpZy5zb3J0LmN1c3RvbVNvcnQoYSwgYiwge1xuXHRcdFx0XHRhdHRyaWJ1dGU6IGNvbmZpZy5pbm5lci5zb3J0LmF0dHJpYnV0ZSxcblx0XHRcdFx0ZGlyZWN0aW9uOiBjb25maWcuaW5uZXIuc29ydC5kaXJlY3Rpb24sXG5cdFx0XHRcdGRhdGFUeXBlOiBjb25maWcuaW5uZXIuc29ydC5kYXRhVHlwZSxcblx0XHRcdFx0ZWRpdGVkVmFsdWVzOiBjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzLFxuXHRcdFx0XHR1bmlxdWVSb3dLZXk6IGNvbmZpZy51bmlxdWVSb3dLZXlcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdHZhciBhdHRyaWJ1dGUgPSBjb25maWcuaW5uZXIuc29ydC5hdHRyaWJ1dGUgfHwgY29uZmlnLnNvcnQuZGVmYXVsdCxcblx0XHRcdGRpcmVjdGlvbiA9IGNvbmZpZy5pbm5lci5zb3J0LmRpcmVjdGlvbiB8fCAnZG93bicsXG5cdFx0XHRkYXRhVHlwZSA9IGNvbmZpZy5pbm5lci5zb3J0LmRhdGFUeXBlIHx8IGdldFNvcnRUeXBlKGNvbmZpZywgY29uZmlnLnNvcnQuZGVmYXVsdCk7XG5cblx0XHRyZXR1cm4gZGF0YVV0aWwuZGVmYXVsdENvbXBhcmF0b3IoYSwgYiwge1xuXHRcdFx0YXR0cmlidXRlOiBhdHRyaWJ1dGUsXG5cdFx0XHRkaXJlY3Rpb246IGRpcmVjdGlvbixcblx0XHRcdGRhdGFUeXBlOiBkYXRhVHlwZSxcblx0XHRcdGVkaXRlZFZhbHVlczogY29uZmlnLmlubmVyLmVkaXRlZFZhbHVlcyxcblx0XHRcdHVuaXF1ZVJvd0tleTogY29uZmlnLnVuaXF1ZVJvd0tleSxcblx0XHRcdG5hbWU6IGNvbmZpZy5sb2NhbGUubmFtZVxuXHRcdH0pO1xuXHR9KTtcblxuXHRpZiAodXBkYXRlVGFibGUpIHtcblx0XHRkb21Nb2R1bGUudXBkYXRlVGFibGUoY29uZmlnKTtcblx0fVxufVxuXG5mdW5jdGlvbiByZXNldFNvcnQoY29uZmlnKSB7XG5cdGNvbmZpZy5pbm5lci5zb3J0LmF0dHJpYnV0ZSA9XG5cdGNvbmZpZy5pbm5lci5zb3J0LmRpcmVjdGlvbiA9XG5cdGNvbmZpZy5pbm5lci5zb3J0LmRhdGFUeXBlID0gdW5kZWZpbmVkOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmaW5lZFxuXG5cdGNvbmZpZy5kYXRhU291cmNlLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdGlmIChjb25maWcuc29ydC5jdXN0b21Tb3J0ICE9PSBudWxsKSB7XG5cdFx0XHRyZXR1cm4gY29uZmlnLnNvcnQuY3VzdG9tU29ydChhLCBiLCB7XG5cdFx0XHRcdGF0dHJpYnV0ZTogY29uZmlnLnNvcnQuZGVmYXVsdCxcblx0XHRcdFx0ZGlyZWN0aW9uOiAnZG93bicsXG5cdFx0XHRcdGRhdGFUeXBlOiBnZXRTb3J0VHlwZShjb25maWcsIGNvbmZpZy5zb3J0LmRlZmF1bHQpLFxuXHRcdFx0XHRlZGl0ZWRWYWx1ZXM6IGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXMsXG5cdFx0XHRcdHVuaXF1ZVJvd0tleTogY29uZmlnLnVuaXF1ZVJvd0tleVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRhdGFVdGlsLmRlZmF1bHRDb21wYXJhdG9yKGEsIGIsIHtcblx0XHRcdGF0dHJpYnV0ZTogY29uZmlnLnNvcnQuZGVmYXVsdCxcblx0XHRcdGRpcmVjdGlvbjogJ2Rvd24nLFxuXHRcdFx0ZGF0YVR5cGU6IGdldFNvcnRUeXBlKGNvbmZpZywgY29uZmlnLnNvcnQuZGVmYXVsdCksXG5cdFx0XHRlZGl0ZWRWYWx1ZXM6IGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXMsXG5cdFx0XHR1bmlxdWVSb3dLZXk6IGNvbmZpZy51bmlxdWVSb3dLZXksXG5cdFx0XHRuYW1lOiBjb25maWcubG9jYWxlLm5hbWVcblx0XHR9KTtcblx0fSk7XG5cblx0ZG9tTW9kdWxlLnVwZGF0ZVRhYmxlKGNvbmZpZyk7XG59XG5cbmZ1bmN0aW9uIGdldFNvcnRUeXBlKGNvbmZpZywgYXR0cmlidXRlKSB7XG5cdHZhciBoZWFkZXJPYmogPSBjb25maWdVdGlsLmdldEhlYWRlck9iamVjdChjb25maWcsIGF0dHJpYnV0ZSk7XG5cblx0cmV0dXJuIHR5cGVvZiBoZWFkZXJPYmogPT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIGhlYWRlck9iai5kYXRhVHlwZSA9PSAndW5kZWZpbmVkJyA/ICdzdHJpbmcnIDogaGVhZGVyT2JqLmRhdGFUeXBlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0c29ydEJ5Q29sdW1uOiBzb3J0QnlDb2x1bW4sXG5cdHNvcnQ6IHNvcnQsXG5cdHJlc2V0U29ydDogcmVzZXRTb3J0XG59O1xufSx7XCIuLi9tb2R1bGVzL2RvbVwiOjEzLFwiLi4vdXRpbHMvY29uZmlndXJhdGlvblwiOjI0LFwiLi4vdXRpbHMvZGF0YVwiOjI1fV0sMjA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG5pZiAodHlwZW9mIEFycmF5LnByb3RvdHlwZS5maW5kID09ICd1bmRlZmluZWQnKSB7XG5cdEFycmF5LnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24ocHJlZGljYXRlKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXh0ZW5kLW5hdGl2ZVxuXHRcdGlmICh0aGlzID09PSBudWxsKSB7XG5cdFx0XHR0aHJvdyBuZXcgVHlwZUVycm9yKCdBcnJheS5wcm90b3R5cGUuZmluZCBjYWxsZWQgb24gbnVsbCBvciB1bmRlZmluZWQnKTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIHByZWRpY2F0ZSAhPT0gJ2Z1bmN0aW9uJykge1xuXHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcigncHJlZGljYXRlIG11c3QgYmUgYSBmdW5jdGlvbicpO1xuXHRcdH1cblxuXHRcdHZhciBsaXN0ID0gT2JqZWN0KHRoaXMpO1xuXHRcdHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aCA+Pj4gMDtcblx0XHR2YXIgdGhpc0FyZyA9IGFyZ3VtZW50c1sxXTtcblx0XHR2YXIgdmFsdWU7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YWx1ZSA9IGxpc3RbaV07XG5cdFx0XHRpZiAocHJlZGljYXRlLmNhbGwodGhpc0FyZywgdmFsdWUsIGksIGxpc3QpKSB7XG5cdFx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gdW5kZWZpbmVkOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmaW5lZFxuXHR9O1xufVxufSx7fV0sMjE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG5pZiAoIUVsZW1lbnQucHJvdG90eXBlLm1hdGNoZXMpIHtcblx0RWxlbWVudC5wcm90b3R5cGUubWF0Y2hlcyA9XG5cdFx0RWxlbWVudC5wcm90b3R5cGUubWF0Y2hlc1NlbGVjdG9yIHx8XG5cdFx0RWxlbWVudC5wcm90b3R5cGUubW96TWF0Y2hlc1NlbGVjdG9yIHx8XG5cdFx0RWxlbWVudC5wcm90b3R5cGUubXNNYXRjaGVzU2VsZWN0b3IgfHxcblx0XHRFbGVtZW50LnByb3RvdHlwZS5vTWF0Y2hlc1NlbGVjdG9yIHx8XG5cdFx0RWxlbWVudC5wcm90b3R5cGUud2Via2l0TWF0Y2hlc1NlbGVjdG9yIHx8XG5cdFx0ZnVuY3Rpb24ocykge1xuXHRcdFx0dmFyIG1hdGNoZXMgPSAodGhpcy5kb2N1bWVudCB8fCB0aGlzLm93bmVyRG9jdW1lbnQpLnF1ZXJ5U2VsZWN0b3JBbGwocyksXG5cdFx0XHRcdGkgPSBtYXRjaGVzLmxlbmd0aDtcblxuXHRcdFx0d2hpbGUgKC0taSA+PSAwICYmIG1hdGNoZXMuaXRlbShpKSAhPT0gdGhpcykge30gLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXHRcdFx0cmV0dXJuIGkgPiAtMTtcblx0XHR9O1xufVxufSx7fV0sMjI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG5pZiAoIU5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoKSB7XG5cdE5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoID0gZnVuY3Rpb24oY2FsbGJhY2ssIGFyZ3VtZW50KSB7XG5cdFx0YXJndW1lbnQgPSBhcmd1bWVudCB8fCB3aW5kb3c7XG5cblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNhbGxiYWNrLmNhbGwoYXJndW1lbnQsIHRoaXNbaV0sIGksIHRoaXMpO1xuXHRcdH1cblx0fTtcbn1cbn0se31dLDIzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxuaWYgKHR5cGVvZiBPYmplY3QuYXNzaWduICE9ICdmdW5jdGlvbicpIHtcblx0Ly8gTXVzdCBiZSB3cml0YWJsZTogdHJ1ZSwgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAnYXNzaWduJywge1xuXHRcdHZhbHVlOiBmdW5jdGlvbiBhc3NpZ24odGFyZ2V0KSB7IC8vIC5sZW5ndGggb2YgZnVuY3Rpb24gaXMgMlxuXHRcdFx0aWYgKHRhcmdldCA9PT0gbnVsbCkgeyAvLyBUeXBlRXJyb3IgaWYgdW5kZWZpbmVkIG9yIG51bGxcblx0XHRcdFx0dGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgdW5kZWZpbmVkIG9yIG51bGwgdG8gb2JqZWN0Jyk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciB0byA9IE9iamVjdCh0YXJnZXQpO1xuXG5cdFx0XHRmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgYXJndW1lbnRzLmxlbmd0aDsgaW5kZXgrKykge1xuXHRcdFx0XHR2YXIgbmV4dFNvdXJjZSA9IGFyZ3VtZW50c1tpbmRleF07XG5cblx0XHRcdFx0aWYgKG5leHRTb3VyY2UgIT09IG51bGwpIHsgLy8gU2tpcCBvdmVyIGlmIHVuZGVmaW5lZCBvciBudWxsXG5cdFx0XHRcdFx0Zm9yICh2YXIgbmV4dEtleSBpbiBuZXh0U291cmNlKSB7XG5cdFx0XHRcdFx0XHQvLyBBdm9pZCBidWdzIHdoZW4gaGFzT3duUHJvcGVydHkgaXMgc2hhZG93ZWRcblx0XHRcdFx0XHRcdGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobmV4dFNvdXJjZSwgbmV4dEtleSkpIHtcblx0XHRcdFx0XHRcdFx0dG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRvO1xuXHRcdH0sXG5cdFx0d3JpdGFibGU6IHRydWUsXG5cdFx0Y29uZmlndXJhYmxlOiB0cnVlXG5cdH0pO1xufVxufSx7fV0sMjQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiBjYWxjdWxhdGVWaXJ0dWFsQ29udGFpbmVySGVpZ2h0KGNvbmZpZywgaGVpZ2h0KSB7XG5cdGlmICh0eXBlb2YgaGVpZ2h0ID09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0dXJuIGhlaWdodDtcblx0fVxuXG5cdHJldHVybiBjb25maWcuaW5uZXIubWluQnVmZmVySGVpZ2h0ICogMiArIE1hdGguZmxvb3IoaGVpZ2h0IC8gY29uZmlnLmRpbWVuc2lvbnMuY2VsbEhlaWdodCkgKiBjb25maWcuZGltZW5zaW9ucy5jZWxsSGVpZ2h0O1xufVxuXG5mdW5jdGlvbiBnZXREZWZhdWx0Q29udGFpbmVySGVpZ2h0KGNvbmZpZykge1xuXHRyZXR1cm4gY2FsY3VsYXRlVmlydHVhbENvbnRhaW5lckhlaWdodChjb25maWcsIHdpbmRvdy5pbm5lckhlaWdodCAtIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnNlbGVjdG9ycy5tYWluQ29udGFpbmVyKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSA2NCk7XG59XG5cbmZ1bmN0aW9uIGdldEluZGV4T2ZDZWxsS2V5SGVhZGVyKGNvbmZpZykge1xuXHRyZXR1cm4gY29uZmlnLmhlYWRlcnMubGVuZ3RoIC0gMTtcbn1cblxuZnVuY3Rpb24gZ2V0U29ydERlZmF1bHQoY29uZmlnKSB7XG5cdHJldHVybiBjb25maWcudW5pcXVlUm93S2V5O1xufVxuXG5mdW5jdGlvbiBnZXRNYXhDb2xzcGFuKGNvbmZpZykge1xuXHR2YXIgbWF4VmFsID0gMTtcblxuXHRjb25maWcuaGVhZGVycy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW1lbnQpIHtcblx0XHRlbGVtZW50LmZvckVhY2goZnVuY3Rpb24oc3ViRWxlbWVudCkge1xuXHRcdFx0aWYgKHR5cGVvZiBzdWJFbGVtZW50LmNvbHNwYW4gIT0gJ3VuZGVmaW5lZCcgJiYgbWF4VmFsIDwgc3ViRWxlbWVudC5jb2xzcGFuKSB7XG5cdFx0XHRcdG1heFZhbCA9IHN1YkVsZW1lbnQuY29sc3Bhbjtcblx0XHRcdH1cblx0XHR9KTtcblx0fSk7XG5cblx0cmV0dXJuIG1heFZhbDtcbn1cblxuZnVuY3Rpb24gZ2V0VmlzaWJsZVJvd051bWJlcihjb25maWcpIHtcblx0dmFyIGhhc0ZpbHRlciA9IGNvbmZpZy5maWx0ZXIuZW5hYmxlZCxcblx0XHRjb250YWluZXJIZWlnaHQgPSBjb25maWcuZGltZW5zaW9ucy5jb250YWluZXJIZWlnaHQgLSBjb25maWcuaW5uZXIubWluQnVmZmVySGVpZ2h0ICogMixcblx0XHRkYXRhQ2VsbHMgPSBNYXRoLmZsb29yKGNvbnRhaW5lckhlaWdodCAvIGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQpLFxuXHRcdGhlYWRlckNlbGxzID0gY29uZmlnLmhlYWRlcnMubGVuZ3RoICsgKGhhc0ZpbHRlciA/IDEgOiAwKTtcblxuXHRyZXR1cm4gZGF0YUNlbGxzIC0gaGVhZGVyQ2VsbHM7XG59XG5cbmZ1bmN0aW9uIGdldFZpc2libGVDb2x1bW5OdW1iZXIoY29uZmlnKSB7XG5cdHJldHVybiBNYXRoLmZsb29yKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy4nICsgY29uZmlnLnNlbGVjdG9ycy52aXJ0dWFsQ29udGFpbmVyKS5vZmZzZXRXaWR0aCAvIGdldENlbGxGdWxsV2lkdGgoY29uZmlnKSArXG5cdFx0KGNvbmZpZy5pbm5lci5jb2xzcGFuT2Zmc2V0ID4gMiA/IGNvbmZpZy5pbm5lci5jb2xzcGFuT2Zmc2V0IDogMikgKyBjb25maWcuaW5uZXIuY29sc3Bhbk9mZnNldCk7XG59XG5cbmZ1bmN0aW9uIGdldFRhYmxlT2Zmc2V0V2lkdGgoY29uZmlnKSB7XG5cdHZhciB0YWJibGVPZmZzZXRDb2x1bW5zID0gZ2V0S2V5SGVhZGVyKGNvbmZpZykubGVuZ3RoIDwgY29uZmlnLmlubmVyLnZpc2libGVDb2x1bW5OdW1iZXIgPyBjb25maWcuaW5uZXIubWluQnVmZmVyV2lkdGggOiBnZXRLZXlIZWFkZXIoY29uZmlnKS5sZW5ndGggLSBjb25maWcuaW5uZXIudmlzaWJsZUNvbHVtbk51bWJlcjtcblxuXHRyZXR1cm4gdGFiYmxlT2Zmc2V0Q29sdW1ucyAqIGdldENlbGxGdWxsV2lkdGgoY29uZmlnKTtcbn1cblxuZnVuY3Rpb24gZ2V0VGFibGVPZmZzZXRIZWlnaHQoY29uZmlnKSB7XG5cdHZhciB0YWJsZU9mZnNldFJvd3MgPSBjb25maWcuZGF0YVNvdXJjZS5sZW5ndGggPCBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlciA/IGNvbmZpZy5pbm5lci5taW5CdWZmZXJIZWlnaHQgOiBjb25maWcuZGF0YVNvdXJjZS5sZW5ndGggLSBjb25maWcuaW5uZXIudmlzaWJsZVJvd051bWJlciArIDE7XG5cblx0cmV0dXJuIHRhYmxlT2Zmc2V0Um93cyAqIGNvbmZpZy5kaW1lbnNpb25zLmNlbGxIZWlnaHQ7XG59XG5cbmZ1bmN0aW9uIGdldENlbGxGdWxsV2lkdGgoY29uZmlnKSB7XG5cdHJldHVybiBjb25maWcuZGltZW5zaW9ucy5jZWxsUGFkZGluZ0hvcml6b250YWwgKiAyICsgY29uZmlnLmRpbWVuc2lvbnMuY2VsbFdpZHRoICsgY29uZmlnLmRpbWVuc2lvbnMuY2VsbEJvcmRlcldpZHRoO1xufVxuXG5mdW5jdGlvbiBnZXRLZXlIZWFkZXIoY29uZmlnKSB7XG5cdHJldHVybiBjb25maWcuaGVhZGVyc1tjb25maWcuaW5uZXIuaW5kZXhPZkNlbGxLZXlIZWFkZXJdO1xufVxuXG5mdW5jdGlvbiBnZXRGaXhlZEtleUhlYWRlcihjb25maWcpIHtcblx0cmV0dXJuIGNvbmZpZy5maXhlZEhlYWRlcnNbY29uZmlnLmlubmVyLmluZGV4T2ZDZWxsS2V5SGVhZGVyXTtcbn1cblxuZnVuY3Rpb24gZ2V0SGVhZGVyT2JqZWN0KGNvbmZpZywgYXR0cmlidXRlKSB7XG5cdHJldHVybiBnZXRLZXlIZWFkZXIoY29uZmlnKS5maW5kKGZ1bmN0aW9uKGNvbHVtbikge1xuXHRcdHJldHVybiBjb2x1bW4ua2V5ID09PSBhdHRyaWJ1dGU7XG5cdH0pIHx8IGdldEZpeGVkS2V5SGVhZGVyKGNvbmZpZykuZmluZChmdW5jdGlvbihjb2x1bW4pIHtcblx0XHRyZXR1cm4gY29sdW1uLmtleSA9PT0gYXR0cmlidXRlO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gbmlsKCkge1xuXHRyZXR1cm4gZnVuY3Rpb24oKSB7fTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdGNhbGN1bGF0ZVZpcnR1YWxDb250YWluZXJIZWlnaHQ6IGNhbGN1bGF0ZVZpcnR1YWxDb250YWluZXJIZWlnaHQsXG5cdGdldERlZmF1bHRDb250YWluZXJIZWlnaHQ6IGdldERlZmF1bHRDb250YWluZXJIZWlnaHQsXG5cdGdldEluZGV4T2ZDZWxsS2V5SGVhZGVyOiBnZXRJbmRleE9mQ2VsbEtleUhlYWRlcixcblx0Z2V0U29ydERlZmF1bHQ6IGdldFNvcnREZWZhdWx0LFxuXHRnZXRNYXhDb2xzcGFuOiBnZXRNYXhDb2xzcGFuLFxuXHRnZXRWaXNpYmxlUm93TnVtYmVyOiBnZXRWaXNpYmxlUm93TnVtYmVyLFxuXHRnZXRWaXNpYmxlQ29sdW1uTnVtYmVyOiBnZXRWaXNpYmxlQ29sdW1uTnVtYmVyLFxuXHRnZXRUYWJsZU9mZnNldFdpZHRoOiBnZXRUYWJsZU9mZnNldFdpZHRoLFxuXHRnZXRUYWJsZU9mZnNldEhlaWdodDogZ2V0VGFibGVPZmZzZXRIZWlnaHQsXG5cdGdldENlbGxGdWxsV2lkdGg6IGdldENlbGxGdWxsV2lkdGgsXG5cdGdldEtleUhlYWRlcjogZ2V0S2V5SGVhZGVyLFxuXHRnZXRGaXhlZEtleUhlYWRlcjogZ2V0Rml4ZWRLZXlIZWFkZXIsXG5cdGdldEhlYWRlck9iamVjdDogZ2V0SGVhZGVyT2JqZWN0LFxuXHRuaWw6IG5pbFxufTtcbn0se31dLDI1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbid1c2Ugc3RyaWN0JztcblxudmFyIEZJTFRFUl9UWVBFUyA9IFsgJ2VxdWFscycsICdlcXVhbHNDYXNlSW5zZW5zaXRpdmUnLCAnbGlrZScsICdsaWtlQ2FzZUluc2Vuc2l0aXZlJywgJ2dyZWF0ZXJUaGFuJywgJ2dyZWF0ZXJPckVxdWFsJyxcblx0J2xlc3NUaGFuJywgJ2xlc3NPckVxdWFsJywgJ2JldHdlZW4nLCAnYmV0d2VlbkluY2x1c2l2ZScsICdjb250YWlucycgXTtcblxuZnVuY3Rpb24gZGVmYXVsdENvbXBhcmF0b3IoYSwgYiwgb3B0aW9ucykge1xuXHR2YXIgYXR0ckEgPSBnZXRNZXJnZWRWYWx1ZShhLCBvcHRpb25zLmF0dHJpYnV0ZSwgb3B0aW9ucy5lZGl0ZWRWYWx1ZXMsIG9wdGlvbnMudW5pcXVlUm93S2V5KSxcblx0XHRhdHRyQiA9IGdldE1lcmdlZFZhbHVlKGIsIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpLFxuXHRcdGlzRG93biA9IG9wdGlvbnMuZGlyZWN0aW9uID09PSAnZG93bic7XG5cblx0aWYgKG9wdGlvbnMuZGF0YVR5cGUgPT09ICdzdHJpbmcnKSB7XG5cdFx0dmFyIGNvbXBhcmVSZXN1bHQgPSAwO1xuXG5cdFx0aWYgKHR5cGVvZiBhdHRyQSA9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0Y29tcGFyZVJlc3VsdCA9IC0xO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIGF0dHJCID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRjb21wYXJlUmVzdWx0ID0gMTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YXR0ckEgKz0gJyc7XG5cdFx0XHRhdHRyQiArPSAnJztcblxuXHRcdFx0Y29tcGFyZVJlc3VsdCA9IGF0dHJBLmxvY2FsZUNvbXBhcmUoYXR0ckIsIG9wdGlvbnMubG9jYWxlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gaXNEb3duIHx8IGNvbXBhcmVSZXN1bHQgPT09IDAgPyBjb21wYXJlUmVzdWx0IDogY29tcGFyZVJlc3VsdCAqIC0xO1xuXHR9IGVsc2UgaWYgKG9wdGlvbnMuZGF0YVR5cGUgPT09ICdudW1iZXInKSB7XG5cdFx0YXR0ckEgPSBwYXJzZUZsb2F0KGF0dHJBKTtcblx0XHRhdHRyQiA9IHBhcnNlRmxvYXQoYXR0ckIpO1xuXG5cdFx0aWYgKGlzTmFOKGF0dHJBKSkge1xuXHRcdFx0cmV0dXJuIGlzRG93biA/IC0xIDogMTtcblx0XHR9XG5cblx0XHRpZiAoaXNOYU4oYXR0ckIpKSB7XG5cdFx0XHRyZXR1cm4gaXNEb3duID8gMSA6IC0xO1xuXHRcdH1cblx0fVxuXG5cdGlmICh0eXBlb2YgYXR0ckEgPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGF0dHJCICE9ICd1bmRlZmluZWQnIHx8IGF0dHJBIDwgYXR0ckIpIHtcblx0XHRyZXR1cm4gaXNEb3duID8gLTEgOiAxO1xuXHR9XG5cblx0aWYgKHR5cGVvZiBhdHRyQSAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgYXR0ckIgPT0gJ3VuZGVmaW5lZCcgfHwgYXR0ckEgPiBhdHRyQikge1xuXHRcdHJldHVybiBpc0Rvd24gPyAxIDogLTE7XG5cdH1cblxuXHRyZXR1cm4gMDtcbn1cblxuZnVuY3Rpb24gZmlsdGVyRGF0YShvcHRpb25zKSB7XG5cdGlmIChGSUxURVJfVFlQRVMuaW5kZXhPZihvcHRpb25zLmZpbHRlclR5cGUpID09PSAtMSkge1xuXHRcdHdpbmRvdy5jb25zb2xlLmVycm9yKCdOb3QgYSB2YWxpZCBmaWx0ZXIgdHlwZSEgKCcgKyBvcHRpb25zLmZpbHRlclR5cGUgKyAnKScpO1xuXG5cdFx0cmV0dXJuIG9wdGlvbnMuZGF0YVNvdXJjZTtcblx0fVxuXG5cdHN3aXRjaCAob3B0aW9ucy5maWx0ZXJUeXBlKSB7XG5cdFx0Y2FzZSAnZXF1YWxzJzpcblx0XHRcdHJldHVybiBlcXVhbHNGaWx0ZXIob3B0aW9ucyk7XG5cdFx0Y2FzZSAnZXF1YWxzQ2FzZUluc2Vuc2l0aXZlJzpcblx0XHRcdHJldHVybiBlcXVhbHNDYXNlSW5zZW5zaXRpdmVGaWx0ZXIob3B0aW9ucyk7XG5cdFx0Y2FzZSAnbGlrZSc6XG5cdFx0XHRyZXR1cm4gbGlrZUZpbHRlcihvcHRpb25zKTtcblx0XHRjYXNlICdsaWtlQ2FzZUluc2Vuc2l0aXZlJzpcblx0XHRcdHJldHVybiBsaWtlQ2FzZUluc2Vuc2l0aXZlRmlsdGVyKG9wdGlvbnMpO1xuXHRcdGNhc2UgJ2dyZWF0ZXJUaGFuJzpcblx0XHRcdHJldHVybiBncmVhdGVyVGhhbkZpbHRlcihvcHRpb25zKTtcblx0XHRjYXNlICdncmVhdGVyT3JFcXVhbCc6XG5cdFx0XHRyZXR1cm4gZ3JlYXRlck9yRXF1YWxGaWx0ZXIob3B0aW9ucyk7XG5cdFx0Y2FzZSAnbGVzc1RoYW4nOlxuXHRcdFx0cmV0dXJuIGxlc3NUaGFuRmlsdGVyKG9wdGlvbnMpO1xuXHRcdGNhc2UgJ2xlc3NPckVxdWFsJzpcblx0XHRcdHJldHVybiBsZXNzT3JFcXVhbEZpbHRlcihvcHRpb25zKTtcblx0XHRjYXNlICdiZXR3ZWVuJzpcblx0XHRcdHJldHVybiBiZXR3ZWVuRmlsdGVyKG9wdGlvbnMpO1xuXHRcdGNhc2UgJ2JldHdlZW5JbmNsdXNpdmUnOlxuXHRcdFx0cmV0dXJuIGJldHdlZW5JbmNsdXNpdmVGaWx0ZXIob3B0aW9ucyk7XG5cdFx0Y2FzZSAnY29udGFpbnMnOlxuXHRcdFx0cmV0dXJuIGNvbnRhaW5zRmlsdGVyKG9wdGlvbnMpO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRyZXR1cm4gb3B0aW9ucy5kYXRhU291cmNlO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGVxdWFsc0ZpbHRlcihvcHRpb25zKSB7XG5cdHJldHVybiBvcHRpb25zLmRhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuXHRcdHJldHVybiBnZXRNZXJnZWRWYWx1ZShvYmosIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpID09PSBvcHRpb25zLnZhbHVlT25lO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gZXF1YWxzQ2FzZUluc2Vuc2l0aXZlRmlsdGVyKG9wdGlvbnMpIHtcblx0cmV0dXJuIG9wdGlvbnMuZGF0YVNvdXJjZS5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuIGdldE1lcmdlZFZhbHVlKG9iaiwgb3B0aW9ucy5hdHRyaWJ1dGUsIG9wdGlvbnMuZWRpdGVkVmFsdWVzLCBvcHRpb25zLnVuaXF1ZVJvd0tleSkudG9VcHBlckNhc2UoKSA9PT0gb3B0aW9ucy52YWx1ZU9uZS50b1VwcGVyQ2FzZSgpO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gbGlrZUZpbHRlcihvcHRpb25zKSB7XG5cdHJldHVybiBvcHRpb25zLmRhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuXHRcdHJldHVybiBnZXRNZXJnZWRWYWx1ZShvYmosIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpLmluZGV4T2Yob3B0aW9ucy52YWx1ZU9uZSkgIT09IC0xO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gbGlrZUNhc2VJbnNlbnNpdGl2ZUZpbHRlcihvcHRpb25zKSB7XG5cdHJldHVybiBvcHRpb25zLmRhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuXHRcdHJldHVybiBnZXRNZXJnZWRWYWx1ZShvYmosIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihvcHRpb25zLnZhbHVlT25lLnRvVXBwZXJDYXNlKCkpICE9PSAtMTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIGdyZWF0ZXJUaGFuRmlsdGVyKG9wdGlvbnMpIHtcblx0cmV0dXJuIG9wdGlvbnMuZGF0YVNvdXJjZS5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuIGdldE1lcmdlZFZhbHVlKG9iaiwgb3B0aW9ucy5hdHRyaWJ1dGUsIG9wdGlvbnMuZWRpdGVkVmFsdWVzLCBvcHRpb25zLnVuaXF1ZVJvd0tleSkgPiBvcHRpb25zLnZhbHVlT25lO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gZ3JlYXRlck9yRXF1YWxGaWx0ZXIob3B0aW9ucykge1xuXHRyZXR1cm4gb3B0aW9ucy5kYXRhU291cmNlLmZpbHRlcihmdW5jdGlvbihvYmopIHtcblx0XHRyZXR1cm4gZ2V0TWVyZ2VkVmFsdWUob2JqLCBvcHRpb25zLmF0dHJpYnV0ZSwgb3B0aW9ucy5lZGl0ZWRWYWx1ZXMsIG9wdGlvbnMudW5pcXVlUm93S2V5KSA+PSBvcHRpb25zLnZhbHVlT25lO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gbGVzc1RoYW5GaWx0ZXIob3B0aW9ucykge1xuXHRyZXR1cm4gb3B0aW9ucy5kYXRhU291cmNlLmZpbHRlcihmdW5jdGlvbihvYmopIHtcblx0XHRyZXR1cm4gZ2V0TWVyZ2VkVmFsdWUob2JqLCBvcHRpb25zLmF0dHJpYnV0ZSwgb3B0aW9ucy5lZGl0ZWRWYWx1ZXMsIG9wdGlvbnMudW5pcXVlUm93S2V5KSA8IG9wdGlvbnMudmFsdWVPbmU7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBsZXNzT3JFcXVhbEZpbHRlcihvcHRpb25zKSB7XG5cdHJldHVybiBvcHRpb25zLmRhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuXHRcdHJldHVybiBnZXRNZXJnZWRWYWx1ZShvYmosIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpIDw9IG9wdGlvbnMudmFsdWVPbmU7XG5cdH0pO1xufVxuXG5mdW5jdGlvbiBiZXR3ZWVuRmlsdGVyKG9wdGlvbnMpIHtcblx0cmV0dXJuIG9wdGlvbnMuZGF0YVNvdXJjZS5maWx0ZXIoZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuIGdldE1lcmdlZFZhbHVlKG9iaiwgb3B0aW9ucy5hdHRyaWJ1dGUsIG9wdGlvbnMuZWRpdGVkVmFsdWVzLCBvcHRpb25zLnVuaXF1ZVJvd0tleSkgPiBvcHRpb25zLnZhbHVlT25lICYmIG9ialtvcHRpb25zLmF0dHJpYnV0ZV0gPCBvcHRpb25zLnZhbHVlVHdvO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gYmV0d2VlbkluY2x1c2l2ZUZpbHRlcihvcHRpb25zKSB7XG5cdHJldHVybiBvcHRpb25zLmRhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uKG9iaikge1xuXHRcdHJldHVybiBnZXRNZXJnZWRWYWx1ZShvYmosIG9wdGlvbnMuYXR0cmlidXRlLCBvcHRpb25zLmVkaXRlZFZhbHVlcywgb3B0aW9ucy51bmlxdWVSb3dLZXkpID49IG9wdGlvbnMudmFsdWVPbmUgJiYgb2JqW29wdGlvbnMuYXR0cmlidXRlXSA8PSBvcHRpb25zLnZhbHVlVHdvO1xuXHR9KTtcbn1cblxuZnVuY3Rpb24gY29udGFpbnNGaWx0ZXIob3B0aW9ucykge1xuXHRyZXR1cm4gb3B0aW9ucy5kYXRhU291cmNlLmZpbHRlcihmdW5jdGlvbihvYmopIHtcblx0XHRyZXR1cm4gb3B0aW9ucy52YWx1ZU9uZS5pbmRleE9mKGdldE1lcmdlZFZhbHVlKG9iaiwgb3B0aW9ucy5hdHRyaWJ1dGUsIG9wdGlvbnMuZWRpdGVkVmFsdWVzLCBvcHRpb25zLnVuaXF1ZVJvd0tleSkpICE9PSAtMTtcblx0fSk7XG59XG5cbmZ1bmN0aW9uIGdldFZhbHVlQnlUeXBlKHZhbHVlLCBkYXRhVHlwZSkge1xuXHRpZiAodHlwZW9mIHZhbHVlID09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0dXJuIHZhbHVlO1xuXHR9XG5cblx0c3dpdGNoIChkYXRhVHlwZSkge1xuXHRcdGNhc2UgJ3N0cmluZyc6XG5cdFx0XHRyZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcblx0XHRjYXNlICdudW1iZXInOlxuXHRcdFx0cmV0dXJuIHBhcnNlRmxvYXQodmFsdWUpO1xuXHRcdGRlZmF1bHQ6XG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdH1cbn1cblxuZnVuY3Rpb24gZ2V0TWVyZ2VkVmFsdWUocm93LCBhdHRyaWJ1dGUsIGVkaXRlZFZhbHVlcywgdW5pcXVlUm93S2V5KSB7XG5cdHZhciBlZGl0ZWRSb3cgPSBlZGl0ZWRWYWx1ZXNbcm93W3VuaXF1ZVJvd0tleV1dO1xuXG5cdHJldHVybiB0eXBlb2YgZWRpdGVkUm93ID09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBlZGl0ZWRSb3dbYXR0cmlidXRlXSA9PSAndW5kZWZpbmVkJyA/IHJvd1thdHRyaWJ1dGVdIDogZWRpdGVkUm93W2F0dHJpYnV0ZV07XG59XG5cbmZ1bmN0aW9uIGNsb25lT2JqZWN0KG9iaikge1xuXHRyZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdGRlZmF1bHRDb21wYXJhdG9yOiBkZWZhdWx0Q29tcGFyYXRvcixcblx0ZmlsdGVyRGF0YTogZmlsdGVyRGF0YSxcblx0Z2V0VmFsdWVCeVR5cGU6IGdldFZhbHVlQnlUeXBlLFxuXHRjbG9uZU9iamVjdDogY2xvbmVPYmplY3Rcbn07XG59LHt9XSwyNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbmZ1bmN0aW9uIGluZGV4T2ZFbGVtZW50KGVsZW1lbnQpIHtcblx0dmFyIGNvbGxlY3Rpb24gPSBlbGVtZW50LnBhcmVudE5vZGUuY2hpbGROb2RlcztcblxuXHRmb3IgKHZhciBpID0gMDsgaSA8IGNvbGxlY3Rpb24ubGVuZ3RoOyBpKyspIHtcblx0XHRpZiAoY29sbGVjdGlvbltpXSA9PT0gZWxlbWVudCkge1xuXHRcdFx0cmV0dXJuIGk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIC0xO1xufVxuXG5mdW5jdGlvbiBnZXRIZWFkZXJDZWxsSHRtbChjb25maWcsIGNlbGwsIGNlbGxPYmosIGlzTGFzdFJvdykge1xuXHR2YXIgaW5uZXJIVE1MID0gJycsXG5cdFx0Y29sdW1uVGV4dCA9IGNlbGxPYmoudGV4dCB8fCBjZWxsT2JqLmtleSB8fCAnJztcblxuXHRpZiAoY29uZmlnLnNvcnQuZW5hYmxlZCAmJiAhY2VsbE9iai5zb3J0RGlzYWJsZWQgJiYgaXNMYXN0Um93KSB7XG5cdFx0dmFyIGF0dHJpYnV0ZSA9IGNlbGxPYmoua2V5LFxuXHRcdFx0ZGlyZWN0aW9uID0gdHlwZW9mIGF0dHJpYnV0ZSAhPSAndW5kZWZpbmVkJyAmJiBjb25maWcuaW5uZXIuc29ydC5hdHRyaWJ1dGUgPT09IGF0dHJpYnV0ZSA/IGNvbmZpZy5pbm5lci5zb3J0LmRpcmVjdGlvbiA6ICdub25lJyxcblx0XHRcdGlzU29ydGVkID0gZGlyZWN0aW9uICE9PSAnbm9uZScsXG5cdFx0XHRpY29uQ2xhc3MgPSBkaXJlY3Rpb24gPT09ICdkb3duJyA/IGNvbmZpZy5pbm5lci5pY29ucy5zb3J0LmFzYyA6IGNvbmZpZy5pbm5lci5pY29ucy5zb3J0LmRlc2MsXG5cdFx0XHRpY29uRWxlbWVudENsYXNzID0gY29uZmlnLmlubmVyLnNlbGVjdG9ycy5zb3J0SWNvbiArIChpc1NvcnRlZCA/ICcgJyArIGljb25DbGFzcyA6ICdoaWRkZW4nKTtcblxuXHRcdGlubmVySFRNTCArPSAnPGkgY2xhc3M9XCInICsgaWNvbkVsZW1lbnRDbGFzcyArICdcIiBhcmlhLWhpZGRlbj1cInRydWVcIj48L2k+JztcblxuXHRcdGNlbGwuc2V0QXR0cmlidXRlKCdkYXRhLWF0dHJpYnV0ZScsIGF0dHJpYnV0ZSk7XG5cdH1cblxuXHRpbm5lckhUTUwgKz0gY29sdW1uVGV4dDtcblxuXHRyZXR1cm4gaW5uZXJIVE1MO1xufVxuXG5mdW5jdGlvbiBnZXRGaWx0ZXJDZWxsSHRtbChjb25maWcsIGNlbGwsIGNlbGxPYmosIGZpbHRlck9iaikge1xuXHR2YXIgaW5uZXJIVE1MID0gJycsXG5cdFx0aWNvbkNsYXNzID0gY29uZmlnLmlubmVyLmljb25zLmZpbHRlci5zZWFyY2gsXG5cdFx0aWNvbkVsZW1lbnRDbGFzcyA9IGNvbmZpZy5pbm5lci5zZWxlY3RvcnMuZmlsdGVyU2VhcmNoSWNvbiArICcgJyArIGljb25DbGFzcyxcblx0XHRjbGVhckljb25DbGFzcyA9IGNvbmZpZy5pbm5lci5pY29ucy5maWx0ZXIuY2xlYXIsXG5cdFx0Y2xlYXJJY29uRWxlbWVudENsYXNzID0gY29uZmlnLmlubmVyLnNlbGVjdG9ycy5maWx0ZXJDbGVhckljb24gKyAnICcgKyBjbGVhckljb25DbGFzcztcblxuXHRpZiAoIWNlbGxPYmouZmlsdGVyRGlzYWJsZWQpIHtcblx0XHRpbm5lckhUTUwgKz0gJzxpIGNsYXNzPVwiJyArIGljb25FbGVtZW50Q2xhc3MgKyAnXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+PC9pPic7XG5cdFx0aW5uZXJIVE1MICs9IGZpbHRlck9iai52YWx1ZSB8fCAnJztcblxuXHRcdGlmICh0eXBlb2YgZmlsdGVyT2JqLnZhbHVlICE9ICd1bmRlZmluZWQnICYmIGZpbHRlck9iai52YWx1ZSAhPT0gJycpIHtcblx0XHRcdGlubmVySFRNTCArPSAnPGkgY2xhc3M9XCInICsgY2xlYXJJY29uRWxlbWVudENsYXNzICsgJ1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPjwvaT4nO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBpbm5lckhUTUw7XG59XG5cbmZ1bmN0aW9uIGZpbmRQYXJlbnROb2RlKGNoaWxkLCBzZWxlY3Rvcikge1xuXHRpZiAoY2hpbGQucGFyZW50Tm9kZSA9PT0gbnVsbCkge1xuXHRcdHJldHVybiBudWxsO1xuXHR9IGVsc2UgaWYgKGNoaWxkLnBhcmVudE5vZGUubWF0Y2hlcyhzZWxlY3RvcikpIHtcblx0XHRyZXR1cm4gY2hpbGQucGFyZW50Tm9kZTtcblx0fVxuXG5cdHJldHVybiBmaW5kUGFyZW50Tm9kZShjaGlsZC5wYXJlbnROb2RlLCBzZWxlY3Rvcik7XG59XG5cbmZ1bmN0aW9uIGdldFJvd051bWJlcihjb25maWcsIGNlbGwpIHtcblx0cmV0dXJuIGluZGV4T2ZFbGVtZW50KGNlbGwucGFyZW50Tm9kZSkgKyBjb25maWcuaW5uZXIudG9wQ2VsbE9mZnNldDtcbn1cblxuZnVuY3Rpb24gZ2V0Q29sdW1uTnVtYmVyKGNvbmZpZywgY2VsbCkge1xuXHRyZXR1cm4gaW5kZXhPZkVsZW1lbnQoY2VsbCkgLSAxICsgY29uZmlnLmlubmVyLmxlZnRDZWxsT2Zmc2V0O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblx0aW5kZXhPZkVsZW1lbnQ6IGluZGV4T2ZFbGVtZW50LFxuXHRnZXRIZWFkZXJDZWxsSHRtbDogZ2V0SGVhZGVyQ2VsbEh0bWwsXG5cdGdldEZpbHRlckNlbGxIdG1sOiBnZXRGaWx0ZXJDZWxsSHRtbCxcblx0ZmluZFBhcmVudE5vZGU6IGZpbmRQYXJlbnROb2RlLFxuXHRnZXRSb3dOdW1iZXI6IGdldFJvd051bWJlcixcblx0Z2V0Q29sdW1uTnVtYmVyOiBnZXRDb2x1bW5OdW1iZXJcbn07XG59LHt9XSwyNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7XG4ndXNlIHN0cmljdCc7XG5cbnZhciBLRVlfQ09ERVMgPSB7XG5cdEVOVEVSOiAxMyxcblx0RVNDQVBFOiAyN1xufTtcblxuZnVuY3Rpb24gZ2V0S2V5Q29kZShldmVudCkge1xuXHRyZXR1cm4gZXZlbnQua2V5Q29kZSB8fCBldmVudC53aGljaDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdGdldEtleUNvZGU6IGdldEtleUNvZGUsXG5cdEtFWV9DT0RFUzogS0VZX0NPREVTXG59O1xufSx7fV0sMjg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuJ3VzZSBzdHJpY3QnO1xuXG52YXIgQ2VsbCAgICAgICA9IHJlcXVpcmUoJy4uL21vZGVscy90YWJsZS9jZWxsJyksXG5cdGNvbmZpZ1V0aWwgPSByZXF1aXJlKCcuLi91dGlscy9jb25maWd1cmF0aW9uJyk7XG5cbmZ1bmN0aW9uIGdldENlbGxEYXRhKGNvbmZpZywgcm93TnVtYmVyLCBjb2x1bW5OdW1iZXIpIHtcblx0dmFyIGNlbGxEYXRhID0gbnVsbCxcblx0XHRoZWFkZXJPYmogPSBjb25maWdVdGlsLmdldEtleUhlYWRlcihjb25maWcpW2NvbHVtbk51bWJlcl0sXG5cdFx0dW5pcXVlUm93S2V5ID0gbnVsbDtcblxuXHQvLyBJZiB0aGUgaW5kZXggaXMgaGlnaGVyIHRoYW4gdGhlIGF2YWlsYWJsZSByb3dzIG51bWJlclxuXHRpZiAocm93TnVtYmVyID49IGNvbmZpZy5kYXRhU291cmNlLmxlbmd0aCkge1xuXHRcdGNlbGxEYXRhID0gbmV3IENlbGwoe1xuXHRcdFx0a2V5OiBoZWFkZXJPYmoua2V5LFxuXHRcdFx0dmFsdWU6ICcnLFxuXHRcdFx0ZGF0YVR5cGU6IGhlYWRlck9iai5kYXRhVHlwZVxuXHRcdH0pO1xuXHR9IGVsc2Uge1xuXHRcdHVuaXF1ZVJvd0tleSA9IGNvbmZpZy5kYXRhU291cmNlW3Jvd051bWJlcl1bY29uZmlnLnVuaXF1ZVJvd0tleV07XG5cdFx0Y2VsbERhdGEgPSBuZXcgQ2VsbCh7XG5cdFx0XHRrZXk6IGhlYWRlck9iai5rZXksXG5cdFx0XHR2YWx1ZTogY29uZmlnLmRhdGFTb3VyY2Vbcm93TnVtYmVyXVtoZWFkZXJPYmoua2V5XSxcblx0XHRcdGRhdGFUeXBlOiBoZWFkZXJPYmouZGF0YVR5cGUsXG5cdFx0XHRyb3dOdW1iZXI6IHJvd051bWJlcixcblx0XHRcdGNvbHVtbk51bWJlcjogY29sdW1uTnVtYmVyXG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mIGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXNbdW5pcXVlUm93S2V5XSAhPSAndW5kZWZpbmVkJyAmJlxuXHRcdFx0dHlwZW9mIGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXNbdW5pcXVlUm93S2V5XVtoZWFkZXJPYmoua2V5XSAhPSAndW5kZWZpbmVkJykge1xuXG5cdFx0XHRjZWxsRGF0YS5jbGFzcyA9IGNvbmZpZy5zZWxlY3RvcnMuZWRpdGVkQ2VsbDtcblx0XHRcdGNlbGxEYXRhLnVwZGF0ZVZhbHVlKGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXNbdW5pcXVlUm93S2V5XVtoZWFkZXJPYmoua2V5XSk7XG5cdFx0fVxuXHR9XG5cblx0cmV0dXJuIGNlbGxEYXRhO1xufVxuXG5mdW5jdGlvbiBnZXRGaXhlZENlbGxEYXRhKGNvbmZpZywgcm93TnVtYmVyLCBjb2x1bW5OdW1iZXIpIHtcblx0dmFyIGNlbGxEYXRhID0gbnVsbCxcblx0XHRoZWFkZXJPYmogPSBjb25maWdVdGlsLmdldEZpeGVkS2V5SGVhZGVyKGNvbmZpZylbY29sdW1uTnVtYmVyXTtcblxuXHQvLyBJZiB0aGUgaW5kZXggaXMgaGlnaGVyIHRoYW4gdGhlIGF2YWlsYWJsZSByb3dzIG51bWJlclxuXHRpZiAocm93TnVtYmVyID49IGNvbmZpZy5kYXRhU291cmNlLmxlbmd0aCkge1xuXHRcdGNlbGxEYXRhID0gbmV3IENlbGwoe1xuXHRcdFx0a2V5OiBoZWFkZXJPYmoua2V5LFxuXHRcdFx0dmFsdWU6ICcnLFxuXHRcdFx0ZGF0YVR5cGU6IGhlYWRlck9iai5kYXRhVHlwZVxuXHRcdH0pO1xuXHR9IGVsc2Uge1xuXHRcdGNlbGxEYXRhID0gbmV3IENlbGwoe1xuXHRcdFx0a2V5OiBoZWFkZXJPYmoua2V5LFxuXHRcdFx0dmFsdWU6IGNvbmZpZy5kYXRhU291cmNlW3Jvd051bWJlcl1baGVhZGVyT2JqLmtleV0sXG5cdFx0XHRkYXRhVHlwZTogaGVhZGVyT2JqLmRhdGFUeXBlLFxuXHRcdFx0cm93TnVtYmVyOiByb3dOdW1iZXIsXG5cdFx0XHRjb2x1bW5OdW1iZXI6IGNvbHVtbk51bWJlclxuXHRcdH0pO1xuXHR9XG5cblx0cmV0dXJuIGNlbGxEYXRhO1xufVxuXG5mdW5jdGlvbiBtZXJnZUVkaXRlZFZhbHVlc0luUm93KGNvbmZpZywgcm93KSB7XG5cdHZhciBtZXJnZWRSb3dEYXRhID0ge30sXG5cdFx0dW5pcXVlUm93S2V5ID0gcm93W2NvbmZpZy51bmlxdWVSb3dLZXldO1xuXG5cdGlmICh0eXBlb2YgY29uZmlnLmlubmVyLmVkaXRlZFZhbHVlc1t1bmlxdWVSb3dLZXldID09ICd1bmRlZmluZWQnKSB7XG5cdFx0cmV0dXJuIHJvdztcblx0fVxuXG5cdE9iamVjdC5rZXlzKHJvdykuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcblx0XHRtZXJnZWRSb3dEYXRhW2tleV0gPSBjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzW3VuaXF1ZVJvd0tleV1ba2V5XSB8fCByb3dba2V5XTtcblx0fSk7XG5cblx0cmV0dXJuIG1lcmdlZFJvd0RhdGE7XG59XG5cbmZ1bmN0aW9uIG1lcmdlRWRpdGVkVmFsdWVzSW5EYXRhU291cmNlKGNvbmZpZywgZHMpIHtcblx0dmFyIG1lcmdlZERzID0gW107XG5cblx0ZHMuZm9yRWFjaChmdW5jdGlvbihyb3cpIHtcblx0XHRtZXJnZWREcy5wdXNoKG1lcmdlRWRpdGVkVmFsdWVzSW5Sb3coY29uZmlnLCByb3cpKTtcblx0fSk7XG5cblx0cmV0dXJuIG1lcmdlZERzO1xufVxuXG5mdW5jdGlvbiBzZXBhcmF0ZVZhbHVlc0luRGF0YVNvdXJjZShjb25maWcsIG1lcmdlZERzKSB7XG5cdHZhciBzZXBhcmF0ZWREcyA9IFtdO1xuXG5cdG1lcmdlZERzLmZvckVhY2goZnVuY3Rpb24obWVyZ2VkUm93KSB7XG5cdFx0dmFyIG9yaWdpbmFsUm93ID0gY29uZmlnLmlubmVyLm9yaWdpbmFsRGF0YVNvdXJjZS5maW5kKGZ1bmN0aW9uKHJvdykge1xuXHRcdFx0cmV0dXJuIHJvd1tjb25maWcudW5pcXVlUm93S2V5XSA9PT0gbWVyZ2VkUm93W2NvbmZpZy51bmlxdWVSb3dLZXldO1xuXHRcdH0pO1xuXG5cdFx0aWYgKHR5cGVvZiBvcmlnaW5hbFJvdyAhPSAndW5kZWZpbmVkJykge1xuXHRcdFx0c2VwYXJhdGVkRHMucHVzaChvcmlnaW5hbFJvdyk7XG5cdFx0fVxuXHR9KTtcblxuXHRyZXR1cm4gc2VwYXJhdGVkRHM7XG59XG5cbmZ1bmN0aW9uIHN0b3JlVXBkYXRlZENlbGxWYWx1ZShjb25maWcsIGNlbGxEYXRhKSB7XG5cdHZhciB1bmlxdWVSb3dLZXkgPSBjb25maWcuZGF0YVNvdXJjZVtjZWxsRGF0YS5yb3dOdW1iZXJdW2NvbmZpZy51bmlxdWVSb3dLZXldO1xuXG5cdGlmICh0eXBlb2YgY29uZmlnLmlubmVyLmVkaXRlZFZhbHVlc1t1bmlxdWVSb3dLZXldID09ICd1bmRlZmluZWQnKSB7XG5cdFx0Y29uZmlnLmlubmVyLmVkaXRlZFZhbHVlc1t1bmlxdWVSb3dLZXldID0ge307XG5cdH1cblxuXHRjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzW3VuaXF1ZVJvd0tleV1bY2VsbERhdGEua2V5XSA9IGNlbGxEYXRhLmVkaXRlZFZhbHVlO1xufVxuXG5mdW5jdGlvbiBwZXJzaXN0Um93VmFsdWVzKGNvbmZpZywgcm93KSB7XG5cdHZhciB1bmlxdWVSb3dLZXkgPSByb3dbY29uZmlnLnVuaXF1ZVJvd0tleV07XG5cblx0aWYgKHR5cGVvZiBjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzW3VuaXF1ZVJvd0tleV0gIT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRPYmplY3Qua2V5cyhjb25maWcuaW5uZXIuZWRpdGVkVmFsdWVzW3VuaXF1ZVJvd0tleV0pLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG5cdFx0XHRyb3dba2V5XSA9IGNvbmZpZy5pbm5lci5lZGl0ZWRWYWx1ZXNbdW5pcXVlUm93S2V5XVtrZXldO1xuXHRcdH0pO1xuXG5cdFx0Y29uZmlnLmlubmVyLmVkaXRlZFZhbHVlc1t1bmlxdWVSb3dLZXldID0ge307XG5cdH1cbn1cblxuZnVuY3Rpb24gcGVyc2lzdEJhdGNoVmFsdWVzKGNvbmZpZykge1xuXHRjb25maWcuZGF0YVNvdXJjZS5mb3JFYWNoKGZ1bmN0aW9uKHJvdykge1xuXHRcdHBlcnNpc3RSb3dWYWx1ZXMoY29uZmlnLCByb3cpO1xuXHR9KTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cdGdldENlbGxEYXRhOiBnZXRDZWxsRGF0YSxcblx0Z2V0Rml4ZWRDZWxsRGF0YTogZ2V0Rml4ZWRDZWxsRGF0YSxcblx0bWVyZ2VFZGl0ZWRWYWx1ZXNJblJvdzogbWVyZ2VFZGl0ZWRWYWx1ZXNJblJvdyxcblx0bWVyZ2VFZGl0ZWRWYWx1ZXNJbkRhdGFTb3VyY2U6IG1lcmdlRWRpdGVkVmFsdWVzSW5EYXRhU291cmNlLFxuXHRzZXBhcmF0ZVZhbHVlc0luRGF0YVNvdXJjZTogc2VwYXJhdGVWYWx1ZXNJbkRhdGFTb3VyY2UsXG5cdHN0b3JlVXBkYXRlZENlbGxWYWx1ZTogc3RvcmVVcGRhdGVkQ2VsbFZhbHVlLFxuXHRwZXJzaXN0Um93VmFsdWVzOiBwZXJzaXN0Um93VmFsdWVzLFxuXHRwZXJzaXN0QmF0Y2hWYWx1ZXM6IHBlcnNpc3RCYXRjaFZhbHVlc1xufTtcbn0se1wiLi4vbW9kZWxzL3RhYmxlL2NlbGxcIjoxMSxcIi4uL3V0aWxzL2NvbmZpZ3VyYXRpb25cIjoyNH1dLDI5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXtcbiFmdW5jdGlvbih0LGUpe1wiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW10sZSk6XCJvYmplY3RcIj09dHlwZW9mIGV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9ZSgpOnQuQ2xhc3M9ZSgpfSh0aGlzLGZ1bmN0aW9uKCl7XCJ1c2Ugc3RyaWN0XCI7ZnVuY3Rpb24gdCgpe312YXIgZT1cImNvbnN0cnVjdG9yXCIsbz1cImV4dGVuZFwiO3JldHVybiB0W29dPWZ1bmN0aW9uKHQpe2Z1bmN0aW9uIG4oKXtpW2VdLmFwcGx5KHRoaXMsYXJndW1lbnRzKX12YXIgaT1PYmplY3QuY3JlYXRlKHRoaXMucHJvdG90eXBlKTtyZXR1cm4gdC5jYWxsKGksdGhpcy5wcm90b3R5cGUpLG4ucHJvdG90eXBlPWksbltvXT10aGlzW29dLG59LHR9KTtcbn0se31dfSx7fSxbMV0pO1xuIl0sImZpbGUiOiJ2aXJ0dWFsLWRhdGEtZ3JpZC5taW4uanMifQ==
